import{f as _e,e as ye,_ as ge,c as ke,d as ve,F as ae}from"./Input.vue_vue_type_script_setup_true_lang-D655McB8.js";import{t as xe,o as he,s as le,u as we,F as ie,b as ce,c as re,d as be,e as $e,f as Me,T as Ce,a as ze,_ as Ie}from"./RenameDialog.vue_vue_type_script_setup_true_lang-Cxp-LVDe.js";import{c as B,_ as de}from"./createLucideIcon-HFLEBeyO.js";import{_ as Ae,P as Be,a as Se,I as Te}from"./ActionItem.vue_vue_type_style_index_0_lang-b9zJ9tuQ.js";import{d as S,X as Ve,Y as Le,a4 as Oe,p as L,h as J,l as ue,I as Y,C as Ue,o as l,i as x,w as n,c as e,b as d,t as P,u as t,a as A,F as Q,r as ee,g as _,s as F,D as te,a5 as De,m as E,_ as je,G as Fe,J as Pe,K as Re,j as H,e as q,a6 as Ne,n as oe,A as Ee,B as He,a7 as qe,H as Ze,a8 as We,a9 as Je,aa as Ge,ab as Ke,ac as Xe,x as pe,y as Ye,v as ne,ad as Qe,ae as et}from"./index-09HGTn95.js";import{_ as tt,v as nt}from"./defaultGraph-DR8Fw17l.js";import{S as ot,L as st}from"./sparkle-BBCIa37M.js";import{C as at}from"./chevron-left-CJ9lvmhd.js";/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=B("ArrowDownToLineIcon",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=B("ArrowUpToLineIcon",[["path",{d:"M5 3h14",key:"7usisc"}],["path",{d:"m18 13-6-6-6 6",key:"1kf1n9"}],["path",{d:"M12 7v14",key:"1akyts"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=B("FullscreenIcon",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["rect",{width:"10",height:"8",x:"7",y:"8",rx:"1",key:"vys8me"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=B("Loader2Icon",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=B("PackageIcon",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=B("Redo2Icon",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",key:"19mnr4"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=B("Settings2Icon",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=B("TerminalIcon",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=B("Undo2Icon",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=B("WorkflowIcon",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=B("ZoomInIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=B("ZoomOutIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),kt={key:0,class:"flex flex-col gap-3"},vt={class:"flex items-center justify-between p-2 text-xs bg-zinc-900 select-none"},xt={class:"font-bold text-zinc-400"},ht={class:"text-zinc-700"},wt={class:"flex flex-col"},bt={class:"flex items-center justify-between border-b border-zinc-800 p-2 last:border-b-0 hover:bg-zinc-900 hover:bg-opacity-60 transition-all"},$t={class:"flex flex-col"},Mt=_("span",{class:"text-[10px] text-zinc-600"}," 当前 Value: ",-1),Ct={class:"text-xs"},zt={key:1,class:"flex flex-col gap-3"},It={class:"flex items-center justify-between p-2 text-xs bg-zinc-900 select-none"},At={class:"font-bold text-zinc-400"},Bt={class:"flex gap-4 items-center"},St={class:"text-zinc-700"},Tt={class:"flex flex-col gap-3"},Vt=S({__name:"MakeAppDialog",props:Ve({flow:{},prompt:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(y){const i=y,c=Le(y,"modelValue"),{prompt:r,flow:k}=Oe(i),u=L(0),h=J(()=>{switch(u.value){case 0:return"选择 Widgets";case 1:return"配置 Outputs";case 2:return"生成 App"}}),o=J(()=>r.value.nodes.reduce((g,p)=>(g[p.id]=p,g),{})),O=J(()=>r.value.nodes.filter(g=>g.widgets.length>0)),s=L({}),R=L({}),j=xe(he({title:le().min(2).max(50),desc:le().optional()})),w=we({validationSchema:j}),b=ue(),T=w.handleSubmit(async g=>{const p=g.title,I=g.desc??"",N=Object.entries(s.value).reduce(($,[V,M])=>{const[C,D]=V.split("-").map(Number);return M&&($[C]?$[C].push(D):$[C]=[D]),$},{}),f=Object.entries(R.value).reduce(($,[V,M])=>{const C=V;return M&&$.push(Number(C)),$},[]),U=[],Z=[];for(const[$,V]of Object.entries(N)){const M=o.value[$];for(const C of V){const D=M.widgets[C];U.push({...D,nodeId:M.id})}}for(const $ of f)Z.push(o.value[$]);const a={...r.value,app:{title:p,description:I,inputs:U,outputs:Z}},v=await _e.create({name:p,description:I,flowid:k.value.id,data:JSON.stringify(a)});v?(c.value=!1,Y.success("App 创建成功"),b.push({name:"FlowApp",params:{id:String(v.id)}})):Y.error("App 创建失败, 请重试")},g=>{console.log(g),Y.error("App 名称必须在 2 到 50 个字符之间")});return(g,p)=>{const I=be,N=$e,f=ge,U=tt,Z=je,a=Fe,v=Pe,$=Re,V=Ae,M=ke,C=de,D=Me,fe=ve,me=ye,se=Ue("auto-animate");return l(),x(me,{open:c.value,"onUpdate:open":p[3]||(p[3]=m=>c.value=m)},{default:n(()=>[e(fe,{class:"w-[580px]"},{default:n(()=>[e(N,null,{default:n(()=>[e(I,null,{default:n(()=>[d(P(t(h))+" ( "+P(t(u)+1)+" / 3 )",1)]),_:1})]),_:1}),e(V,{class:"max-h-[70dvh] w-full rounded-md"},{default:n(()=>[t(u)===0?(l(),A("section",kt,[e($,{"delay-duration":0},{default:n(()=>[(l(!0),A(Q,null,ee(t(O),(m,G)=>(l(),A("div",{class:"flex flex-col border border-zinc-800 rounded-md overflow-hidden",key:G},[_("span",vt,[_("span",xt,P(m.title),1),_("span",ht,"id - "+P(m.id),1)]),_("div",wt,[(l(!0),A(Q,null,ee(m.widgets,(W,K)=>(l(),x(v,{key:K},{default:n(()=>[e(Z,null,{default:n(()=>[_("div",bt,[e(f,{class:"w-60",modelValue:W.title,"onUpdate:modelValue":X=>W.title=X},null,8,["modelValue","onUpdate:modelValue"]),e(U,{checked:t(s)[`${m.id}-${K}`],"onUpdate:checked":X=>t(s)[`${m.id}-${K}`]=X},null,8,["checked","onUpdate:checked"])])]),_:2},1024),e(a,{align:"start",side:"right"},{default:n(()=>[_("div",$t,[Mt,_("span",Ct,P(W.value),1)])]),_:2},1024)]),_:2},1024))),128))])]))),128))]),_:1})])):t(u)===1?(l(),A("section",zt,[(l(!0),A(Q,null,ee(t(r).nodes,(m,G)=>(l(),A("div",{class:"flex flex-col border border-zinc-800 rounded-md overflow-hidden",key:G},[_("span",It,[_("span",At,P(m.title),1),_("div",Bt,[_("span",St,"id - "+P(m.id),1),e(U,{checked:t(R)[`${m.id}`],"onUpdate:checked":W=>t(R)[`${m.id}`]=W},null,8,["checked","onUpdate:checked"])])])]))),128))])):F("",!0)]),_:1}),te(_("section",Tt,[_("form",{class:"space-y-4",onSubmit:p[0]||(p[0]=(...m)=>t(T)&&t(T)(...m))},[e(t(ie),{name:"title"},{default:n(({componentField:m})=>[te((l(),x(t(ce),null,{default:n(()=>[e(t(re),null,{default:n(()=>[e(f,E({autofocus:"",placeholder:"App 名称",class:"col-span-3"},m),null,16)]),_:2},1024)]),_:2},1024)),[[se]])]),_:1}),e(t(ie),{name:"desc"},{default:n(({componentField:m})=>[te((l(),x(t(ce),null,{default:n(()=>[e(t(re),null,{default:n(()=>[e(M,E({placeholder:"描述 [可选]",class:"col-span-3"},m),null,16)]),_:2},1024)]),_:2},1024)),[[se]])]),_:1})],32)],512),[[De,t(u)===2]]),e(D,null,{default:n(()=>[t(u)===1||t(u)===2?(l(),x(C,{key:0,type:"submit",onClick:p[1]||(p[1]=m=>u.value-=1)},{default:n(()=>[d(" 上一步 ")]),_:1})):F("",!0),t(u)===0||t(u)===1?(l(),x(C,{key:1,type:"submit",onClick:p[2]||(p[2]=m=>u.value+=1)},{default:n(()=>[d(" 下一步 ")]),_:1})):F("",!0),t(u)===2?(l(),x(C,{key:2,type:"submit",onClick:t(T)},{default:n(()=>[d("提交")]),_:1},8,["onClick"])):F("",!0)]),_:1})]),_:1})]),_:1},8,["open"])}}}),Lt={class:"flex items-center p-[6px] fixed left-1/2 bottom-5 rounded-xl border bg-background shadow-sm z-50 -translate-x-1/2"},Ot=_("span",{class:"w-[1px] h-[20px] mx-[6px] bg-secondary"},null,-1),Ut=S({__name:"ActionBar",emits:["onActionClick","onMakeAppClick"],setup(y,{emit:i}){const c=i;function r(u){c("onActionClick",u)}function k(){c("onMakeAppClick")}return(u,h)=>{const o=Se;return l(),A("section",Lt,[e(o,{label:"制作 App",tip:"制作成为 ComfyApp",onClick:k},{icon:n(()=>[e(t(ot),{size:15})]),_:1}),e(o,{label:"管理器",tip:"打开 ComfyMC 管理器",onClick:h[0]||(h[0]=O=>r("open-manager"))},{icon:n(()=>[e(t(dt),{size:15})]),_:1}),e(o,{label:"控制台",tip:"查看控制台输出",onClick:h[1]||(h[1]=O=>r("open-console"))},{icon:n(()=>[e(t(ft),{size:15})]),_:1}),Ot,e(o,{label:"运行",tip:"运行当前工作流",onClick:h[2]||(h[2]=O=>r("queue-prompt"))},{icon:n(()=>[e(t(Be),{size:15})]),_:1})])}}}),Dt=S({__name:"Menubar",props:{modelValue:{},defaultValue:{},dir:{},loop:{type:Boolean},class:{}},emits:["update:modelValue"],setup(y,{emit:i}){const c=y,r=i;return(k,u)=>(l(),x(t(Ne),E(c,{class:t(q)("flex items-center space-x-1 rounded-xl border bg-background p-1 shadow-sm",c.class),"onUpdate:modelValue":u[0]||(u[0]=h=>r("update:modelValue",h))}),{default:n(()=>[H(k.$slots,"default")]),_:3},16,["class"]))}}),jt=S({__name:"MenubarShortcut",setup(y){return(i,c)=>(l(),A("span",{class:oe(t(q)("text-xs ml-auto tracking-widest opacity-50",i.$attrs.class??""))},[H(i.$slots,"default")],2))}}),Ft=S({__name:"MenubarMenu",props:{value:{}},setup(y){const i=y;return(c,r)=>(l(),x(t(qe),Ee(He(i)),{default:n(()=>[H(c.$slots,"default")]),_:3},16))}}),Pt=S({__name:"MenubarContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},side:{},sideOffset:{default:8},align:{default:"start"},alignOffset:{default:-4},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(y){const i=y,c=Ze(i);return(r,k)=>(l(),x(t(Je),null,{default:n(()=>[e(t(We),E(t(c),{class:t(q)("z-50 min-w-[12rem] overflow-hidden rounded-xl border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i.class)}),{default:n(()=>[H(r.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),Rt=S({__name:"MenubarSeparator",props:{asChild:{type:Boolean},as:{}},setup(y){const i=y;return(c,r)=>(l(),x(t(Ge),E({class:t(q)("-mx-1 my-1 h-px bg-secondary",c.$attrs.class??"")},i),null,16,["class"]))}}),Nt=S({__name:"MenubarItem",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},inset:{type:Boolean},class:{}},emits:["select"],setup(y,{emit:i}){const c=y,r=i;return(k,u)=>(l(),x(t(Ke),E(c,{class:[t(q)("relative flex cursor-pointer select-none items-center rounded-lg px-2 py-1.5 text-[13px] outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-all",k.inset&&"pl-8",c.class)],onSelect:u[0]||(u[0]=h=>r("select",h))}),{default:n(()=>[H(k.$slots,"default")]),_:3},16,["class"]))}}),Et=S({__name:"MenubarIcon",setup(y){return(i,c)=>(l(),A("span",{class:oe(t(q)("text-xs mr-2 tracking-widest opacity-70",i.$attrs.class??""))},[H(i.$slots,"default")],2))}}),Ht=S({__name:"MenubarTrigger",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(y){const i=y;return(c,r)=>(l(),x(t(Xe),E(i,{class:t(q)("flex cursor-pointer select-none items-center rounded-lg px-3.5 py-1.5 text-[13px]  outline-none hover:bg-accent focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground transition-all",i.class)}),{default:n(()=>[H(c.$slots,"default")]),_:3},16,["class"]))}}),qt={class:"flex gap-1 h-full px-3 text-sm"},Zt={class:"font-medium select-none"},Wt=_("div",{class:"h-6 w-px bg-secondary"},null,-1),z=15,Jt=S({__name:"TopBar",props:{flow:{}},emits:["onMenuClick"],setup(y,{emit:i}){const c=i,r=L("");function k(){r.value&&(r.value="")}const u=ue();function h(){u.push({name:"Flows"})}function o(O){c("onMenuClick",O)}return pe(()=>{window.addEventListener("blur",k)}),Ye(()=>{window.removeEventListener("blur",k)}),(O,s)=>{const R=de,j=Ht,w=Et,b=Nt,T=Rt,g=Pt,p=Ft,I=jt,N=Dt;return l(),x(N,{class:"flow-menu z-[99]",modelValue:t(r),"onUpdate:modelValue":s[13]||(s[13]=f=>ne(r)?r.value=f:null)},{default:n(()=>[e(R,{variant:"ghost",size:"icon",class:"w-8 h-8 rounded-lg",onClick:h},{default:n(()=>[e(t(at))]),_:1}),_("div",qt,[_("span",Zt,P(O.flow.name),1)]),Wt,e(p,null,{default:n(()=>[e(j,null,{default:n(()=>[d("工作流")]),_:1}),e(g,null,{default:n(()=>[e(b,{onClick:s[0]||(s[0]=f=>o("rename"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(Ce),{size:z})]),_:1}),d(" 重命名 ")]),_:1}),e(b,{onClick:s[1]||(s[1]=f=>o("set-thumb"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(Te),{size:z})]),_:1}),d(" 设置封面 ")]),_:1}),e(b,{onClick:s[2]||(s[2]=f=>o("save-template"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(_t),{size:z})]),_:1}),d(" 保存为模版 ")]),_:1}),e(T),e(b,{onClick:s[3]||(s[3]=f=>o("import"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(it),{size:z})]),_:1}),d(" 导入 ")]),_:1}),e(b,{onClick:s[4]||(s[4]=f=>o("export"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(lt),{size:z})]),_:1}),d(" 导出 ")]),_:1}),e(T),e(b,{onClick:s[5]||(s[5]=f=>o("clear"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(ze),{size:z})]),_:1}),d(" 清空 ")]),_:1})]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(j,null,{default:n(()=>[d("编辑")]),_:1}),e(g,null,{default:n(()=>[e(b,{onClick:s[6]||(s[6]=f=>o("undo"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(mt),{size:z})]),_:1}),d(" 撤销 "),e(I,null,{default:n(()=>[d("⌘Z")]),_:1})]),_:1}),e(b,{onClick:s[7]||(s[7]=f=>o("redo"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(ut),{size:z})]),_:1}),d(" 重做 "),e(I,null,{default:n(()=>[d("⌘⇧Z")]),_:1})]),_:1})]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(j,null,{default:n(()=>[d("画布")]),_:1}),e(g,null,{default:n(()=>[e(b,{onClick:s[8]||(s[8]=f=>o("zoom-in"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(yt),{size:z})]),_:1}),d(" 放大 "),e(I,null,{default:n(()=>[d("⌘+")]),_:1})]),_:1}),e(b,{onClick:s[9]||(s[9]=f=>o("zoom-out"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(gt),{size:z})]),_:1}),d(" 缩小 "),e(I,null,{default:n(()=>[d("⌘-")]),_:1})]),_:1}),e(b,{onClick:s[10]||(s[10]=f=>o("zoom-reset"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(ct),{size:z})]),_:1}),d(" 缩放至100% "),e(I,null,{default:n(()=>[d("⌘0")]),_:1})]),_:1}),e(T),e(b,{onClick:s[11]||(s[11]=f=>o("arrange"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(st),{size:z})]),_:1}),d(" 排列节点 ")]),_:1}),e(T),e(b,{onClick:s[12]||(s[12]=f=>o("editor-settings"))},{default:n(()=>[e(w,null,{default:n(()=>[e(t(pt),{size:z})]),_:1}),d(" 编辑器设置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Gt={class:"editor"},Kt={class:"editor-container"},Xt={key:0,class:"absolute inset-0 flex items-center justify-center z-50"},ln=S({__name:"Flow",setup(y){const i=L(!0),c=L(!0),r=J(()=>i.value||c.value||!o.value),k=L(null),h=et().params.id,o=L(null);async function O(){o.value=await ae.findById(h);const a=JSON.parse(JSON.stringify(o.value?o.value.data:nt));g({type:"load-prompt",payload:{prompt:a}})}function s(a){if(k.value)switch(a){case"arrange":case"zoom-in":case"zoom-out":case"zoom-reset":case"editor-settings":case"undo":case"redo":case"clear":case"export":case"import":g({type:a});break;case"rename":I();break}}function R(a){if(k.value)switch(a){case"queue-prompt":case"open-manager":g({type:a});break}}async function j(a){a.data.type==="loaded"&&(await O(),setTimeout(()=>{i.value=!1},300),window.removeEventListener("message",j))}function w(){window.removeEventListener("message",j),window.removeEventListener("message",T)}const b={"got-prompt":a=>{f.value=a},"prompt-gen-error":a=>{console.log(a)},"download-prompt":a=>{console.log(a)},"prompt-loaded":()=>{c.value=!1},"prompt-load-error":()=>{console.log()},"graph-data":a=>{o.value&&(o.value.data=a),ae.update(h,{data:a})},"missing-nodes":a=>{console.log(a)}};function T(a){const v=a.data;if(v.from==="comfymc"){const{type:$,payload:V}=v,M=b[$];M&&M(V)}}function g(a){var v;k.value&&((v=k.value.contentWindow)==null||v.postMessage({internal:a},"*"))}const p=L(!1);function I(){p.value=!0}function N(a,v){o.value&&(o.value.name=a,o.value.description=v)}const f=L(),U=L(!1);function Z(){g({type:"get-prompt"}),U.value=!0}return pe(async()=>{window.addEventListener("message",j),window.addEventListener("message",T)}),Qe(()=>w()),(a,v)=>{const $=Jt,V=Ut,M=Ie,C=Vt;return l(),A("main",Gt,[t(o)?(l(),x($,{key:0,flow:t(o),onOnMenuClick:s},null,8,["flow"])):F("",!0),t(o)?(l(),x(V,{key:1,onOnActionClick:R,onOnMakeAppClick:Z})):F("",!0),_("section",Kt,[_("iframe",{ref_key:"iframeRef",ref:k,class:oe({loading:t(r)}),src:"http://127.0.0.1:8188"},null,2),t(r)?(l(),A("div",Xt,[e(t(rt),{size:30,class:"animate-spin"})])):F("",!0)]),t(o)?(l(),x(M,{key:2,flow:t(o),"dialog-open":t(p),"onUpdate:dialogOpen":v[0]||(v[0]=D=>ne(p)?p.value=D:null),onOnUpdate:N},null,8,["flow","dialog-open"])):F("",!0),t(f)&&t(o)?(l(),x(C,{key:3,flow:t(o),prompt:t(f),open:t(U),"onUpdate:open":v[1]||(v[1]=D=>ne(U)?U.value=D:null)},null,8,["flow","prompt","open"])):F("",!0)])}}});export{ln as default};
