import{i as Ae,h as ue,e as Se,_ as Be,c as Te,d as Le,F as _e,a as oe,j as Oe}from"./Input.vue_vue_type_script_setup_true_lang-D93yzfFd.js";import{t as Pe,o as Ve,s as ye,u as Ue,F as ge,b as ve,c as ke,f as Re,T as Fe,a as De,_ as je}from"./RenameDialog.vue_vue_type_script_setup_true_lang-Cim12Utq.js";import{c as V,_ as xe}from"./createLucideIcon-C5YStjzx.js";import{_ as he,a as we,P as Ee,I as He}from"./ActionItem.vue_vue_type_style_index_0_lang-CdwNJ7UC.js";import{d as U,Y as Ne,Z as qe,a5 as $e,q as L,A as be,h as se,p as fe,I as ce,y as ie,D as Ze,o as c,i as C,w as o,c as e,g as v,t as N,u as t,a as P,F as ae,r as le,s as ne,v as J,E as re,a6 as Je,m as Q,b as k,a7 as We,_ as Ce,J as Me,K as ze,M as Ie,j as X,e as ee,a8 as Ge,n as me,B as Ke,C as Ye,a9 as Qe,H as Xe,aa as et,ab as tt,ac as ot,ad as nt,ae as st,z as at,x as pe,af as lt,ag as it,l as de}from"./index-DBfi-iYF.js";import{_ as ct,v as rt}from"./Switch.vue_vue_type_script_setup_true_lang-CA_1wzG7.js";import{_ as dt,a as ut,b as pt}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-B1qGrir7.js";import{S as ft,L as mt}from"./sparkle-BExYOf4S.js";import{C as _t}from"./chevron-left-C392Kf5p.js";/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=V("ArrowDownToLineIcon",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=V("ArrowUpToLineIcon",[["path",{d:"M5 3h14",key:"7usisc"}],["path",{d:"m18 13-6-6-6 6",key:"1kf1n9"}],["path",{d:"M12 7v14",key:"1akyts"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=V("FullscreenIcon",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["rect",{width:"10",height:"8",x:"7",y:"8",rx:"1",key:"vys8me"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=V("Loader2Icon",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=V("PackageIcon",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=V("Redo2Icon",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",key:"19mnr4"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=V("Settings2Icon",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=V("SparklesIcon",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=V("TerminalIcon",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=V("Undo2Icon",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=V("WorkflowIcon",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=V("ZoomInIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-vue-next v0.341.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=V("ZoomOutIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),At={key:0,class:"flex flex-col gap-3"},St={class:"flex items-center justify-between p-2 text-xs bg-zinc-900 select-none"},Bt={class:"font-bold text-zinc-400"},Tt={class:"text-zinc-700"},Lt={class:"flex flex-col"},Ot=["onClick"],Pt={class:"flex flex-col"},Vt=v("span",{class:"text-[10px] text-zinc-600"}," 当前 Value: ",-1),Ut={class:"text-xs"},Rt={key:1,class:"flex flex-col gap-3"},Ft=["onClick"],Dt={class:"font-bold text-zinc-400"},jt={class:"flex gap-4 items-center"},Et={class:"text-zinc-700"},Ht={class:"flex flex-col gap-3"},Nt=U({__name:"MakeAppDialog",props:Ne({flow:{},prompt:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup($){const p=$,f=qe($,"modelValue"),{prompt:m,flow:b}=$e(p),h=L(null),{style:M,position:_}=Ae(h,{initialValue:{x:window.innerWidth/2,y:window.innerHeight/2}});be(h,i=>{var r;if(i){const A=(r=h.value)==null?void 0:r.parentElement,D=A==null?void 0:A.getBoundingClientRect();D&&(_.value={x:window.innerWidth/2-D.width/2,y:window.innerHeight/2-D.height/2})}},{immediate:!0});const a=L(0),s=se(()=>{switch(a.value){case 0:return"选择 Widgets";case 1:return"配置 Outputs";case 2:return"生成 App"}}),K=se(()=>m.value.nodes.reduce((i,r)=>(i[r.id]=r,i),{})),q=se(()=>m.value.nodes.filter(i=>i.widgets.length>0)),g=L({}),x=L({}),Z=Pe(Ve({title:ye().min(2).max(50),desc:ye().optional()})),H=Ue({validationSchema:Z}),R=fe(),I=H.handleSubmit(async i=>{const r=i.title,A=i.desc??"",D=Object.entries(g.value).reduce((y,[w,S])=>{const[j,G]=w.split("-").map(Number);return S&&(y[j]?y[j].push(G):y[j]=[G]),y},{}),W=Object.entries(x.value).reduce((y,[w,S])=>{const j=w;return S&&y.push(Number(j)),y},[]),n=[],d=[];for(const[y,w]of Object.entries(D)){const S=K.value[y];for(const j of w){const G=S.widgets[j];n.push({...G,nodeId:S.id})}}for(const y of W)d.push(K.value[y]);const u={...m.value,app:{title:r,description:A,inputs:n,outputs:d}},z=await ue.create({name:r,description:A,flowid:b.value.id,data:JSON.parse(JSON.stringify(u))});z?(f.value=!1,ce.success("App 创建成功"),R.push({name:"FlowApp",params:{id:String(z.id)}})):ce.error("App 创建失败, 请重试")},i=>{console.log(i),ce.error("App 名称必须在 2 到 50 个字符之间")});async function F(){const i=await ue.findLatestByFlowId(b.value.id);if(i){const r=typeof i.data=="string"?JSON.parse(i.data):i.data,A=r.nodes,D=r.app.inputs,W=r.app.outputs;A.forEach(n=>{n.widgets.forEach((d,u)=>{q.value.forEach(z=>{z.widgets.forEach(y=>{z.id===n.id&&y.name===d.name&&(console.log(d.title,y.title),y.title=d.title)})}),g.value[`${n.id}-${u}`]=D.some(z=>z.nodeId===n.id&&z.name===d.name)}),x.value[`${n.id}`]=W.some(d=>d.id===n.id&&d.type===n.type)}),H.setValues({title:r.app.title,desc:r.app.description})}}return ie(()=>{F()}),(i,r)=>{const A=Be,D=ct,W=Ce,n=Me,d=ze,u=Ie,z=he,y=Te,w=xe,S=Re,j=Le,G=Se,te=Ze("auto-animate");return c(),C(G,{open:f.value,"onUpdate:open":r[6]||(r[6]=l=>f.value=l),modal:!1},{default:o(()=>[e(j,{class:"w-[580px] pt-14 transition-none !transform-none",style:We(t(M))},{default:o(()=>[v("div",{class:"absolute flex text-center sm:text-left text-sm font-bold px-6 py-5 w-full select-none cursor-move",ref_key:"dialogHeaderRef",ref:h},N(t(s))+" ( "+N(t(a)+1)+" / 3 ) ",513),e(z,{class:"max-h-[70dvh] w-full rounded-md"},{default:o(()=>[t(a)===0?(c(),P("section",At,[e(u,{"delay-duration":0},{default:o(()=>[(c(!0),P(ae,null,le(t(q),(l,B)=>(c(),P("div",{class:"flex flex-col border border-zinc-800 rounded-md overflow-hidden",key:B},[v("span",St,[v("span",Bt,N(l.title),1),v("span",Tt,"id - "+N(l.id),1)]),v("div",Lt,[(c(!0),P(ae,null,le(l.widgets,(T,E)=>(c(),C(d,{key:E},{default:o(()=>[e(W,null,{default:o(()=>[v("div",{class:"flex items-center justify-between border-b border-zinc-800 p-2 last:border-b-0 hover:bg-zinc-900 hover:bg-opacity-60 transition-all",onClick:ne(Y=>t(g)[`${l.id}-${E}`]=!t(g)[`${l.id}-${E}`],["stop"])},[e(A,{class:"w-60",modelValue:T.title,"onUpdate:modelValue":Y=>T.title=Y,onClick:r[0]||(r[0]=ne(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"]),e(D,{onClick:r[1]||(r[1]=ne(()=>{},["stop"])),checked:t(g)[`${l.id}-${E}`],"onUpdate:checked":Y=>t(g)[`${l.id}-${E}`]=Y},null,8,["checked","onUpdate:checked"])],8,Ot)]),_:2},1024),e(n,{align:"start",side:"right"},{default:o(()=>[v("div",Pt,[Vt,v("span",Ut,N(T.value),1)])]),_:2},1024)]),_:2},1024))),128))])]))),128))]),_:1})])):t(a)===1?(c(),P("section",Rt,[(c(!0),P(ae,null,le(t(m).nodes,(l,B)=>(c(),P("div",{class:"flex flex-col border border-zinc-800 rounded-md overflow-hidden",key:B},[v("span",{class:"flex items-center justify-between p-2 text-xs bg-zinc-900 select-none cursor-pointer hover:bg-zinc-950 transition-all",onClick:T=>t(x)[`${l.id}`]=!t(x)[`${l.id}`]},[v("span",Dt,N(l.title),1),v("div",jt,[v("span",Et,"id - "+N(l.id),1),e(D,{onClick:r[2]||(r[2]=ne(()=>{},["stop"])),checked:t(x)[`${l.id}`],"onUpdate:checked":T=>t(x)[`${l.id}`]=T},null,8,["checked","onUpdate:checked"])])],8,Ft)]))),128))])):J("",!0)]),_:1}),re(v("section",Ht,[v("form",{class:"space-y-4",onSubmit:r[3]||(r[3]=(...l)=>t(I)&&t(I)(...l))},[e(t(ge),{name:"title"},{default:o(({componentField:l})=>[re((c(),C(t(ve),null,{default:o(()=>[e(t(ke),null,{default:o(()=>[e(A,Q({autofocus:"",placeholder:"App 名称",class:"col-span-3"},l),null,16)]),_:2},1024)]),_:2},1024)),[[te]])]),_:1}),e(t(ge),{name:"desc"},{default:o(({componentField:l})=>[re((c(),C(t(ve),null,{default:o(()=>[e(t(ke),null,{default:o(()=>[e(y,Q({placeholder:"描述 [可选]",class:"col-span-3"},l),null,16)]),_:2},1024)]),_:2},1024)),[[te]])]),_:1})],32)],512),[[Je,t(a)===2]]),e(S,null,{default:o(()=>[t(a)===1||t(a)===2?(c(),C(w,{key:0,type:"submit",onClick:r[4]||(r[4]=l=>a.value-=1)},{default:o(()=>[k(" 上一步 ")]),_:1})):J("",!0),t(a)===0||t(a)===1?(c(),C(w,{key:1,type:"submit",onClick:r[5]||(r[5]=l=>a.value+=1)},{default:o(()=>[k(" 下一步 ")]),_:1})):J("",!0),t(a)===2?(c(),C(w,{key:2,type:"submit",onClick:t(I)},{default:o(()=>[k("提交")]),_:1},8,["onClick"])):J("",!0)]),_:1})]),_:1},8,["style"])]),_:1},8,["open"])}}}),qt={class:"flex flex-col gap-1"},Zt=["onClick"],Jt={class:"text-zinc-50 text-sm"},Wt={class:"text-zinc-600 text-xs ml-2"},Gt=U({__name:"AppsListPopover",props:{flowid:{}},setup($){const p=$,{flowid:f}=$e(p),m=L([]);async function b(){m.value=await ue.findByFlowId(f.value)}const h=fe();function M(_){h.push({name:"FlowApp",params:{id:_}})}return ie(()=>{b()}),(_,a)=>{const s=we,K=dt,q=Ce,g=Me,x=ze,Z=he,H=Ie,R=ut,I=pt;return c(),C(I,null,{default:o(()=>[e(K,null,{default:o(()=>[e(s,{label:"Apps",tip:"查看当前工作流的 ComfyApps"},{icon:o(()=>[e(t($t),{size:15})]),_:1})]),_:1}),e(R,{class:"p-1 rounded-lg"},{default:o(()=>[e(H,{"delay-duration":0},{default:o(()=>[e(Z,null,{default:o(()=>[v("div",qt,[(c(!0),P(ae,null,le(t(m),F=>(c(),C(x,{key:F.id},{default:o(()=>[e(q,null,{default:o(()=>[v("div",{class:"flex items-center select-none rounded-sm hover:bg-zinc-900 px-3 py-2 cursor-pointer transition-all",onClick:i=>M(F.id)},[v("span",Jt,N(F.name),1),v("span",Wt," - ver."+N(F.version),1)],8,Zt)]),_:2},1024),F.description?(c(),C(g,{key:0,side:"right"},{default:o(()=>[k(N(F.description),1)]),_:2},1024)):J("",!0)]),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Kt={class:"flex items-center p-[6px] fixed left-1/2 bottom-5 rounded-xl border bg-background shadow-sm z-50 -translate-x-1/2"},Yt=v("span",{class:"w-[1px] h-[20px] mx-[6px] bg-secondary"},null,-1),Qt=v("span",{class:"w-[1px] h-[20px] mx-[6px] bg-secondary"},null,-1),Xt=U({__name:"ActionBar",props:{flowid:{}},emits:["onActionClick","onMakeAppClick"],setup($,{emit:p}){const f=p;function m(h){f("onActionClick",h)}function b(){f("onMakeAppClick")}return(h,M)=>{const _=we,a=Gt;return c(),P("section",Kt,[e(_,{label:"制作 App",tip:"制作成为 ComfyApp",onClick:b},{icon:o(()=>[e(t(ft),{size:15})]),_:1}),e(a,{flowid:h.flowid},null,8,["flowid"]),Yt,e(_,{label:"管理器",tip:"打开 ComfyMC 管理器",onClick:M[0]||(M[0]=s=>m("open-manager"))},{icon:o(()=>[e(t(xt),{size:15})]),_:1}),e(_,{label:"控制台",tip:"查看控制台输出",onClick:M[1]||(M[1]=s=>m("open-console"))},{icon:o(()=>[e(t(bt),{size:15})]),_:1}),Qt,e(_,{label:"运行",tip:"运行当前工作流",onClick:M[2]||(M[2]=s=>m("queue-prompt"))},{icon:o(()=>[e(t(Ee),{size:15})]),_:1})])}}}),eo=U({__name:"Menubar",props:{modelValue:{},defaultValue:{},dir:{},loop:{type:Boolean},class:{}},emits:["update:modelValue"],setup($,{emit:p}){const f=$,m=p;return(b,h)=>(c(),C(t(Ge),Q(f,{class:t(ee)("flex items-center space-x-1 rounded-xl border bg-background p-1 shadow-sm",f.class),"onUpdate:modelValue":h[0]||(h[0]=M=>m("update:modelValue",M))}),{default:o(()=>[X(b.$slots,"default")]),_:3},16,["class"]))}}),to=U({__name:"MenubarShortcut",setup($){return(p,f)=>(c(),P("span",{class:me(t(ee)("text-xs ml-auto tracking-widest opacity-50",p.$attrs.class??""))},[X(p.$slots,"default")],2))}}),oo=U({__name:"MenubarMenu",props:{value:{}},setup($){const p=$;return(f,m)=>(c(),C(t(Qe),Ke(Ye(p)),{default:o(()=>[X(f.$slots,"default")]),_:3},16))}}),no=U({__name:"MenubarContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},side:{},sideOffset:{default:8},align:{default:"start"},alignOffset:{default:-4},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup($){const p=$,f=Xe(p);return(m,b)=>(c(),C(t(tt),null,{default:o(()=>[e(t(et),Q(t(f),{class:t(ee)("z-50 min-w-[12rem] overflow-hidden rounded-xl border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",p.class)}),{default:o(()=>[X(m.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),so=U({__name:"MenubarSeparator",props:{asChild:{type:Boolean},as:{}},setup($){const p=$;return(f,m)=>(c(),C(t(ot),Q({class:t(ee)("-mx-1 my-1 h-px bg-secondary",f.$attrs.class??"")},p),null,16,["class"]))}}),ao=U({__name:"MenubarItem",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},inset:{type:Boolean},class:{}},emits:["select"],setup($,{emit:p}){const f=$,m=p;return(b,h)=>(c(),C(t(nt),Q(f,{class:[t(ee)("relative flex cursor-pointer select-none items-center rounded-lg px-2 py-1.5 text-[13px] outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-all",b.inset&&"pl-8",f.class)],onSelect:h[0]||(h[0]=M=>m("select",M))}),{default:o(()=>[X(b.$slots,"default")]),_:3},16,["class"]))}}),lo=U({__name:"MenubarIcon",setup($){return(p,f)=>(c(),P("span",{class:me(t(ee)("text-xs mr-2 tracking-widest opacity-70",p.$attrs.class??""))},[X(p.$slots,"default")],2))}}),io=U({__name:"MenubarTrigger",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup($){const p=$;return(f,m)=>(c(),C(t(st),Q(p,{class:t(ee)("flex cursor-pointer select-none items-center rounded-lg px-3.5 py-1.5 text-[13px]  outline-none hover:bg-accent focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground transition-all",p.class)}),{default:o(()=>[X(f.$slots,"default")]),_:3},16,["class"]))}}),co={class:"flex gap-1 h-full px-3 text-sm"},ro={class:"font-medium select-none"},uo=v("div",{class:"h-6 w-px bg-secondary"},null,-1),O=15,po=U({__name:"TopBar",props:{flow:{}},emits:["onMenuClick"],setup($,{emit:p}){const f=p,m=L("");function b(){m.value&&(m.value="")}const h=fe();function M(){h.push({name:"Flows"})}function _(a){f("onMenuClick",a)}return ie(()=>{window.addEventListener("blur",b)}),at(()=>{window.removeEventListener("blur",b)}),(a,s)=>{const K=xe,q=io,g=lo,x=ao,Z=so,H=no,R=oo,I=to,F=eo;return c(),C(F,{class:"flow-menu z-[99]",modelValue:t(m),"onUpdate:modelValue":s[13]||(s[13]=i=>pe(m)?m.value=i:null)},{default:o(()=>[e(K,{variant:"ghost",size:"icon",class:"w-8 h-8 rounded-lg",onClick:M},{default:o(()=>[e(t(_t))]),_:1}),v("div",co,[v("span",ro,N(a.flow.name),1)]),uo,e(R,null,{default:o(()=>[e(q,null,{default:o(()=>[k("工作流")]),_:1}),e(H,null,{default:o(()=>[e(x,{onClick:s[0]||(s[0]=i=>_("rename"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(Fe),{size:O})]),_:1}),k(" 重命名 ")]),_:1}),e(x,{onClick:s[1]||(s[1]=i=>_("set-thumb"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(He),{size:O})]),_:1}),k(" 设置封面 ")]),_:1}),e(x,{onClick:s[2]||(s[2]=i=>_("save-template"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(Mt),{size:O})]),_:1}),k(" 保存为模版 ")]),_:1}),e(Z),e(x,{onClick:s[3]||(s[3]=i=>_("import"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(gt),{size:O})]),_:1}),k(" 导入 ")]),_:1}),e(x,{onClick:s[4]||(s[4]=i=>_("export"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(yt),{size:O})]),_:1}),k(" 导出 ")]),_:1}),e(Z),e(x,{onClick:s[5]||(s[5]=i=>_("clear"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(De),{size:O})]),_:1}),k(" 清空 ")]),_:1})]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(q,null,{default:o(()=>[k("编辑")]),_:1}),e(H,null,{default:o(()=>[e(x,{onClick:s[6]||(s[6]=i=>_("undo"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(Ct),{size:O})]),_:1}),k(" 撤销 "),e(I,null,{default:o(()=>[k("⌘Z")]),_:1})]),_:1}),e(x,{onClick:s[7]||(s[7]=i=>_("redo"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(ht),{size:O})]),_:1}),k(" 重做 "),e(I,null,{default:o(()=>[k("⌘⇧Z")]),_:1})]),_:1})]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(q,null,{default:o(()=>[k("画布")]),_:1}),e(H,null,{default:o(()=>[e(x,{onClick:s[8]||(s[8]=i=>_("zoom-in"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(zt),{size:O})]),_:1}),k(" 放大 "),e(I,null,{default:o(()=>[k("⌘+")]),_:1})]),_:1}),e(x,{onClick:s[9]||(s[9]=i=>_("zoom-out"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(It),{size:O})]),_:1}),k(" 缩小 "),e(I,null,{default:o(()=>[k("⌘-")]),_:1})]),_:1}),e(x,{onClick:s[10]||(s[10]=i=>_("zoom-reset"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(vt),{size:O})]),_:1}),k(" 缩放至100% "),e(I,null,{default:o(()=>[k("⌘0")]),_:1})]),_:1}),e(Z),e(x,{onClick:s[11]||(s[11]=i=>_("arrange"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(mt),{size:O})]),_:1}),k(" 排列节点 ")]),_:1}),e(Z),e(x,{onClick:s[12]||(s[12]=i=>_("editor-settings"))},{default:o(()=>[e(g,null,{default:o(()=>[e(t(wt),{size:O})]),_:1}),k(" 编辑器设置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),fo={class:"editor"},mo={class:"editor-container"},_o={key:0,class:"absolute inset-0 flex items-center justify-center z-50"},Co=U({__name:"Flow",setup($){const p=L(!0),f=L(!0),m=se(()=>p.value||f.value||!a.value),b=L(null),h=L(!1);be(h,n=>{n?document.body.classList.add("graph-moving"):document.body.classList.remove("graph-moving")});const _=it().params.id,a=L(null);async function s(){a.value=await _e.findById(_);const n=JSON.parse(JSON.stringify(a.value?a.value.data:rt));R({type:"load-prompt",payload:{prompt:n}})}function K(n){if(b.value)switch(n){case"arrange":case"zoom-in":case"zoom-out":case"zoom-reset":case"editor-settings":case"undo":case"redo":case"clear":case"export":case"import":R({type:n});break;case"rename":F();break}}function q(n){if(b.value)switch(n){case"queue-prompt":case"open-manager":R({type:n});break}}async function g(n){n.data.type==="loaded"&&(await s(),setTimeout(()=>{p.value=!1},300),window.removeEventListener("message",g))}function x(){window.removeEventListener("message",g),window.removeEventListener("message",H)}const Z={"got-prompt":n=>{r.value=n},"prompt-gen-error":n=>{console.log(n)},"download-prompt":n=>{console.log(n)},"prompt-loaded":()=>{f.value=!1},"prompt-load-error":()=>{console.log()},"graph-data":n=>{a.value&&(a.value.data=n),_e.update(_,{data:n})},"missing-nodes":n=>{console.log(n)},"graphcanvas-mousedown":()=>{h.value=!0},"graphcanvas-mouseup":()=>{h.value=!1},"socket-status":n=>{console.log("socket-status",n)},"socket-progress":n=>{console.log("progress",n)},"socket-execution_start":n=>{console.log("socket-execution_start",n)},"socket-executing":n=>{console.log("socket-executing",n)},"socket-b_preview":n=>{console.log("socket-b_preview",n)},"socket-executed":n=>{const d=n.node,u=n.output,z=u==null?void 0:u.images,y=u==null?void 0:u.text,w=u==null?void 0:u.gifs,S=u==null?void 0:u.prompt,j=u==null?void 0:u.analysis,G=u==null?void 0:u._images,te=u==null?void 0:u.prompts;if(z){const l=Array.from(z,B=>{const T=`/view?filename=${encodeURIComponent(B.filename)}&type=${B.type}&subfolder=${encodeURIComponent(B.subfolder)}&t=${+new Date}`;return W({name:B.filename,type:"image",data:T,metadata:{type:B.type,subfolder:B.subfolder}}),`${de}${T}`});oe(`ImagePreview::Show::${d}`).emit(l)}else if(G&&te){const l=[];Array.from(G,(B,T)=>{for(const E of B){const Y=`/view?filename=${encodeURIComponent(E.filename)}&type=${E.type}&subfolder=${encodeURIComponent(E.subfolder)}&t=${+new Date}`;W({name:E.filename,type:"image",data:Y,metadata:{type:E.type,subfolder:E.subfolder}}),l.push([`${de}${Y}`,te[T]])}}),oe(`ImagePrompt::Show::${d}`).emit(l)}else if(y){const l=Array.isArray(y)?y.join(`

`):y;oe(`OutputText::Show::${d}`).emit(l)}else if(w&&w[0]){const l=`/view?filename=${encodeURIComponent(w[0].filename)}&type=${w[0].type}&subfolder=${encodeURIComponent(w[0].subfolder)}&&format=${w[0].format}&t=${+new Date}`,B=`${de}${l}`,T=w[0].format.match("video")?"video":"image";W({name:w[0].filename,type:T,data:l,metadata:{type:w[0].format,subfolder:w[0].subfolder}}),oe(`GifPreview::Show::${d}`).emit({url:B,type:T})}else if(S&&j){const l=`${S.join(`

`)}
${JSON.stringify(j,null,2)}`;oe(`OutputText::Show::${d}`).emit(l)}}};function H(n){const d=n.data;if(d.from==="comfymc"){const{type:u,payload:z}=d,y=Z[u];y&&y(z)}}function R(n){var d;b.value&&((d=b.value.contentWindow)==null||d.postMessage({internal:n},"*"))}const I=L(!1);function F(){I.value=!0}function i(n,d){a.value&&(a.value.name=n,a.value.description=d)}const r=L(),A=L(!1);function D(){R({type:"get-prompt"}),A.value=!0}ie(async()=>{window.addEventListener("message",g),window.addEventListener("message",H)}),lt(()=>x());function W(n){Oe.create({...n,size:0,parentid:_})}return(n,d)=>{const u=po,z=Xt,y=je,w=Nt;return c(),P("main",fo,[t(a)?(c(),C(u,{key:0,flow:t(a),onOnMenuClick:K},null,8,["flow"])):J("",!0),t(a)?(c(),C(z,{key:1,flowid:t(_),onOnActionClick:q,onOnMakeAppClick:D},null,8,["flowid"])):J("",!0),v("section",mo,[v("iframe",{ref_key:"iframeRef",ref:b,class:me({loading:t(m)}),src:"http://127.0.0.1:8188"},null,2),t(m)?(c(),P("div",_o,[e(t(kt),{size:30,class:"animate-spin"})])):J("",!0)]),t(a)?(c(),C(y,{key:2,flow:t(a),"dialog-open":t(I),"onUpdate:dialogOpen":d[0]||(d[0]=S=>pe(I)?I.value=S:null),onOnUpdate:i},null,8,["flow","dialog-open"])):J("",!0),t(r)&&t(a)?(c(),C(w,{key:3,flow:t(a),prompt:t(r),open:t(A),"onUpdate:open":d[1]||(d[1]=S=>pe(A)?A.value=S:null)},null,8,["flow","prompt","open"])):J("",!0)])}}});export{Co as default};
