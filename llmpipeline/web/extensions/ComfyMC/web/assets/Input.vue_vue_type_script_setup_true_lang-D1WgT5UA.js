var jr=Object.defineProperty;var Ir=(t,e,n)=>e in t?jr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ae=(t,e,n)=>(Ir(t,typeof e!="symbol"?e+"":e,n),n);import{d as St,M as zn,o as ye,i as dt,w as ht,j as Wn,A as Tr,B as Rr,u as W,aV as Mr,a as hn,g as Yn,h as Ue,aW as Fr,s as An,c as Kn,aX as Nr,m as qr,e as fn,aB as Vr,aY as $r,v as pn,a4 as Lr,aZ as Ur,a_ as Hn,a$ as zr,p as ze,z as Nt,am as Wr,ai as Dn,aj as Yr,at as Hr,D as Gn,b0 as Qn,n as Xn}from"./index-DugMiPrc.js";let rt;const Gr=new Uint8Array(16);function Qr(){if(!rt&&(rt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!rt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return rt(Gr)}const N=[];for(let t=0;t<256;++t)N.push((t+256).toString(16).slice(1));function Xr(t,e=0){return N[t[e+0]]+N[t[e+1]]+N[t[e+2]]+N[t[e+3]]+"-"+N[t[e+4]]+N[t[e+5]]+"-"+N[t[e+6]]+N[t[e+7]]+"-"+N[t[e+8]]+N[t[e+9]]+"-"+N[t[e+10]]+N[t[e+11]]+N[t[e+12]]+N[t[e+13]]+N[t[e+14]]+N[t[e+15]]}const Jr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Bn={randomUUID:Jr};function Zr(t,e,n){if(Bn.randomUUID&&!e&&!t)return Bn.randomUUID();t=t||{};const r=t.random||(t.rng||Qr)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=r[s];return e}return Xr(r)}const B=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,M=Object.keys,V=Array.isArray;function L(t,e){return typeof e!="object"||M(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||B.Promise||(B.Promise=Promise);const We=Object.getPrototypeOf,es={}.hasOwnProperty;function H(t,e){return es.call(t,e)}function De(t,e){typeof e=="function"&&(e=e(We(t))),(typeof Reflect>"u"?M:Reflect.ownKeys)(e).forEach(n=>{ne(t,n,e[n])})}const Jn=Object.defineProperty;function ne(t,e,n,r){Jn(t,e,L(n&&H(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Se(t){return{from:function(e){return t.prototype=Object.create(e.prototype),ne(t.prototype,"constructor",t),{extend:De.bind(null,t.prototype)}}}}const ts=Object.getOwnPropertyDescriptor;function mn(t,e){let n;return ts(t,e)||(n=We(t))&&mn(n,e)}const ns=[].slice;function wt(t,e,n){return ns.call(t,e,n)}function Zn(t,e){return e(t)}function Me(t){if(!t)throw new Error("Assertion Failed")}function er(t){B.setImmediate?setImmediate(t):setTimeout(t,0)}function tr(t,e){return t.reduce((n,r,s)=>{var a=e(r,s);return a&&(n[a[0]]=a[1]),n},{})}function re(t,e){if(typeof e=="string"&&H(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,s=e.length;r<s;++r){var a=re(t,e[r]);n.push(a)}return n}var i=e.indexOf(".");if(i!==-1){var l=t[e.substr(0,i)];return l===void 0?void 0:re(l,e.substr(i+1))}}function G(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Me(typeof n!="string"&&"length"in n);for(var r=0,s=e.length;r<s;++r)G(t,e[r],n[r])}else{var a=e.indexOf(".");if(a!==-1){var i=e.substr(0,a),l=e.substr(a+1);if(l==="")n===void 0?V(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=n;else{var o=t[i];o&&H(t,i)||(o=t[i]={}),G(o,l,n)}}else n===void 0?V(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function nr(t){var e={};for(var n in t)H(t,n)&&(e[n]=t[n]);return e}const rs=[].concat;function rr(t){return rs.apply([],t)}const sr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(rr([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>B[t]),ss=sr.map(t=>B[t]);tr(sr,t=>[t,!0]);let oe=null;function Ze(t){oe=typeof WeakMap<"u"&&new WeakMap;const e=qt(t);return oe=null,e}function qt(t){if(!t||typeof t!="object")return t;let e=oe&&oe.get(t);if(e)return e;if(V(t)){e=[],oe&&oe.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(qt(t[n]))}else if(ss.indexOf(t.constructor)>=0)e=t;else{const a=We(t);for(var s in e=a===Object.prototype?{}:Object.create(a),oe&&oe.set(t,e),t)H(t,s)&&(e[s]=qt(t[s]))}return e}const{toString:as}={};function Vt(t){return as.call(t).slice(8,-1)}const $t=typeof Symbol<"u"?Symbol.iterator:"@@iterator",is=typeof $t=="symbol"?function(t){var e;return t!=null&&(e=t[$t])&&e.apply(t)}:function(){return null},Oe={};function ee(t){var e,n,r,s;if(arguments.length===1){if(V(t))return t.slice();if(this===Oe&&typeof t=="string")return[t];if(s=is(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const yn=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var X=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ar(t,e){X=t,ir=e}var ir=()=>!0;const os=!new Error("").stack;function xe(){if(os)try{throw xe.arguments,new Error}catch(t){return t}return new Error}function Lt(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(ir).map(r=>`
`+r).join("")):""}var or=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],gn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(or),ls={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ae(t,e){this._e=xe(),this.name=t,this.message=e}function lr(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join(`
`)}function _t(t,e,n,r){this._e=xe(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=lr(t,e)}function Ne(t,e){this._e=xe(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=lr(t,e)}Se(Ae).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Lt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Se(_t).from(Ae),Se(Ne).from(Ae);var vn=gn.reduce((t,e)=>(t[e]=e+"Error",t),{});const us=Ae;var O=gn.reduce((t,e)=>{var n=e+"Error";function r(s,a){this._e=xe(),this.name=n,s?typeof s=="string"?(this.message=`${s}${a?`
 `+a:""}`,this.inner=a||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=ls[e]||n,this.inner=null)}return Se(r).from(us),t[e]=r,t},{});O.Syntax=SyntaxError,O.Type=TypeError,O.Range=RangeError;var jn=or.reduce((t,e)=>(t[e+"Error"]=O[e],t),{}),ft=gn.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=O[e]),t),{});function D(){}function Ye(t){return t}function cs(t,e){return t==null||t===Ye?e:function(n){return e(t(n))}}function we(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ds(t,e){return t===D?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?we(r,this.onsuccess):r),s&&(this.onerror=this.onerror?we(s,this.onerror):s),a!==void 0?a:n}}function hs(t,e){return t===D?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?we(n,this.onsuccess):n),r&&(this.onerror=this.onerror?we(r,this.onerror):r)}}function fs(t,e){return t===D?e:function(n){var r=t.apply(this,arguments);L(n,r);var s=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?we(s,this.onsuccess):s),a&&(this.onerror=this.onerror?we(a,this.onerror):a),r===void 0?i===void 0?void 0:i:L(r,i)}}function ps(t,e){return t===D?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function bn(t,e){return t===D?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,s=arguments.length,a=new Array(s);s--;)a[s]=arguments[s];return n.then(function(){return e.apply(r,a)})}return e.apply(this,arguments)}}ft.ModifyError=_t,ft.DexieError=Ae,ft.BulkError=Ne;var He={};const ur=100,[Ut,xt,zt]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,We(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,We(e),t]})(),cr=xt&&xt.then,pt=Ut&&Ut.constructor,wn=!!zt;var Wt=!1,ms=zt?()=>{zt.then(st)}:B.setImmediate?setImmediate.bind(null,st):B.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{st(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(st,0)},qe=function(t,e){Fe.push([t,e]),kt&&(ms(),kt=!1)},Yt=!0,kt=!0,ge=[],mt=[],Ht=null,Gt=Ye,Ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Rn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Rn(t[0],t[1])}catch{}})}},C=Ke,Fe=[],ve=0,yt=[];function P(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=D,this._lib=!1;var e=this._PSD=C;if(X&&(this._stackHolder=xe(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==He)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Xt(this,this._value))}this._state=null,this._value=null,++e.ref,hr(this,t)}const Qt={get:function(){var t=C,e=Et;function n(r,s){var a=!t.global&&(t!==C||e!==Et);const i=a&&!se();var l=new P((o,d)=>{_n(this,new dr(Pt(r,t,a,i),Pt(s,t,a,i),o,d,t))});return X&&mr(l,this),l}return n.prototype=He,n},set:function(t){ne(this,"then",t&&t.prototype===He?Qt:{get:function(){return t},set:Qt.set})}};function dr(t,e,n,r,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=s}function hr(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&et();n&&typeof n.then=="function"?hr(t,(s,a)=>{n instanceof P?n._then(s,a):n.then(s,a)}):(t._state=!0,t._value=n,fr(t)),r&&tt()}},Xt.bind(null,t))}catch(n){Xt(t,n)}}function Xt(t,e){if(mt.push(e),t._state===null){var n=t._lib&&et();e=Gt(e),t._state=!1,t._value=e,X&&e!==null&&typeof e=="object"&&!e._promise&&function(r,s,a){try{r.apply(null,a)}catch(i){s&&s(i)}}(()=>{var r=mn(e,"stack");e._promise=t,ne(e,"stack",{get:()=>Wt?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){ge.some(s=>s._value===r._value)||ge.push(r)}(t),fr(t),n&&tt()}}function fr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)_n(t,e[n]);var s=t._PSD;--s.ref||s.finalize(),ve===0&&(++ve,qe(()=>{--ve==0&&xn()},[]))}function _n(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++ve,qe(ys,[n,t,e])}else t._listeners.push(e)}function ys(t,e,n){try{Ht=e;var r,s=e._value;e._state?r=t(s):(mt.length&&(mt=[]),r=t(s),mt.indexOf(s)===-1&&function(a){for(var i=ge.length;i;)if(ge[--i]._value===a._value)return void ge.splice(i,1)}(e)),n.resolve(r)}catch(a){n.reject(a)}finally{Ht=null,--ve==0&&xn(),--n.psd.ref||n.psd.finalize()}}function pr(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var s,a,i=t._value;i!=null?(s=i.name||"Error",a=i.message||i,r=Lt(i,0)):(s=i,a=""),e.push(s+(a?": "+a:"")+r)}return X&&((r=Lt(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&pr(t._prev,e,n)),e}function mr(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function st(){et()&&tt()}function et(){var t=Yt;return Yt=!1,kt=!1,t}function tt(){var t,e,n;do for(;Fe.length>0;)for(t=Fe,Fe=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Fe.length>0);Yt=!0,kt=!0}function xn(){var t=ge;ge=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=yt.slice(0),n=e.length;n;)e[--n]()}function at(t){return new P(He,!1,t)}function j(t,e){var n=C;return function(){var r=et(),s=C;try{return ce(n,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{ce(s,!1),r&&tt()}}}De(P.prototype,{then:Qt,_then:function(t,e){_n(this,new dr(null,null,t,e,C))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):at(r)):this.then(null,r=>r&&r.name===e?n(r):at(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),at(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Wt=!0;var t=pr(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Wt=!1}}},timeout:function(t,e){return t<1/0?new P((n,r)=>{var s=setTimeout(()=>r(new O.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ne(P.prototype,Symbol.toStringTag,"Dexie.Promise"),Ke.env=yr(),De(P,{all:function(){var t=ee.apply(null,arguments).map(it);return new P(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((s,a)=>P.resolve(s).then(i=>{t[a]=i,--r||e(t)},n))})},resolve:t=>{if(t instanceof P)return t;if(t&&typeof t.then=="function")return new P((n,r)=>{t.then(n,r)});var e=new P(He,!0,t);return mr(e,Ht),e},reject:at,race:function(){var t=ee.apply(null,arguments).map(it);return new P((e,n)=>{t.map(r=>P.resolve(r).then(e,n))})},PSD:{get:()=>C,set:t=>C=t},totalEchoes:{get:()=>Et},newPSD:ue,usePSD:je,scheduler:{get:()=>qe,set:t=>{qe=t}},rejectionMapper:{get:()=>Gt,set:t=>{Gt=t}},follow:(t,e)=>new P((n,r)=>ue((s,a)=>{var i=C;i.unhandleds=[],i.onunhandled=a,i.finalize=we(function(){(function(l){function o(){l(),yt.splice(yt.indexOf(o),1)}yt.push(o),++ve,qe(()=>{--ve==0&&xn()},[])})(()=>{this.unhandleds.length===0?s():a(this.unhandleds[0])})},i.finalize),t()},e,n,r))}),pt&&(pt.allSettled&&ne(P,"allSettled",function(){const t=ee.apply(null,arguments).map(it);return new P(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((s,a)=>P.resolve(s).then(i=>r[a]={status:"fulfilled",value:i},i=>r[a]={status:"rejected",reason:i}).then(()=>--n||e(r)))})}),pt.any&&typeof AggregateError<"u"&&ne(P,"any",function(){const t=ee.apply(null,arguments).map(it);return new P((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach((a,i)=>P.resolve(a).then(l=>e(l),l=>{s[i]=l,--r||n(new AggregateError(s))}))})}));const q={awaits:0,echoes:0,id:0};var gs=0,gt=[],Bt=0,Et=0,vs=0;function ue(t,e,n,r){var s=C,a=Object.create(s);a.parent=s,a.ref=0,a.global=!1,a.id=++vs;var i=Ke.env;a.env=wn?{Promise:P,PromiseProp:{value:P,configurable:!0,writable:!0},all:P.all,race:P.race,allSettled:P.allSettled,any:P.any,resolve:P.resolve,reject:P.reject,nthen:In(i.nthen,a),gthen:In(i.gthen,a)}:{},e&&L(a,e),++s.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=je(a,t,n,r);return a.ref===0&&a.finalize(),l}function Be(){return q.id||(q.id=++gs),++q.awaits,q.echoes+=ur,q.id}function se(){return!!q.awaits&&(--q.awaits==0&&(q.id=0),q.echoes=q.awaits*ur,!0)}function it(t){return q.echoes&&t&&t.constructor===pt?(Be(),t.then(e=>(se(),e),e=>(se(),F(e)))):t}function bs(t){++Et,q.echoes&&--q.echoes!=0||(q.echoes=q.id=0),gt.push(C),ce(t,!0)}function ws(){var t=gt[gt.length-1];gt.pop(),ce(t,!1)}function ce(t,e){var n=C;if((e?!q.echoes||Bt++&&t===C:!Bt||--Bt&&t===C)||gr(e?bs.bind(null,t):ws),t!==C&&(C=t,n===Ke&&(Ke.env=yr()),wn)){var r=Ke.env.Promise,s=t.env;xt.then=s.nthen,r.prototype.then=s.gthen,(n.global||t.global)&&(Object.defineProperty(B,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function yr(){var t=B.Promise;return wn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(B,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:xt.then,gthen:t.prototype.then}:{}}function je(t,e,n,r,s){var a=C;try{return ce(t,!0),e(n,r,s)}finally{ce(a,!1)}}function gr(t){cr.call(Ut,t)}function Pt(t,e,n,r){return typeof t!="function"?t:function(){var s=C;n&&Be(),ce(e,!0);try{return t.apply(this,arguments)}finally{ce(s,!1),r&&gr(se)}}}function In(t,e){return function(n,r){return t.call(this,Pt(n,e),Pt(r,e))}}(""+cr).indexOf("[native code]")===-1&&(Be=se=D);const Tn="unhandledrejection";function Rn(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,s={promise:e,reason:t};if(B.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Tn,!0,!0),L(r,s)):B.CustomEvent&&L(r=new CustomEvent(Tn,{detail:s}),s),r&&B.dispatchEvent&&(dispatchEvent(r),!B.PromiseRejectionEvent&&B.onunhandledrejection))try{B.onunhandledrejection(r)}catch{}X&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var F=P.reject;function Jt(t,e,n,r){if(t.idbdb&&(t._state.openComplete||C.letThrough||t._vip)){var s=t._createTransaction(e,n,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===vn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Jt(t,e,n,r))):F(a)}return s._promise(e,(a,i)=>ue(()=>(C.trans=s,r(a,i,s)))).then(a=>s._completion.then(()=>a))}if(t._state.openComplete)return F(new O.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return F(new O.DatabaseClosed);t.open().catch(D)}return t._state.dbReadyPromise.then(()=>Jt(t,e,n,r))}const Mn="3.2.5",pe="￿",Zt=-1/0,J="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",vr="String expected.",Ve=[],At=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),_s=At,xs=At,br=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Kt="__dbnames",jt="readonly",It="readwrite";function _e(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const wr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ot(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=Ze(e))[t],e)}class ks{_trans(e,n,r){const s=this._tx||C.trans,a=this.name;function i(o,d,u){if(!u.schema[a])throw new O.NotFound("Table "+a+" not part of transaction");return n(u.idbtrans,u)}const l=et();try{return s&&s.db===this.db?s===C.trans?s._promise(e,i,r):ue(()=>s._promise(e,i,r),{trans:s,transless:C.transless||C}):Jt(this.db,e,[this.name],i)}finally{l&&tt()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(s=>this.hook.reading.fire(s))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(V(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=M(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(d=>{if(d.compound&&n.every(u=>d.keyPath.indexOf(u)>=0)){for(let u=0;u<n.length;++u)if(n.indexOf(d.keyPath[u])===-1)return!1;return!0}return!1}).sort((d,u)=>d.keyPath.length-u.keyPath.length)[0];if(r&&this.db._maxKey!==pe){const d=r.keyPath.slice(0,n.length);return this.where(d).equals(d.map(u=>e[u]))}!r&&X&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,a=this.db._deps.indexedDB;function i(d,u){try{return a.cmp(d,u)===0}catch{return!1}}const[l,o]=n.reduce(([d,u],h)=>{const c=s[h],f=e[h];return[d||c,d||!c?_e(u,c&&c.multi?b=>{const p=re(b,h);return V(p)&&p.some(g=>i(f,g))}:b=>i(f,re(b,h))):u]},[null,null]);return l?this.where(l.name).equals(e[l.keyPath]).filter(o):r?this.filter(o):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,V(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const s=Object.create(e.prototype);for(var a in r)if(H(r,a))try{s[a]=r[a]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){L(this,e)})}add(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let a=e;return s&&r&&(a=ot(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"add",keys:n!=null?[n]:null,values:[a]})).then(i=>i.numFailures?P.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{G(e,s,i)}catch{}return i})}update(e,n){if(typeof e!="object"||V(e))return this.where(":id").equals(e).modify(n);{const r=re(e,this.schema.primKey.keyPath);if(r===void 0)return F(new O.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?M(n).forEach(s=>{G(e,s,n[s])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let a=e;return s&&r&&(a=ot(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"put",values:[a],keys:n!=null?[n]:null})).then(i=>i.numFailures?P.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{G(e,s,i)}catch{}return i})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?P.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:wr})).then(e=>e.numFailures?P.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,n,r){const s=Array.isArray(n)?n:void 0,a=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:l,keyPath:o}=this.schema.primKey;if(o&&s)throw new O.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");const d=e.length;let u=o&&l?e.map(ot(o)):e;return this.core.mutate({trans:i,type:"add",keys:s,values:u,wantResults:a}).then(({numFailures:h,results:c,lastResult:f,failures:b})=>{if(h===0)return a?c:f;throw new Ne(`${this.name}.bulkAdd(): ${h} of ${d} operations failed`,b)})})}bulkPut(e,n,r){const s=Array.isArray(n)?n:void 0,a=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:l,keyPath:o}=this.schema.primKey;if(o&&s)throw new O.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");const d=e.length;let u=o&&l?e.map(ot(o)):e;return this.core.mutate({trans:i,type:"put",keys:s,values:u,wantResults:a}).then(({numFailures:h,results:c,lastResult:f,failures:b})=>{if(h===0)return a?c:f;throw new Ne(`${this.name}.bulkPut(): ${h} of ${d} operations failed`,b)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:s,failures:a})=>{if(r===0)return s;throw new Ne(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,a)})}}function $e(t){var e={},n=function(i,l){if(l){for(var o=arguments.length,d=new Array(o-1);--o;)d[o-1]=arguments[o];return e[i].subscribe.apply(null,d),t}if(typeof i=="string")return e[i]};n.addEventType=a;for(var r=1,s=arguments.length;r<s;++r)a(arguments[r]);return n;function a(i,l,o){if(typeof i!="object"){var d;l||(l=ps),o||(o=D);var u={subscribers:[],fire:o,subscribe:function(h){u.subscribers.indexOf(h)===-1&&(u.subscribers.push(h),u.fire=l(u.fire,h))},unsubscribe:function(h){u.subscribers=u.subscribers.filter(function(c){return c!==h}),u.fire=u.subscribers.reduce(l,o)}};return e[i]=n[i]=u,u}M(d=i).forEach(function(h){var c=d[h];if(V(c))a(h,d[h][0],d[h][1]);else{if(c!=="asap")throw new O.InvalidArgument("Invalid event config");var f=a(h,Ye,function(){for(var b=arguments.length,p=new Array(b);b--;)p[b]=arguments[b];f.subscribers.forEach(function(g){er(function(){g.apply(null,p)})})})}})}}function Te(t,e){return Se(e).from({prototype:t}),e}function Pe(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Tt(t,e){t.filter=_e(t.filter,e)}function Rt(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>_e(r(),e()):e,t.justLimit=n&&!r}function vt(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new O.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Fn(t,e,n){const r=vt(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function lt(t,e,n,r){const s=t.replayFilter?_e(t.filter,t.replayFilter()):t.filter;if(t.or){const a={},i=(l,o,d)=>{if(!s||s(o,d,c=>o.stop(c),c=>o.fail(c))){var u=o.primaryKey,h=""+u;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(u)),H(a,h)||(a[h]=!0,e(l,o,d))}};return Promise.all([t.or._iterate(i,n),Nn(Fn(t,r,n),t.algorithm,i,!t.keysOnly&&t.valueMapper)])}return Nn(Fn(t,r,n),_e(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function Nn(t,e,n,r){var s=j(r?(a,i,l)=>n(r(a),i,l):n);return t.then(a=>{if(a)return a.start(()=>{var i=()=>a.continue();e&&!e(a,l=>i=l,l=>{a.stop(l),i=D},l=>{a.fail(l),i=D})||s(a.value,a,l=>i=l),i()})})}function $(t,e){try{const n=qn(t),r=qn(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,a){const i=s.length,l=a.length,o=i<l?i:l;for(let d=0;d<o;++d)if(s[d]!==a[d])return s[d]<a[d]?-1:1;return i===l?0:i<l?-1:1}(Vn(t),Vn(e));case"Array":return function(s,a){const i=s.length,l=a.length,o=i<l?i:l;for(let d=0;d<o;++d){const u=$(s[d],a[d]);if(u!==0)return u}return i===l?0:i<l?-1:1}(t,e)}}catch{}return NaN}function qn(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=Vt(t);return n==="ArrayBuffer"?"binary":n}function Vn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class Es{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,F.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,F.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=_e(n.algorithm,e)}_iterate(e,n){return lt(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&L(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>lt(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,s=r.table.core;if(Pe(r,!0))return s.count({trans:n,query:{index:vt(r,s.schema),range:r.range}}).then(i=>Math.min(i,r.limit));var a=0;return lt(r,()=>(++a,!1),n,s).then(()=>a)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),s=r[0],a=r.length-1;function i(d,u){return u?i(d[r[u]],u-1):d[s]}var l=this._ctx.dir==="next"?1:-1;function o(d,u){var h=i(d,a),c=i(u,a);return h<c?-l:h>c?l:0}return this.toArray(function(d){return d.sort(o)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&Pe(r,!0)&&r.limit>0){const{valueMapper:s}=r,a=vt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(({result:i})=>s?i.map(s):i)}{const s=[];return lt(r,a=>s.push(a),n,r.table.core).then(()=>s)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,Pe(n)?Rt(n,()=>{var r=e;return(s,a)=>r===0||(r===1?(--r,!1):(a(()=>{s.advance(r),r=0}),!1))}):Rt(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Rt(this._ctx,()=>{var n=e;return function(r,s,a){return--n<=0&&s(a),n>=0}},!0),this}until(e,n){return Tt(this._ctx,function(r,s,a){return!e(r.value)||(s(a),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return Tt(this._ctx,function(s){return e(s.value)}),n=this._ctx,r=e,n.isMatch=_e(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.primaryKey,s)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,a){r.push(a.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&Pe(n,!0)&&n.limit>0)return this._read(s=>{var a=vt(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(({result:s})=>s).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Tt(this._ctx,function(s){var a=s.primaryKey.toString(),i=H(r,a);return r[a]=!0,!i}),this}modify(e){var n=this._ctx;return this._write(r=>{var s;if(typeof e=="function")s=e;else{var a=M(e),i=a.length;s=function(p){for(var g=!1,y=0;y<i;++y){var m=a[y],w=e[m];re(p,m)!==w&&(G(p,m,w),g=!0)}return g}}const l=n.table.core,{outbound:o,extractKey:d}=l.schema.primaryKey,u=this.db._options.modifyChunkSize||200,h=[];let c=0;const f=[],b=(p,g)=>{const{failures:y,numFailures:m}=g;c+=p-m;for(let w of M(y))h.push(y[w])};return this.clone().primaryKeys().then(p=>{const g=y=>{const m=Math.min(u,p.length-y);return l.getMany({trans:r,keys:p.slice(y,y+m),cache:"immutable"}).then(w=>{const k=[],E=[],x=o?[]:null,v=[];for(let _=0;_<m;++_){const K=w[_],A={value:Ze(K),primKey:p[y+_]};s.call(A,A.value,A)!==!1&&(A.value==null?v.push(p[y+_]):o||$(d(K),d(A.value))===0?(E.push(A.value),o&&x.push(p[y+_])):(v.push(p[y+_]),k.push(A.value)))}const S=Pe(n)&&n.limit===1/0&&(typeof e!="function"||e===Mt)&&{index:n.index,range:n.range};return Promise.resolve(k.length>0&&l.mutate({trans:r,type:"add",values:k}).then(_=>{for(let K in _.failures)v.splice(parseInt(K),1);b(k.length,_)})).then(()=>(E.length>0||S&&typeof e=="object")&&l.mutate({trans:r,type:"put",keys:x,values:E,criteria:S,changeSpec:typeof e!="function"&&e}).then(_=>b(E.length,_))).then(()=>(v.length>0||S&&e===Mt)&&l.mutate({trans:r,type:"delete",keys:v,criteria:S}).then(_=>b(v.length,_))).then(()=>p.length>y+m&&g(y+u))})};return g(0).then(()=>{if(h.length>0)throw new _t("Error modifying one or more objects",h,c,f);return p.length})})})}delete(){var e=this._ctx,n=e.range;return Pe(e)&&(e.isPrimKey&&!xs||n.type===3)?this._write(r=>{const{primaryKey:s}=e.table.core.schema,a=n;return e.table.core.count({trans:r,query:{index:s,range:a}}).then(i=>e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(({failures:l,lastResult:o,results:d,numFailures:u})=>{if(u)throw new _t("Could not delete some values",Object.keys(l).map(h=>l[h]),i-u);return i-u}))}):this.modify(Mt)}}const Mt=(t,e)=>e.value=null;function Ps(t,e){return t<e?-1:t===e?0:1}function Cs(t,e){return t>e?-1:t===e?0:1}function Y(t,e,n){var r=t instanceof xr?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Ce(t){return new t.Collection(t,()=>_r("")).limit(0)}function Os(t,e,n,r,s,a){for(var i=Math.min(t.length,r.length),l=-1,o=0;o<i;++o){var d=e[o];if(d!==r[o])return s(t[o],n[o])<0?t.substr(0,o)+n[o]+n.substr(o+1):s(t[o],r[o])<0?t.substr(0,o)+r[o]+n.substr(o+1):l>=0?t.substr(0,l)+e[l]+n.substr(l+1):null;s(t[o],d)<0&&(l=o)}return i<r.length&&a==="next"?t+n.substr(t.length):i<t.length&&a==="prev"?t.substr(0,n.length):l<0?null:t.substr(0,l)+r[l]+n.substr(l+1)}function ut(t,e,n,r){var s,a,i,l,o,d,u,h=n.length;if(!n.every(p=>typeof p=="string"))return Y(t,vr);function c(p){s=function(y){return y==="next"?m=>m.toUpperCase():m=>m.toLowerCase()}(p),a=function(y){return y==="next"?m=>m.toLowerCase():m=>m.toUpperCase()}(p),i=p==="next"?Ps:Cs;var g=n.map(function(y){return{lower:a(y),upper:s(y)}}).sort(function(y,m){return i(y.lower,m.lower)});l=g.map(function(y){return y.upper}),o=g.map(function(y){return y.lower}),d=p,u=p==="next"?"":r}c("next");var f=new t.Collection(t,()=>ie(l[0],o[h-1]+r));f._ondirectionchange=function(p){c(p)};var b=0;return f._addAlgorithm(function(p,g,y){var m=p.key;if(typeof m!="string")return!1;var w=a(m);if(e(w,o,b))return!0;for(var k=null,E=b;E<h;++E){var x=Os(m,w,l[E],o[E],i,d);x===null&&k===null?b=E+1:(k===null||i(k,x)>0)&&(k=x)}return g(k!==null?function(){p.continue(k+u)}:y),!1}),f}function ie(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function _r(t){return{type:1,lower:t,upper:t}}class xr{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,s){r=r!==!1,s=s===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||s)&&(!r||!s)?Ce(this):new this.Collection(this,()=>ie(e,n,!r,!s))}catch{return Y(this,J)}}equals(e){return e==null?Y(this,J):new this.Collection(this,()=>_r(e))}above(e){return e==null?Y(this,J):new this.Collection(this,()=>ie(e,void 0,!0))}aboveOrEqual(e){return e==null?Y(this,J):new this.Collection(this,()=>ie(e,void 0,!1))}below(e){return e==null?Y(this,J):new this.Collection(this,()=>ie(void 0,e,!1,!0))}belowOrEqual(e){return e==null?Y(this,J):new this.Collection(this,()=>ie(void 0,e))}startsWith(e){return typeof e!="string"?Y(this,vr):this.between(e,e+pe,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):ut(this,(n,r)=>n.indexOf(r[0])===0,[e],pe)}equalsIgnoreCase(e){return ut(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=ee.apply(Oe,arguments);return e.length===0?Ce(this):ut(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=ee.apply(Oe,arguments);return e.length===0?Ce(this):ut(this,(n,r)=>r.some(s=>n.indexOf(s)===0),e,pe)}anyOf(){const e=ee.apply(Oe,arguments);let n=this._cmp;try{e.sort(n)}catch{return Y(this,J)}if(e.length===0)return Ce(this);const r=new this.Collection(this,()=>ie(e[0],e[e.length-1]));r._ondirectionchange=a=>{n=a==="next"?this._ascending:this._descending,e.sort(n)};let s=0;return r._addAlgorithm((a,i,l)=>{const o=a.key;for(;n(o,e[s])>0;)if(++s,s===e.length)return i(l),!1;return n(o,e[s])===0||(i(()=>{a.continue(e[s])}),!1)}),r}notEqual(e){return this.inAnyRange([[Zt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=ee.apply(Oe,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Y(this,J)}const n=e.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[Zt,s]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,s=this._ascending,a=this._descending,i=this._min,l=this._max;if(e.length===0)return Ce(this);if(!e.every(m=>m[0]!==void 0&&m[1]!==void 0&&s(m[0],m[1])<=0))return Y(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",O.InvalidArgument);const o=!n||n.includeLowers!==!1,d=n&&n.includeUppers===!0;let u,h=s;function c(m,w){return h(m[0],w[0])}try{u=e.reduce(function(m,w){let k=0,E=m.length;for(;k<E;++k){const x=m[k];if(r(w[0],x[1])<0&&r(w[1],x[0])>0){x[0]=i(x[0],w[0]),x[1]=l(x[1],w[1]);break}}return k===E&&m.push(w),m},[]),u.sort(c)}catch{return Y(this,J)}let f=0;const b=d?m=>s(m,u[f][1])>0:m=>s(m,u[f][1])>=0,p=o?m=>a(m,u[f][0])>0:m=>a(m,u[f][0])>=0;let g=b;const y=new this.Collection(this,()=>ie(u[0][0],u[u.length-1][1],!o,!d));return y._ondirectionchange=m=>{m==="next"?(g=b,h=s):(g=p,h=a),u.sort(c)},y._addAlgorithm((m,w,k)=>{for(var E=m.key;g(E);)if(++f,f===u.length)return w(k),!1;return!!function(x){return!b(x)&&!p(x)}(E)||(this._cmp(E,u[f][1])===0||this._cmp(E,u[f][0])===0||w(()=>{h===s?m.continue(u[f][0]):m.continue(u[f][1])}),!1)}),y}startsWithAnyOf(){const e=ee.apply(Oe,arguments);return e.every(n=>typeof n=="string")?e.length===0?Ce(this):this.inAnyRange(e.map(n=>[n,n+pe])):Y(this,"startsWithAnyOf() only works with strings")}}function Q(t){return j(function(e){return Ge(e),t(e.target.error),!1})}function Ge(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const Qe="storagemutated",le="x-storagemutated-1",de=$e(null,Qe);class Ss{_lock(){return Me(!C.global),++this._reculock,this._reculock!==1||C.global||(C.lockOwnerFor=this),this}_unlock(){if(Me(!C.global),--this._reculock==0)for(C.global||(C.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{je(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&C.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Me(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new O.DatabaseClosed(r);case"MissingAPIError":throw new O.MissingAPI(r.message,r);default:throw new O.OpenFailed(r)}if(!this.active)throw new O.TransactionInactive;return Me(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=j(s=>{Ge(s),this._reject(e.error)}),e.onabort=j(s=>{Ge(s),this.active&&this._reject(new O.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=j(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&de.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return F(new O.ReadOnly("Transaction is readonly"));if(!this.active)return F(new O.TransactionInactive);if(this._locked())return new P((a,i)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(a,i)},C])});if(r)return ue(()=>{var a=new P((i,l)=>{this._lock();const o=n(i,l,this);o&&o.then&&o.then(i,l)});return a.finally(()=>this._unlock()),a._lib=!0,a});var s=new P((a,i)=>{var l=n(a,i,this);l&&l.then&&l.then(a,i)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=P.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);(function i(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=i)})()}var a=n._waitingFor;return new P((i,l)=>{r.then(o=>n._waitingQueue.push(j(i.bind(null,o))),o=>n._waitingQueue.push(j(l.bind(null,o)))).finally(()=>{n._waitingFor===a&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new O.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(H(n,e))return n[e];const r=this.schema[e];if(!r)throw new O.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,r,this);return s.core=this.db.core.table(e),n[e]=s,s}}function en(t,e,n,r,s,a,i){return{name:t,keyPath:e,unique:n,multi:r,auto:s,compound:a,src:(n&&!i?"&":"")+(r?"*":"")+(s?"++":"")+kr(e)}}function kr(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Er(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:tr(n,r=>[r.name,r])}}let Xe=t=>{try{return t.only([[]]),Xe=()=>[[]],[[]]}catch{return Xe=()=>pe,pe}};function tn(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>re(r,e)}(t):e=>re(e,t)}function $n(t){return[].slice.call(t)}let As=0;function Le(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Ks(t,e,n){function r(o){if(o.type===3)return null;if(o.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:d,upper:u,lowerOpen:h,upperOpen:c}=o;return d===void 0?u===void 0?null:e.upperBound(u,!!c):u===void 0?e.lowerBound(d,!!h):e.bound(d,u,!!h,!!c)}const{schema:s,hasGetAll:a}=function(o,d){const u=$n(o.objectStoreNames);return{schema:{name:o.name,tables:u.map(h=>d.objectStore(h)).map(h=>{const{keyPath:c,autoIncrement:f}=h,b=V(c),p=c==null,g={},y={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:b,keyPath:c,autoIncrement:f,unique:!0,extractKey:tn(c)},indexes:$n(h.indexNames).map(m=>h.index(m)).map(m=>{const{name:w,unique:k,multiEntry:E,keyPath:x}=m,v={name:w,compound:V(x),keyPath:x,unique:k,multiEntry:E,extractKey:tn(x)};return g[Le(x)]=v,v}),getIndexByKeyPath:m=>g[Le(m)]};return g[":id"]=y.primaryKey,c!=null&&(g[Le(c)]=y.primaryKey),y})},hasGetAll:u.length>0&&"getAll"in d.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),i=s.tables.map(o=>function(d){const u=d.name;return{name:u,schema:d,mutate:function({trans:h,type:c,keys:f,values:b,range:p}){return new Promise((g,y)=>{g=j(g);const m=h.objectStore(u),w=m.keyPath==null,k=c==="put"||c==="add";if(!k&&c!=="delete"&&c!=="deleteRange")throw new Error("Invalid operation type: "+c);const{length:E}=f||b||{length:1};if(f&&b&&f.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let x;const v=[],S=[];let _=0;const K=I=>{++_,Ge(I)};if(c==="deleteRange"){if(p.type===4)return g({numFailures:_,failures:S,results:[],lastResult:void 0});p.type===3?v.push(x=m.clear()):v.push(x=m.delete(r(p)))}else{const[I,R]=k?w?[b,f]:[b,null]:[f,null];if(k)for(let T=0;T<E;++T)v.push(x=R&&R[T]!==void 0?m[c](I[T],R[T]):m[c](I[T])),x.onerror=K;else for(let T=0;T<E;++T)v.push(x=m[c](I[T])),x.onerror=K}const A=I=>{const R=I.target.result;v.forEach((T,ke)=>T.error!=null&&(S[ke]=T.error)),g({numFailures:_,failures:S,results:c==="delete"?f:v.map(T=>T.result),lastResult:R})};x.onerror=I=>{K(I),A(I)},x.onsuccess=A})},getMany:({trans:h,keys:c})=>new Promise((f,b)=>{f=j(f);const p=h.objectStore(u),g=c.length,y=new Array(g);let m,w=0,k=0;const E=v=>{const S=v.target;y[S._pos]=S.result,++k===w&&f(y)},x=Q(b);for(let v=0;v<g;++v)c[v]!=null&&(m=p.get(c[v]),m._pos=v,m.onsuccess=E,m.onerror=x,++w);w===0&&f(y)}),get:({trans:h,key:c})=>new Promise((f,b)=>{f=j(f);const p=h.objectStore(u).get(c);p.onsuccess=g=>f(g.target.result),p.onerror=Q(b)}),query:function(h){return c=>new Promise((f,b)=>{f=j(f);const{trans:p,values:g,limit:y,query:m}=c,w=y===1/0?void 0:y,{index:k,range:E}=m,x=p.objectStore(u),v=k.isPrimaryKey?x:x.index(k.name),S=r(E);if(y===0)return f({result:[]});if(h){const _=g?v.getAll(S,w):v.getAllKeys(S,w);_.onsuccess=K=>f({result:K.target.result}),_.onerror=Q(b)}else{let _=0;const K=g||!("openKeyCursor"in v)?v.openCursor(S):v.openKeyCursor(S),A=[];K.onsuccess=I=>{const R=K.result;return R?(A.push(g?R.value:R.primaryKey),++_===y?f({result:A}):void R.continue()):f({result:A})},K.onerror=Q(b)}})}(a),openCursor:function({trans:h,values:c,query:f,reverse:b,unique:p}){return new Promise((g,y)=>{g=j(g);const{index:m,range:w}=f,k=h.objectStore(u),E=m.isPrimaryKey?k:k.index(m.name),x=b?p?"prevunique":"prev":p?"nextunique":"next",v=c||!("openKeyCursor"in E)?E.openCursor(r(w),x):E.openKeyCursor(r(w),x);v.onerror=Q(y),v.onsuccess=j(S=>{const _=v.result;if(!_)return void g(null);_.___id=++As,_.done=!1;const K=_.continue.bind(_);let A=_.continuePrimaryKey;A&&(A=A.bind(_));const I=_.advance.bind(_),R=()=>{throw new Error("Cursor not stopped")};_.trans=h,_.stop=_.continue=_.continuePrimaryKey=_.advance=()=>{throw new Error("Cursor not started")},_.fail=j(y),_.next=function(){let T=1;return this.start(()=>T--?this.continue():this.stop()).then(()=>this)},_.start=T=>{const ke=new Promise((U,he)=>{U=j(U),v.onerror=Q(he),_.fail=he,_.stop=Ie=>{_.stop=_.continue=_.continuePrimaryKey=_.advance=R,U(Ie)}}),Ee=()=>{if(v.result)try{T()}catch(U){_.fail(U)}else _.done=!0,_.start=()=>{throw new Error("Cursor behind last entry")},_.stop()};return v.onsuccess=j(U=>{v.onsuccess=Ee,Ee()}),_.continue=K,_.continuePrimaryKey=A,_.advance=I,Ee(),ke},g(_)},y)})},count({query:h,trans:c}){const{index:f,range:b}=h;return new Promise((p,g)=>{const y=c.objectStore(u),m=f.isPrimaryKey?y:y.index(f.name),w=r(b),k=w?m.count(w):m.count();k.onsuccess=j(E=>p(E.target.result)),k.onerror=Q(g)})}}}(o)),l={};return i.forEach(o=>l[o.name]=o),{stack:"dbcore",transaction:t.transaction.bind(t),table(o){if(!l[o])throw new Error(`Table '${o}' not found`);return l[o]},MIN_KEY:-1/0,MAX_KEY:Xe(e),schema:s}}function nn({_novip:t},e){const n=e.db,r=function(s,a,{IDBKeyRange:i,indexedDB:l},o){return{dbcore:function(u,h){return h.reduce((c,{create:f})=>({...c,...f(c)}),u)}(Ks(a,i,o),s.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(s=>{const a=s.name;t.core.schema.tables.some(i=>i.name===a)&&(s.core=t.core.table(a),t[a]instanceof t.Table&&(t[a].core=s.core))})}function Ct({_novip:t},e,n,r){n.forEach(s=>{const a=r[s];e.forEach(i=>{const l=mn(i,s);(!l||"value"in l&&l.value===void 0)&&(i===t.Transaction.prototype||i instanceof t.Transaction?ne(i,s,{get(){return this.table(s)},set(o){Jn(this,s,{value:o,writable:!0,configurable:!0,enumerable:!0})}}):i[s]=new t.Table(s,a))})})}function rn({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Ds(t,e){return t._cfg.version-e._cfg.version}function Bs(t,e,n,r){const s=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,s);a.create(n),a._completion.catch(r);const i=a._reject.bind(a),l=C.transless||C;ue(()=>{C.trans=a,C.transless=l,e===0?(M(s).forEach(o=>{Ft(n,o,s[o].primKey,s[o].indexes)}),nn(t,n),P.follow(()=>t.on.populate.fire(a)).catch(i)):function({_novip:o},d,u,h){const c=[],f=o._versions;let b=o._dbSchema=an(o,o.idbdb,h),p=!1;const g=f.filter(m=>m._cfg.version>=d);function y(){return c.length?P.resolve(c.shift()(u.idbtrans)).then(y):P.resolve()}return g.forEach(m=>{c.push(()=>{const w=b,k=m._cfg.dbschema;on(o,w,h),on(o,k,h),b=o._dbSchema=k;const E=Pr(w,k);E.add.forEach(v=>{Ft(h,v[0],v[1].primKey,v[1].indexes)}),E.change.forEach(v=>{if(v.recreate)throw new O.Upgrade("Not yet support for changing primary key");{const S=h.objectStore(v.name);v.add.forEach(_=>sn(S,_)),v.change.forEach(_=>{S.deleteIndex(_.name),sn(S,_)}),v.del.forEach(_=>S.deleteIndex(_))}});const x=m._cfg.contentUpgrade;if(x&&m._cfg.version>d){nn(o,h),u._memoizedTables={},p=!0;let v=nr(k);E.del.forEach(A=>{v[A]=w[A]}),rn(o,[o.Transaction.prototype]),Ct(o,[o.Transaction.prototype],M(v),v),u.schema=v;const S=yn(x);let _;S&&Be();const K=P.follow(()=>{if(_=x(u),_&&S){var A=se.bind(null,null);_.then(A,A)}});return _&&typeof _.then=="function"?P.resolve(_):K.then(()=>_)}}),c.push(w=>{(!p||!_s)&&function(k,E){[].slice.call(E.db.objectStoreNames).forEach(x=>k[x]==null&&E.db.deleteObjectStore(x))}(m._cfg.dbschema,w),rn(o,[o.Transaction.prototype]),Ct(o,[o.Transaction.prototype],o._storeNames,o._dbSchema),u.schema=o._dbSchema})}),y().then(()=>{var m,w;w=h,M(m=b).forEach(k=>{w.db.objectStoreNames.contains(k)||Ft(w,k,m[k].primKey,m[k].indexes)})})}(t,e,a,n).catch(i)})}function Pr(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const s=t[r],a=e[r];if(s){const i={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||s.primKey.auto!==a.primKey.auto&&!At)i.recreate=!0,n.change.push(i);else{const l=s.idxByName,o=a.idxByName;let d;for(d in l)o[d]||i.del.push(d);for(d in o){const u=l[d],h=o[d];u?u.src!==h.src&&i.change.push(h):i.add.push(h)}(i.del.length>0||i.add.length>0||i.change.length>0)&&n.change.push(i)}}else n.add.push([r,a])}return n}function Ft(t,e,n,r){const s=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(a=>sn(s,a)),s}function sn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function an(t,e,n){const r={};return wt(e.objectStoreNames,0).forEach(s=>{const a=n.objectStore(s);let i=a.keyPath;const l=en(kr(i),i||"",!1,!1,!!a.autoIncrement,i&&typeof i!="string",!0),o=[];for(let u=0;u<a.indexNames.length;++u){const h=a.index(a.indexNames[u]);i=h.keyPath;var d=en(h.name,i,!!h.unique,!!h.multiEntry,!1,i&&typeof i!="string",!1);o.push(d)}r[s]=Er(s,l,o)}),r}function on({_novip:t},e,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const a=r[s],i=n.objectStore(a);t._hasGetAll="getAll"in i;for(let l=0;l<i.indexNames.length;++l){const o=i.indexNames[l],d=i.index(o).keyPath,u=typeof d=="string"?d:"["+wt(d).join("+")+"]";if(e[a]){const h=e[a].idxByName[u];h&&(h.name=o,delete e[a].idxByName[u],e[a].idxByName[o]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&B.WorkerGlobalScope&&B instanceof B.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class js{_parseStoresSpec(e,n){M(e).forEach(r=>{if(e[r]!==null){var s=e[r].split(",").map((i,l)=>{const o=(i=i.trim()).replace(/([&*]|\+\+)/g,""),d=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return en(o,d||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),V(d),l===0)}),a=s.shift();if(a.multi)throw new O.Schema("Primary key cannot be multi-valued");s.forEach(i=>{if(i.auto)throw new O.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new O.Schema("Index must have a name and cannot be an empty string")}),n[r]=Er(r,a,s)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?L(this._cfg.storesSource,e):e;const r=n._versions,s={};let a={};return r.forEach(i=>{L(s,i._cfg.storesSource),a=i._cfg.dbschema={},i._parseStoresSpec(s,a)}),n._dbSchema=a,rn(n,[n._allTables,n,n.Transaction.prototype]),Ct(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],M(a),a),n._storeNames=M(a),this}upgrade(e){return this._cfg.contentUpgrade=bn(this._cfg.contentUpgrade||D,e),this}}function kn(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new be(Kt,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function En(t){return t&&typeof t.databases=="function"}function ln(t){return ue(function(){return C.letThrough=!0,t()})}function Is(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function Ts(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?F(e.dbOpenError):t);X&&(e.openCanceller._stackHolder=xe()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new O.DatabaseClosed("db.open() was cancelled")}let a=e.dbReadyResolve,i=null,l=!1;const o=()=>new P((d,u)=>{if(s(),!n)throw new O.MissingAPI;const h=t.name,c=e.autoSchema?n.open(h):n.open(h,Math.round(10*t.verno));if(!c)throw new O.MissingAPI;c.onerror=Q(u),c.onblocked=j(t._fireOnBlocked),c.onupgradeneeded=j(f=>{if(i=c.transaction,e.autoSchema&&!t._options.allowEmptyDB){c.onerror=Ge,i.abort(),c.result.close();const p=n.deleteDatabase(h);p.onsuccess=p.onerror=j(()=>{u(new O.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{i.onerror=Q(u);var b=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;l=b<1,t._novip.idbdb=c.result,Bs(t,b/10,i,u)}},u),c.onsuccess=j(()=>{i=null;const f=t._novip.idbdb=c.result,b=wt(f.objectStoreNames);if(b.length>0)try{const g=f.transaction((p=b).length===1?p[0]:p,"readonly");e.autoSchema?function({_novip:y},m,w){y.verno=m.version/10;const k=y._dbSchema=an(0,m,w);y._storeNames=wt(m.objectStoreNames,0),Ct(y,[y._allTables],M(k),k)}(t,f,g):(on(t,t._dbSchema,g),function(y,m){const w=Pr(an(0,y.idbdb,m),y._dbSchema);return!(w.add.length||w.change.some(k=>k.add.length||k.change.length))}(t,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),nn(t,g)}catch{}var p;Ve.push(t),f.onversionchange=j(g=>{e.vcFired=!0,t.on("versionchange").fire(g)}),f.onclose=j(g=>{t.on("close").fire(g)}),l&&function({indexedDB:g,IDBKeyRange:y},m){!En(g)&&m!==Kt&&kn(g,y).put({name:m}).catch(D)}(t._deps,h),d()},u)}).catch(d=>d&&d.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),o()):P.reject(d));return P.race([r,(typeof navigator>"u"?P.resolve():Is()).then(o)]).then(()=>(s(),e.onReadyBeingFired=[],P.resolve(ln(()=>t.on.ready.fire(t.vip))).then(function d(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(bn,D);return e.onReadyBeingFired=[],P.resolve(ln(()=>u(t.vip))).then(d)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(d=>{e.dbOpenError=d;try{i&&i.abort()}catch{}return r===e.openCanceller&&t._close(),F(d)}).finally(()=>{e.openComplete=!0,a()})}function un(t){var e=a=>t.next(a),n=s(e),r=s(a=>t.throw(a));function s(a){return i=>{var l=a(i),o=l.value;return l.done?o:o&&typeof o.then=="function"?o.then(n,r):V(o)?Promise.all(o).then(n,r):n(o)}}return s(e)()}function Rs(t,e,n){var r=arguments.length;if(r<2)throw new O.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];return n=s.pop(),[t,rr(s),n]}function Cr(t,e,n,r,s){return P.resolve().then(()=>{const a=C.transless||C,i=t._createTransaction(e,n,t._dbSchema,r),l={trans:i,transless:a};if(r)i.idbtrans=r.idbtrans;else try{i.create(),t._state.PR1398_maxLoop=3}catch(h){return h.name===vn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Cr(t,e,n,null,s))):F(h)}const o=yn(s);let d;o&&Be();const u=P.follow(()=>{if(d=s.call(i,i),d)if(o){var h=se.bind(null,null);d.then(h,h)}else typeof d.next=="function"&&typeof d.throw=="function"&&(d=un(d))},l);return(d&&typeof d.then=="function"?P.resolve(d).then(h=>i.active?h:F(new O.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>d)).then(h=>(r&&i._resolve(),i._completion.then(()=>h))).catch(h=>(i._reject(h),F(h)))})}function ct(t,e,n){const r=V(t)?t.slice():[t];for(let s=0;s<n;++s)r.push(e);return r}const Ms={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,s={},a=[];function i(u,h,c){const f=Le(u),b=s[f]=s[f]||[],p=u==null?0:typeof u=="string"?1:u.length,g=h>0,y={...c,isVirtual:g,keyTail:h,keyLength:p,extractKey:tn(u),unique:!g&&c.unique};return b.push(y),y.isPrimaryKey||a.push(y),p>1&&i(p===2?u[0]:u.slice(0,p-1),h+1,c),b.sort((m,w)=>m.keyTail-w.keyTail),y}const l=i(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[l];for(const u of r.indexes)i(u.keyPath,0,u);function o(u){const h=u.query.index;return h.isVirtual?{...u,query:{index:h,range:(c=u.query.range,f=h.keyTail,{type:c.type===1?2:c.type,lower:ct(c.lower,c.lowerOpen?t.MAX_KEY:t.MIN_KEY,f),lowerOpen:!0,upper:ct(c.upper,c.upperOpen?t.MIN_KEY:t.MAX_KEY,f),upperOpen:!0})}}:u;var c,f}return{...n,schema:{...r,primaryKey:l,indexes:a,getIndexByKeyPath:function(u){const h=s[Le(u)];return h&&h[0]}},count:u=>n.count(o(u)),query:u=>n.query(o(u)),openCursor(u){const{keyTail:h,isVirtual:c,keyLength:f}=u.query.index;return c?n.openCursor(o(u)).then(b=>b&&function(p){return Object.create(p,{continue:{value:function(y){y!=null?p.continue(ct(y,u.reverse?t.MAX_KEY:t.MIN_KEY,h)):u.unique?p.continue(p.key.slice(0,f).concat(u.reverse?t.MIN_KEY:t.MAX_KEY,h)):p.continue()}},continuePrimaryKey:{value(y,m){p.continuePrimaryKey(ct(y,t.MAX_KEY,h),m)}},primaryKey:{get:()=>p.primaryKey},key:{get(){const y=p.key;return f===1?y[0]:y.slice(0,f)}},value:{get:()=>p.value}})}(b)):n.openCursor(u)}}}}}};function Pn(t,e,n,r){return n=n||{},r=r||"",M(t).forEach(s=>{if(H(e,s)){var a=t[s],i=e[s];if(typeof a=="object"&&typeof i=="object"&&a&&i){const l=Vt(a);l!==Vt(i)?n[r+s]=e[s]:l==="Object"?Pn(a,i,n,r+s+"."):a!==i&&(n[r+s]=e[s])}else a!==i&&(n[r+s]=e[s])}else n[r+s]=void 0}),M(e).forEach(s=>{H(t,s)||(n[r+s]=e[s])}),n}const Fs={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(a){const i=C.trans,{deleting:l,creating:o,updating:d}=i.table(e).hook;switch(a.type){case"add":if(o.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"put":if(o.fire===D&&d.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"delete":if(l.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"deleteRange":if(l.fire===D)break;return i._promise("readwrite",()=>function(c){return h(c.trans,c.range,1e4)}(a),!0)}return n.mutate(a);function u(c){const f=C.trans,b=c.keys||function(p,g){return g.type==="delete"?g.keys:g.keys||g.values.map(p.extractKey)}(r,c);if(!b)throw new Error("Keys missing");return(c=c.type==="add"||c.type==="put"?{...c,keys:b}:{...c}).type!=="delete"&&(c.values=[...c.values]),c.keys&&(c.keys=[...c.keys]),function(p,g,y){return g.type==="add"?Promise.resolve([]):p.getMany({trans:g.trans,keys:y,cache:"immutable"})}(n,c,b).then(p=>{const g=b.map((y,m)=>{const w=p[m],k={onerror:null,onsuccess:null};if(c.type==="delete")l.fire.call(k,y,w,f);else if(c.type==="add"||w===void 0){const E=o.fire.call(k,y,c.values[m],f);y==null&&E!=null&&(y=E,c.keys[m]=y,r.outbound||G(c.values[m],r.keyPath,y))}else{const E=Pn(w,c.values[m]),x=d.fire.call(k,E,y,w,f);if(x){const v=c.values[m];Object.keys(x).forEach(S=>{H(v,S)?v[S]=x[S]:G(v,S,x[S])})}}return k});return n.mutate(c).then(({failures:y,results:m,numFailures:w,lastResult:k})=>{for(let E=0;E<b.length;++E){const x=m?m[E]:b[E],v=g[E];x==null?v.onerror&&v.onerror(y[E]):v.onsuccess&&v.onsuccess(c.type==="put"&&p[E]?c.values[E]:x)}return{failures:y,results:m,numFailures:w,lastResult:k}}).catch(y=>(g.forEach(m=>m.onerror&&m.onerror(y)),Promise.reject(y)))})}function h(c,f,b){return n.query({trans:c,values:!1,query:{index:r,range:f},limit:b}).then(({result:p})=>u({type:"delete",keys:p,trans:c}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):p.length<b?{failures:[],numFailures:0,lastResult:void 0}:h(c,{...f,lower:p[p.length-1],lowerOpen:!0},b)))}}}}})};function Or(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let s=0,a=0;s<e.keys.length&&a<t.length;++s)$(e.keys[s],t[a])===0&&(r.push(n?Ze(e.values[s]):e.values[s]),++a);return r.length===t.length?r:null}catch{return null}}const Ns={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=Or(r.keys,r.trans._cache,r.cache==="clone");return s?P.resolve(s):n.getMany(r).then(a=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Ze(a):a},a))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Cn(t){return!("from"in t)}const Z=function(t,e){if(!this){const n=new Z;return t&&"d"in t&&L(n,t),n}L(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Je(t,e,n){const r=$(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Cn(t))return L(t,{from:e,to:n,d:1});const s=t.l,a=t.r;if($(n,t.from)<0)return s?Je(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Ln(t);if($(e,t.to)>0)return a?Je(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Ln(t);$(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),$(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const i=!t.r;s&&!t.l&&Ot(t,s),a&&i&&Ot(t,a)}function Ot(t,e){Cn(e)||function n(r,{from:s,to:a,l:i,r:l}){Je(r,s,a),i&&n(r,i),l&&n(r,l)}(t,e)}function qs(t,e){const n=cn(e);let r=n.next();if(r.done)return!1;let s=r.value;const a=cn(t);let i=a.next(s.from),l=i.value;for(;!r.done&&!i.done;){if($(l.from,s.to)<=0&&$(l.to,s.from)>=0)return!0;$(s.from,l.from)<0?s=(r=n.next(l.from)).value:l=(i=a.next(s.from)).value}return!1}function cn(t){let e=Cn(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&$(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||$(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Ln(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const a=s==="r"?"l":"r",i={...t},l=t[s];t.from=l.from,t.to=l.to,t[s]=l[s],i[s]=l[a],t[a]=i,i.d=Un(i)}t.d=Un(t)}function Un({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}De(Z.prototype,{add(t){return Ot(this,t),this},addKey(t){return Je(this,t,t),this},addKeys(t){return t.forEach(e=>Je(this,e,e)),this},[$t](){return cn(this)}});const Vs={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new Z(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const s=t.table(r),{schema:a}=s,{primaryKey:i}=a,{extractKey:l,outbound:o}=i,d={...s,mutate:c=>{const f=c.trans,b=f.mutatedParts||(f.mutatedParts={}),p=x=>{const v=`idb://${e}/${r}/${x}`;return b[v]||(b[v]=new Z)},g=p(""),y=p(":dels"),{type:m}=c;let[w,k]=c.type==="deleteRange"?[c.range]:c.type==="delete"?[c.keys]:c.values.length<50?[[],c.values]:[];const E=c.trans._cache;return s.mutate(c).then(x=>{if(V(w)){m!=="delete"&&(w=x.results),g.addKeys(w);const v=Or(w,E);v||m==="add"||y.addKeys(w),(v||k)&&function(S,_,K,A){function I(R){const T=S(R.name||"");function ke(U){return U!=null?R.extractKey(U):null}const Ee=U=>R.multiEntry&&V(U)?U.forEach(he=>T.addKey(he)):T.addKey(U);(K||A).forEach((U,he)=>{const Ie=K&&ke(K[he]),Dt=A&&ke(A[he]);$(Ie,Dt)!==0&&(Ie!=null&&Ee(Ie),Dt!=null&&Ee(Dt))})}_.indexes.forEach(I)}(p,a,v,k)}else if(w){const v={from:w.lower,to:w.upper};y.add(v),g.add(v)}else g.add(n),y.add(n),a.indexes.forEach(v=>p(v.name).add(n));return x})}},u=({query:{index:c,range:f}})=>{var b,p;return[c,new Z((b=f.lower)!==null&&b!==void 0?b:t.MIN_KEY,(p=f.upper)!==null&&p!==void 0?p:t.MAX_KEY)]},h={get:c=>[i,new Z(c.key)],getMany:c=>[i,new Z().addKeys(c.keys)],count:u,query:u,openCursor:u};return M(h).forEach(c=>{d[c]=function(f){const{subscr:b}=C;if(b){const p=k=>{const E=`idb://${e}/${r}/${k}`;return b[E]||(b[E]=new Z)},g=p(""),y=p(":dels"),[m,w]=h[c](f);if(p(m.name||"").add(w),!m.isPrimaryKey){if(c!=="count"){const k=c==="query"&&o&&f.values&&s.query({...f,values:!1});return s[c].apply(this,arguments).then(E=>{if(c==="query"){if(o&&f.values)return k.then(({result:v})=>(g.addKeys(v),E));const x=f.values?E.result.map(l):E.result;f.values?g.addKeys(x):y.addKeys(x)}else if(c==="openCursor"){const x=E,v=f.values;return x&&Object.create(x,{key:{get:()=>(y.addKey(x.primaryKey),x.key)},primaryKey:{get(){const S=x.primaryKey;return y.addKey(S),S}},value:{get:()=>(v&&g.addKey(x.primaryKey),x.value)}})}return E})}y.add(n)}}return s[c].apply(this,arguments)}}),d}}}};class be{constructor(e,n){this._middlewares={},this.verno=0;const r=be.dependencies;this._options=n={addons:be.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:D,dbReadyPromise:null,cancelOpen:D,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;a.dbReadyPromise=new P(l=>{a.dbReadyResolve=l}),a.openCanceller=new P((l,o)=>{a.cancelOpen=o}),this._state=a,this.name=e,this.on=$e(this,"populate","blocked","versionchange","close",{ready:[bn,D]}),this.on.ready.subscribe=Zn(this.on.ready.subscribe,l=>(o,d)=>{be.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||P.resolve().then(o),d&&l(o);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(o),d&&l(o);else{l(o);const h=this;d||l(function c(){h.on.ready.unsubscribe(o),h.on.ready.unsubscribe(c)})}})}),this.Collection=(i=this,Te(Es.prototype,function(l,o){this.db=i;let d=wr,u=null;if(o)try{d=o()}catch(b){u=b}const h=l._ctx,c=h.table,f=c.hook.reading.fire;this._ctx={table:c,index:h.index,isPrimKey:!h.index||c.schema.primKey.keyPath&&h.index===c.schema.primKey.name,range:d,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:h.or,valueMapper:f!==Ye?f:null}})),this.Table=function(l){return Te(ks.prototype,function(o,d,u){this.db=l,this._tx=u,this.name=o,this.schema=d,this.hook=l._allTables[o]?l._allTables[o].hook:$e(null,{creating:[ds,D],reading:[cs,Ye],updating:[fs,D],deleting:[hs,D]})})}(this),this.Transaction=function(l){return Te(Ss.prototype,function(o,d,u,h,c){this.db=l,this.mode=o,this.storeNames=d,this.schema=u,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=$e(this,"complete","error","abort"),this.parent=c||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new P((f,b)=>{this._resolve=f,this._reject=b}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var b=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):b&&this.idbtrans&&this.idbtrans.abort(),F(f)})})}(this),this.Version=function(l){return Te(js.prototype,function(o){this.db=l,this._cfg={version:o,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(l){return Te(xr.prototype,function(o,d,u){this.db=l,this._ctx={table:o,index:d===":id"?null:d,or:u};const h=l._deps.indexedDB;if(!h)throw new O.MissingAPI;this._cmp=this._ascending=h.cmp.bind(h),this._descending=(c,f)=>h.cmp(f,c),this._max=(c,f)=>h.cmp(c,f)>0?c:f,this._min=(c,f)=>h.cmp(c,f)<0?c:f,this._IDBKeyRange=l._deps.IDBKeyRange})}(this),this.on("versionchange",l=>{l.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",l=>{!l.newVersion||l.newVersion<l.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${l.oldVersion/10}`)}),this._maxKey=Xe(n.IDBKeyRange),this._createTransaction=(l,o,d,u)=>new this.Transaction(l,o,d,this._options.chromeTransactionDurability,u),this._fireOnBlocked=l=>{this.on("blocked").fire(l),Ve.filter(o=>o.name===this.name&&o!==this&&!o._state.vcFired).map(o=>o.on("versionchange").fire(l))},this.use(Ms),this.use(Fs),this.use(Vs),this.use(Ns),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(l=>l(this))}version(e){if(isNaN(e)||e<.1)throw new O.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new O.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(s=>s._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ds),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||C.letThrough||this._vip)?e():new P((n,r)=>{if(this._state.openComplete)return r(new O.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new O.DatabaseClosed);this.open().catch(D)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:s}){s&&this.unuse({stack:e,name:s});const a=this._middlewares[e]||(this._middlewares[e]=[]);return a.push({stack:e,create:n,level:r??10,name:s}),a.sort((i,l)=>i.level-l.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return Ts(this)}_close(){const e=this._state,n=Ve.indexOf(this);if(n>=0&&Ve.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new P(r=>{e.dbReadyResolve=r}),e.openCanceller=new P((r,s)=>{e.cancelOpen=s})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new O.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new P((r,s)=>{const a=()=>{this.close();var i=this._deps.indexedDB.deleteDatabase(this.name);i.onsuccess=j(()=>{(function({indexedDB:l,IDBKeyRange:o},d){!En(l)&&d!==Kt&&kn(l,o).delete(d).catch(D)})(this._deps,this.name),r()}),i.onerror=Q(s),i.onblocked=this._fireOnBlocked};if(e)throw new O.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(a):a()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return M(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Rs.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let s=C.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const a=e.indexOf("?")!==-1;let i,l;e=e.replace("!","").replace("?","");try{if(l=n.map(d=>{var u=d instanceof this.Table?d.name:d;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===jt)i=jt;else{if(e!="rw"&&e!=It)throw new O.InvalidArgument("Invalid transaction mode: "+e);i=It}if(s){if(s.mode===jt&&i===It){if(!a)throw new O.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&l.forEach(d=>{if(s&&s.storeNames.indexOf(d)===-1){if(!a)throw new O.SubTransaction("Table "+d+" not included in parent transaction.");s=null}}),a&&s&&!s.active&&(s=null)}}catch(d){return s?s._promise(null,(u,h)=>{h(d)}):F(d)}const o=Cr.bind(null,this,i,l,s,r);return s?s._promise(i,o,"lock"):C.trans?je(C.transless,()=>this._whenReady(o)):this._whenReady(o)}table(e){if(!H(this._allTables,e))throw new O.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const $s=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Ls{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[$s](){return this}}function Sr(t,e){return M(e).forEach(n=>{Ot(t[n]||(t[n]=new Z),e[n])}),t}function Us(t){let e,n=!1;const r=new Ls(s=>{const a=yn(t);let i=!1,l={},o={};const d={get closed(){return i},unsubscribe:()=>{i=!0,de.storagemutated.unsubscribe(f)}};s.start&&s.start(d);let u=!1,h=!1;function c(){return M(o).some(p=>l[p]&&qs(l[p],o[p]))}const f=p=>{Sr(l,p),c()&&b()},b=()=>{if(u||i)return;l={};const p={},g=function(y){a&&Be();const m=()=>ue(t,{subscr:y,trans:null}),w=C.trans?je(C.transless,m):m();return a&&w.then(se,se),w}(p);h||(de(Qe,f),h=!0),u=!0,Promise.resolve(g).then(y=>{n=!0,e=y,u=!1,i||(c()?b():(l={},o=p,s.next&&s.next(y)))},y=>{u=!1,n=!1,s.error&&s.error(y),d.unsubscribe()})};return b(),d});return r.hasValue=()=>n,r.getValue=()=>e,r}let dn;try{dn={indexedDB:B.indexedDB||B.mozIndexedDB||B.webkitIndexedDB||B.msIndexedDB,IDBKeyRange:B.IDBKeyRange||B.webkitIDBKeyRange}}catch{dn={indexedDB:null,IDBKeyRange:null}}const fe=be;function bt(t){let e=te;try{te=!0,de.storagemutated.fire(t)}finally{te=e}}De(fe,{...ft,delete:t=>new fe(t,{addons:[]}).delete(),exists:t=>new fe(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return En(e)?Promise.resolve(e.databases()).then(r=>r.map(s=>s.name).filter(s=>s!==Kt)):kn(e,n).toCollection().primaryKeys()}(fe.dependencies).then(t)}catch{return F(new O.MissingAPI)}},defineClass:()=>function(t){L(this,t)},ignoreTransaction:t=>C.trans?je(C.transless,t):t(),vip:ln,async:function(t){return function(){try{var e=un(t.apply(this,arguments));return e&&typeof e.then=="function"?e:P.resolve(e)}catch(n){return F(n)}}},spawn:function(t,e,n){try{var r=un(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:P.resolve(r)}catch(s){return F(s)}},currentTransaction:{get:()=>C.trans||null},waitFor:function(t,e){const n=P.resolve(typeof t=="function"?fe.ignoreTransaction(t):t).timeout(e||6e4);return C.trans?C.trans.waitFor(n):n},Promise:P,debug:{get:()=>X,set:t=>{ar(t,t==="dexie"?()=>!0:br)}},derive:Se,extend:L,props:De,override:Zn,Events:$e,on:de,liveQuery:Us,extendObservabilitySet:Sr,getByKeyPath:re,setByKeyPath:G,delByKeyPath:function(t,e){typeof e=="string"?G(t,e,void 0):"length"in e&&[].map.call(e,function(n){G(t,n,void 0)})},shallowClone:nr,deepClone:Ze,getObjectDiff:Pn,cmp:$,asap:er,minKey:Zt,addons:[],connections:Ve,errnames:vn,dependencies:dn,semVer:Mn,version:Mn.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),fe.maxKey=Xe(fe.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(de(Qe,t=>{if(!te){let e;At?(e=document.createEvent("CustomEvent"),e.initCustomEvent(le,!0,!0,t)):e=new CustomEvent(le,{detail:t}),te=!0,dispatchEvent(e),te=!1}}),addEventListener(le,({detail:t})=>{te||bt(t)}));let te=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(le);typeof t.unref=="function"&&t.unref(),de(Qe,e=>{te||t.postMessage(e)}),t.onmessage=e=>{e.data&&bt(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){de(Qe,e=>{try{te||(typeof localStorage<"u"&&localStorage.setItem(le,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:le,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===le){const n=JSON.parse(e.newValue);n&&bt(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===le&&bt(e.changedParts)})}P.rejectionMapper=function(t,e){if(!t||t instanceof Ae||t instanceof TypeError||t instanceof SyntaxError||!t.name||!jn[t.name])return t;var n=new jn[t.name](e||t.message,t);return"stack"in t&&ne(n,"stack",{get:function(){return this.inner.stack}}),n},ar(X,br);const Ar={flows:"&id, title, description, data, folder, tags, metadata, thumbnail, createtime, updatetime",files:"&id, name, size, type, data, metadata, createtime",folders:"&id, name, description, createtime, updatetime",tags:"&id, name, description, createtime, updatetime",app:"&id, name, data, flowid, folder, description, thumbnail, createtime, updatetime"},zs={...Ar,files:"&id, name, size, type, data, metadata, parentid, createtime"};class Ws extends be{constructor(){super("ComfyDB");ae(this,"flows");ae(this,"files");ae(this,"folders");ae(this,"tags");ae(this,"app");this.version(1).stores(Ar),this.version(2).stores(zs)}}const Ys=new Ws;class nt{constructor(e,n=Ys){ae(this,"db");ae(this,"_tablename");this.db=n,this._tablename=e}get table(){return this.db[this._tablename]}async _add(e,n=Zr()){const r=this._tablename,s={...e,id:n,createtime:Date.now(),updatetime:Date.now()};return{id:await this.db[r].add(s)}}async _update(e,n){return{result:await this.table.update(e,{...n,updatetime:Date.now()})}}}class Hs extends nt{constructor(){super("app")}async create(e){const n=await this.findByFlowId(e.flowid),r=n.length?Math.max(...n.map(s=>s.version))+1:1;return this._add({...e,version:r})}async findById(e){return this.table.get(e)}async query({folderId:e,keyword:n}){let r=[];return e?r=await this.table.where("folder").equals(e).toArray():r=await this.table.toArray(),n&&(r=r.filter(s=>s.name.includes(n)||s.description&&s.description.includes(n))),r.sort((s,a)=>a.updatetime-s.updatetime)}async findByFlowId(e){return(await this.table.where("flowid").equals(e).toArray()).sort((n,r)=>r.updatetime-n.updatetime)}async updateData(e,n){return this.table.update(e,{data:n})}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}const pa=new Hs;class Gs extends nt{constructor(){super("files")}async create(e){return this._add(e)}async findById(e){return this.table.get(e)}async findByParentId(e){return this.table.where({parentid:e}).toArray()}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}const ma=new Gs;class Qs extends nt{constructor(){super("flows")}async create({name:e,description:n,data:r,folder:s,tags:a}){return await this._add({name:e,description:n,data:r,folder:s??"",tags:a??[],metadata:{}})}async findById(e){return this.table.get(e)}async query({folderId:e,tagIds:n,keyword:r}){let s=[];return n?e?s=await this.table.where("folder").equals(e).and(a=>n.every(i=>a.tags.includes(i))).toArray():s=await this.table.filter(a=>n.every(i=>a.tags.includes(i))).toArray():e?s=await this.table.where("folder").equals(e).toArray():s=await this.table.toArray(),r&&(s=s.filter(a=>a.name.includes(r)||a.description&&a.description.includes(r))),s.sort((a,i)=>i.updatetime-a.updatetime)}async update(e,n){return this._update(e,n)}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}const ya=new Qs;class Xs extends nt{constructor(){super("folders")}async create(e){return this._add(e)}async findById(e){return this.table.get(e)}async update(e,n){return this._update(e,n)}async queryAll(){return this.table.toArray()}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}const ga=new Xs;class Js extends nt{constructor(){super("tags")}async create(e){return this._add(e)}async findById(e){return this.table.get(e)}async update(e,n){return this._update(e,n)}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}new Js;const va=St({__name:"Dialog",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(t,{emit:e}){const s=zn(t,e);return(a,i)=>(ye(),dt(W(Mr),Tr(Rr(W(s))),{default:ht(()=>[Wn(a.$slots,"default")]),_:3},16))}});function Zs(t,e){return ye(),hn("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[Yn("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor"})])}const ea=Yn("span",{class:"sr-only"},"Close",-1),ba=St({__name:"DialogContent",props:{forceMount:{type:Boolean},trapFocus:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{},class:{},overlay:{type:Boolean},hideClose:{type:Boolean}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(t,{emit:e}){const n=t,r=e,s=Ue(()=>{const{class:i,...l}=n;return l}),a=zn(s,r);return(i,l)=>(ye(),dt(W($r),null,{default:ht(()=>[i.overlay?(ye(),dt(W(Fr),{key:0,class:"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"})):An("",!0),Kn(W(Nr),qr(W(a),{class:W(fn)("fixed left-1/2 top-1/2 z-50 grid w-full -translate-x-1/2 -translate-y-1/2 gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg outline-none",n.class)}),{default:ht(()=>[Wn(i.$slots,"default"),n.hideClose?An("",!0):(ye(),dt(W(Vr),{key:0,class:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"},{default:ht(()=>[Kn(W(Zs),{class:"w-4 h-4"}),ea]),_:1}))]),_:3},16,["class"])]),_:3}))}});function Kr(t){return Hn()?(zr(t),!0):!1}function ta(){const t=new Set,e=s=>{t.delete(s)};return{on:s=>{t.add(s);const a=()=>e(s);return Kr(a),{off:a}},off:e,trigger:(...s)=>Promise.all(Array.from(t).map(a=>a(...s)))}}function z(t){return typeof t=="function"?t():W(t)}const On=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const na=t=>typeof t<"u",ra=Object.prototype.toString,sa=t=>ra.call(t)==="[object Object]",Dr=()=>{},aa=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);function ia(t,e={}){if(!pn(t))return Lr(t);const n=Array.isArray(t.value)?Array.from({length:t.value.length}):{};for(const r in t.value)n[r]=Ur(()=>({get(){return t.value[r]},set(s){var a;if((a=z(e.replaceRef))!=null?a:!0)if(Array.isArray(t.value)){const l=[...t.value];l[r]=s,t.value=l}else{const l={...t.value,[r]:s};Object.setPrototypeOf(l,Object.getPrototypeOf(t.value)),t.value=l}else t.value[r]=s}}));return n}function oa(t){var e;const n=z(t);return(e=n==null?void 0:n.$el)!=null?e:n}const Sn=On?window:void 0,la=On?window.document:void 0;function me(...t){let e,n,r,s;if(typeof t[0]=="string"||Array.isArray(t[0])?([n,r,s]=t,e=Sn):[e,n,r,s]=t,!e)return Dr;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const a=[],i=()=>{a.forEach(u=>u()),a.length=0},l=(u,h,c,f)=>(u.addEventListener(h,c,f),()=>u.removeEventListener(h,c,f)),o=Nt(()=>[oa(e),z(s)],([u,h])=>{if(i(),!u)return;const c=sa(h)?{...h}:h;a.push(...n.flatMap(f=>r.map(b=>l(u,f,b,c))))},{immediate:!0,flush:"post"}),d=()=>{o(),i()};return Kr(d),d}function ua(t){return JSON.parse(JSON.stringify(t))}function wa(t,e={}){var n,r;const{pointerTypes:s,preventDefault:a,stopPropagation:i,exact:l,onMove:o,onEnd:d,onStart:u,initialValue:h,axis:c="both",draggingElement:f=Sn,containerElement:b,handle:p=t}=e,g=ze((n=z(h))!=null?n:{x:0,y:0}),y=ze(),m=v=>s?s.includes(v.pointerType):!0,w=v=>{z(a)&&v.preventDefault(),z(i)&&v.stopPropagation()},k=v=>{var S;if(!m(v)||z(l)&&v.target!==z(t))return;const _=z(b),K=(S=_==null?void 0:_.getBoundingClientRect)==null?void 0:S.call(_),A=z(t).getBoundingClientRect(),I={x:v.clientX-(_?A.left-K.left+_.scrollLeft:A.left),y:v.clientY-(_?A.top-K.top+_.scrollTop:A.top)};(u==null?void 0:u(I,v))!==!1&&(y.value=I,w(v))},E=v=>{var S;if(!m(v)||!y.value)return;const _=z(b),K=(S=_==null?void 0:_.getBoundingClientRect)==null?void 0:S.call(_),A=z(t).getBoundingClientRect();let{x:I,y:R}=g.value;(c==="x"||c==="both")&&(I=v.clientX-y.value.x,_&&(I=Math.min(Math.max(0,I),K.width+_.scrollLeft-A.width))),(c==="y"||c==="both")&&(R=v.clientY-y.value.y,_&&(R=Math.min(Math.max(0,R),K.height+_.scrollTop-A.height))),g.value={x:I,y:R},o==null||o(g.value,v),w(v)},x=v=>{m(v)&&y.value&&(y.value=void 0,d==null||d(g.value,v),w(v))};if(On){const v={capture:(r=e.capture)!=null?r:!0};me(p,"pointerdown",k,v),me(f,"pointermove",E,v),me(f,"pointerup",x,v)}return{...ia(g),position:g,isDragging:Ue(()=>!!y.value),style:Ue(()=>`left:${g.value.x}px;top:${g.value.y}px;`)}}const Re=new Map;function _a(t){const e=Hn();function n(l){var o;const d=Re.get(t)||new Set;d.add(l),Re.set(t,d);const u=()=>s(l);return(o=e==null?void 0:e.cleanups)==null||o.push(u),u}function r(l){function o(...d){s(o),l(...d)}return n(o)}function s(l){const o=Re.get(t);o&&(o.delete(l),o.size||a())}function a(){Re.delete(t)}function i(l,o){var d;(d=Re.get(t))==null||d.forEach(u=>u(l,o))}return{on:n,once:r,off:s,emit:i,reset:a}}const ca={multiple:!0,accept:"*",reset:!1,directory:!1};function xa(t={}){const{document:e=la}=t,n=ze(null),{on:r,trigger:s}=ta();let a;e&&(a=e.createElement("input"),a.type="file",a.onchange=o=>{const d=o.target;n.value=d.files,s(n.value)});const i=()=>{n.value=null,a&&(a.value="",s(null))},l=o=>{if(!a)return;const d={...ca,...t,...o};a.multiple=d.multiple,a.accept=d.accept,a.webkitdirectory=d.directory,aa(d,"capture")&&(a.capture=d.capture),d.reset&&i(),a.click()};return{files:Wr(n),open:l,reset:i,onChange:r}}const da={ctrl:"control",command:"meta",cmd:"meta",option:"alt",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"};function ka(t={}){const{reactive:e=!1,target:n=Sn,aliasMap:r=da,passive:s=!0,onEventFired:a=Dr}=t,i=Dn(new Set),l={toJSON(){return{}},current:i},o=e?Dn(l):l,d=new Set,u=new Set;function h(p,g){p in o&&(e?o[p]=g:o[p].value=g)}function c(){i.clear();for(const p of u)h(p,!1)}function f(p,g){var y,m;const w=(y=p.key)==null?void 0:y.toLowerCase(),E=[(m=p.code)==null?void 0:m.toLowerCase(),w].filter(Boolean);w&&(g?i.add(w):i.delete(w));for(const x of E)u.add(x),h(x,g);w==="meta"&&!g?(d.forEach(x=>{i.delete(x),h(x,!1)}),d.clear()):typeof p.getModifierState=="function"&&p.getModifierState("Meta")&&g&&[...i,...E].forEach(x=>d.add(x))}me(n,"keydown",p=>(f(p,!0),a(p)),{passive:s}),me(n,"keyup",p=>(f(p,!1),a(p)),{passive:s}),me("blur",c,{passive:!0}),me("focus",c,{passive:!0});const b=new Proxy(o,{get(p,g,y){if(typeof g!="string")return Reflect.get(p,g,y);if(g=g.toLowerCase(),g in r&&(g=r[g]),!(g in o))if(/[+_-]/.test(g)){const w=g.split(/[+_-]/g).map(k=>k.trim());o[g]=Ue(()=>w.every(k=>z(b[k])))}else o[g]=ze(!1);const m=Reflect.get(p,g,y);return e?z(m):m}});return b}function Br(t,e,n,r={}){var s,a,i;const{clone:l=!1,passive:o=!1,eventName:d,deep:u=!1,defaultValue:h,shouldEmit:c}=r,f=Hr(),b=n||(f==null?void 0:f.emit)||((s=f==null?void 0:f.$emit)==null?void 0:s.bind(f))||((i=(a=f==null?void 0:f.proxy)==null?void 0:a.$emit)==null?void 0:i.bind(f==null?void 0:f.proxy));let p=d;e||(e="modelValue"),p=p||`update:${e.toString()}`;const g=w=>l?typeof l=="function"?l(w):ua(w):w,y=()=>na(t[e])?g(t[e]):h,m=w=>{c?c(w)&&b(p,w):b(p,w)};if(o){const w=y(),k=ze(w);let E=!1;return Nt(()=>t[e],x=>{E||(E=!0,k.value=g(x),Yr(()=>E=!1))}),Nt(k,x=>{!E&&(x!==t[e]||u)&&m(x)},{deep:u}),k}else return Ue({get(){return y()},set(w){m(w)}})}const Ea=St({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const n=t,s=Br(n,"modelValue",e,{passive:!0,defaultValue:n.defaultValue});return(a,i)=>Gn((ye(),hn("textarea",{"onUpdate:modelValue":i[0]||(i[0]=l=>pn(s)?s.value=l:null),class:Xn(W(fn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n.class))},null,2)),[[Qn,W(s)]])}}),Pa=St({__name:"Input",props:{defaultValue:{},modelValue:{},class:{}},emits:["update:modelValue"],setup(t,{emit:e}){const n=t,s=Br(n,"modelValue",e,{passive:!0,defaultValue:n.defaultValue});return(a,i)=>Gn((ye(),hn("input",{"onUpdate:modelValue":i[0]||(i[0]=l=>pn(s)?s.value=l:null),class:Xn(W(fn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n.class))},null,2)),[[Qn,W(s)]])}});export{ya as F,Pa as _,_a as a,ga as b,Ea as c,ba as d,va as e,pa as f,wa as g,ma as h,xa as i,ka as u};
