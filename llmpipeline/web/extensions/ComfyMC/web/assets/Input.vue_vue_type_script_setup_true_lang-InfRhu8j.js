var Br=Object.defineProperty;var Tr=(t,e,n)=>e in t?Br(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var oe=(t,e,n)=>(Tr(t,typeof e!="symbol"?e+"":e,n),n);import{d as Ct,N as Wn,o as ge,i as dt,w as ht,j as Yn,B as Ir,C as jr,u as $,aV as Rr,a as pn,g as zn,h as We,aW as Mr,v as Sn,c as Kn,aX as Fr,m as Nr,e as mn,aB as qr,aY as Vr,aZ as Hn,a_ as $r,x as yn,a5 as Lr,a$ as Ur,q as re,aq as Wr,A as Vt,ao as Yr,ak as Dn,al as zr,av as Hr,E as Xn,b0 as Gn,n as Qn}from"./index-dV9wv7IE.js";let rt;const Xr=new Uint8Array(16);function Gr(){if(!rt&&(rt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!rt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return rt(Xr)}const N=[];for(let t=0;t<256;++t)N.push((t+256).toString(16).slice(1));function Qr(t,e=0){return N[t[e+0]]+N[t[e+1]]+N[t[e+2]]+N[t[e+3]]+"-"+N[t[e+4]]+N[t[e+5]]+"-"+N[t[e+6]]+N[t[e+7]]+"-"+N[t[e+8]]+N[t[e+9]]+"-"+N[t[e+10]]+N[t[e+11]]+N[t[e+12]]+N[t[e+13]]+N[t[e+14]]+N[t[e+15]]}const Jr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Bn={randomUUID:Jr};function Zr(t,e,n){if(Bn.randomUUID&&!e&&!t)return Bn.randomUUID();t=t||{};const r=t.random||(t.rng||Gr)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=r[s];return e}return Qr(r)}const B=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,M=Object.keys,V=Array.isArray;function W(t,e){return typeof e!="object"||M(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||B.Promise||(B.Promise=Promise);const Ye=Object.getPrototypeOf,es={}.hasOwnProperty;function X(t,e){return es.call(t,e)}function Be(t,e){typeof e=="function"&&(e=e(Ye(t))),(typeof Reflect>"u"?M:Reflect.ownKeys)(e).forEach(n=>{se(t,n,e[n])})}const Jn=Object.defineProperty;function se(t,e,n,r){Jn(t,e,W(n&&X(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Se(t){return{from:function(e){return t.prototype=Object.create(e.prototype),se(t.prototype,"constructor",t),{extend:Be.bind(null,t.prototype)}}}}const ts=Object.getOwnPropertyDescriptor;function gn(t,e){let n;return ts(t,e)||(n=Ye(t))&&gn(n,e)}const ns=[].slice;function wt(t,e,n){return ns.call(t,e,n)}function Zn(t,e){return e(t)}function Fe(t){if(!t)throw new Error("Assertion Failed")}function er(t){B.setImmediate?setImmediate(t):setTimeout(t,0)}function tr(t,e){return t.reduce((n,r,s)=>{var a=e(r,s);return a&&(n[a[0]]=a[1]),n},{})}function ae(t,e){if(typeof e=="string"&&X(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,s=e.length;r<s;++r){var a=ae(t,e[r]);n.push(a)}return n}var i=e.indexOf(".");if(i!==-1){var l=t[e.substr(0,i)];return l===void 0?void 0:ae(l,e.substr(i+1))}}function G(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Fe(typeof n!="string"&&"length"in n);for(var r=0,s=e.length;r<s;++r)G(t,e[r],n[r])}else{var a=e.indexOf(".");if(a!==-1){var i=e.substr(0,a),l=e.substr(a+1);if(l==="")n===void 0?V(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=n;else{var o=t[i];o&&X(t,i)||(o=t[i]={}),G(o,l,n)}}else n===void 0?V(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function nr(t){var e={};for(var n in t)X(t,n)&&(e[n]=t[n]);return e}const rs=[].concat;function rr(t){return rs.apply([],t)}const sr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(rr([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>B[t]),ss=sr.map(t=>B[t]);tr(sr,t=>[t,!0]);let ue=null;function Ze(t){ue=typeof WeakMap<"u"&&new WeakMap;const e=$t(t);return ue=null,e}function $t(t){if(!t||typeof t!="object")return t;let e=ue&&ue.get(t);if(e)return e;if(V(t)){e=[],ue&&ue.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push($t(t[n]))}else if(ss.indexOf(t.constructor)>=0)e=t;else{const a=Ye(t);for(var s in e=a===Object.prototype?{}:Object.create(a),ue&&ue.set(t,e),t)X(t,s)&&(e[s]=$t(t[s]))}return e}const{toString:as}={};function Lt(t){return as.call(t).slice(8,-1)}const Ut=typeof Symbol<"u"?Symbol.iterator:"@@iterator",is=typeof Ut=="symbol"?function(t){var e;return t!=null&&(e=t[Ut])&&e.apply(t)}:function(){return null},Ce={};function te(t){var e,n,r,s;if(arguments.length===1){if(V(t))return t.slice();if(this===Ce&&typeof t=="string")return[t];if(s=is(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const vn=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var J=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ar(t,e){J=t,ir=e}var ir=()=>!0;const os=!new Error("").stack;function ke(){if(os)try{throw ke.arguments,new Error}catch(t){return t}return new Error}function Wt(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(ir).map(r=>`
`+r).join("")):""}var or=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],bn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(or),ls={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ke(t,e){this._e=ke(),this.name=t,this.message=e}function lr(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join(`
`)}function _t(t,e,n,r){this._e=ke(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=lr(t,e)}function qe(t,e){this._e=ke(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=lr(t,e)}Se(Ke).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Wt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Se(_t).from(Ke),Se(qe).from(Ke);var wn=bn.reduce((t,e)=>(t[e]=e+"Error",t),{});const us=Ke;var A=bn.reduce((t,e)=>{var n=e+"Error";function r(s,a){this._e=ke(),this.name=n,s?typeof s=="string"?(this.message=`${s}${a?`
 `+a:""}`,this.inner=a||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=ls[e]||n,this.inner=null)}return Se(r).from(us),t[e]=r,t},{});A.Syntax=SyntaxError,A.Type=TypeError,A.Range=RangeError;var Tn=or.reduce((t,e)=>(t[e+"Error"]=A[e],t),{}),ft=bn.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=A[e]),t),{});function D(){}function ze(t){return t}function cs(t,e){return t==null||t===ze?e:function(n){return e(t(n))}}function _e(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ds(t,e){return t===D?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?_e(r,this.onsuccess):r),s&&(this.onerror=this.onerror?_e(s,this.onerror):s),a!==void 0?a:n}}function hs(t,e){return t===D?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?_e(n,this.onsuccess):n),r&&(this.onerror=this.onerror?_e(r,this.onerror):r)}}function fs(t,e){return t===D?e:function(n){var r=t.apply(this,arguments);W(n,r);var s=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?_e(s,this.onsuccess):s),a&&(this.onerror=this.onerror?_e(a,this.onerror):a),r===void 0?i===void 0?void 0:i:W(r,i)}}function ps(t,e){return t===D?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function _n(t,e){return t===D?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,s=arguments.length,a=new Array(s);s--;)a[s]=arguments[s];return n.then(function(){return e.apply(r,a)})}return e.apply(this,arguments)}}ft.ModifyError=_t,ft.DexieError=Ke,ft.BulkError=qe;var He={};const ur=100,[Yt,xt,zt]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Ye(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ye(e),t]})(),cr=xt&&xt.then,pt=Yt&&Yt.constructor,xn=!!zt;var Ht=!1,ms=zt?()=>{zt.then(st)}:B.setImmediate?setImmediate.bind(null,st):B.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{st(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(st,0)},Ve=function(t,e){Ne.push([t,e]),kt&&(ms(),kt=!1)},Xt=!0,kt=!0,ve=[],mt=[],Gt=null,Qt=ze,De={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Rn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Rn(t[0],t[1])}catch{}})}},O=De,Ne=[],be=0,yt=[];function P(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=D,this._lib=!1;var e=this._PSD=O;if(J&&(this._stackHolder=ke(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==He)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Zt(this,this._value))}this._state=null,this._value=null,++e.ref,hr(this,t)}const Jt={get:function(){var t=O,e=Et;function n(r,s){var a=!t.global&&(t!==O||e!==Et);const i=a&&!ie();var l=new P((o,c)=>{kn(this,new dr(Pt(r,t,a,i),Pt(s,t,a,i),o,c,t))});return J&&mr(l,this),l}return n.prototype=He,n},set:function(t){se(this,"then",t&&t.prototype===He?Jt:{get:function(){return t},set:Jt.set})}};function dr(t,e,n,r,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=s}function hr(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&et();n&&typeof n.then=="function"?hr(t,(s,a)=>{n instanceof P?n._then(s,a):n.then(s,a)}):(t._state=!0,t._value=n,fr(t)),r&&tt()}},Zt.bind(null,t))}catch(n){Zt(t,n)}}function Zt(t,e){if(mt.push(e),t._state===null){var n=t._lib&&et();e=Qt(e),t._state=!1,t._value=e,J&&e!==null&&typeof e=="object"&&!e._promise&&function(r,s,a){try{r.apply(null,a)}catch(i){s&&s(i)}}(()=>{var r=gn(e,"stack");e._promise=t,se(e,"stack",{get:()=>Ht?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){ve.some(s=>s._value===r._value)||ve.push(r)}(t),fr(t),n&&tt()}}function fr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)kn(t,e[n]);var s=t._PSD;--s.ref||s.finalize(),be===0&&(++be,Ve(()=>{--be==0&&En()},[]))}function kn(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++be,Ve(ys,[n,t,e])}else t._listeners.push(e)}function ys(t,e,n){try{Gt=e;var r,s=e._value;e._state?r=t(s):(mt.length&&(mt=[]),r=t(s),mt.indexOf(s)===-1&&function(a){for(var i=ve.length;i;)if(ve[--i]._value===a._value)return void ve.splice(i,1)}(e)),n.resolve(r)}catch(a){n.reject(a)}finally{Gt=null,--be==0&&En(),--n.psd.ref||n.psd.finalize()}}function pr(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var s,a,i=t._value;i!=null?(s=i.name||"Error",a=i.message||i,r=Wt(i,0)):(s=i,a=""),e.push(s+(a?": "+a:"")+r)}return J&&((r=Wt(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&pr(t._prev,e,n)),e}function mr(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function st(){et()&&tt()}function et(){var t=Xt;return Xt=!1,kt=!1,t}function tt(){var t,e,n;do for(;Ne.length>0;)for(t=Ne,Ne=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Ne.length>0);Xt=!0,kt=!0}function En(){var t=ve;ve=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=yt.slice(0),n=e.length;n;)e[--n]()}function at(t){return new P(He,!1,t)}function T(t,e){var n=O;return function(){var r=et(),s=O;try{return he(n,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{he(s,!1),r&&tt()}}}Be(P.prototype,{then:Jt,_then:function(t,e){kn(this,new dr(null,null,t,e,O))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):at(r)):this.then(null,r=>r&&r.name===e?n(r):at(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),at(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Ht=!0;var t=pr(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Ht=!1}}},timeout:function(t,e){return t<1/0?new P((n,r)=>{var s=setTimeout(()=>r(new A.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&se(P.prototype,Symbol.toStringTag,"Dexie.Promise"),De.env=yr(),Be(P,{all:function(){var t=te.apply(null,arguments).map(it);return new P(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((s,a)=>P.resolve(s).then(i=>{t[a]=i,--r||e(t)},n))})},resolve:t=>{if(t instanceof P)return t;if(t&&typeof t.then=="function")return new P((n,r)=>{t.then(n,r)});var e=new P(He,!0,t);return mr(e,Gt),e},reject:at,race:function(){var t=te.apply(null,arguments).map(it);return new P((e,n)=>{t.map(r=>P.resolve(r).then(e,n))})},PSD:{get:()=>O,set:t=>O=t},totalEchoes:{get:()=>Et},newPSD:de,usePSD:Ie,scheduler:{get:()=>Ve,set:t=>{Ve=t}},rejectionMapper:{get:()=>Qt,set:t=>{Qt=t}},follow:(t,e)=>new P((n,r)=>de((s,a)=>{var i=O;i.unhandleds=[],i.onunhandled=a,i.finalize=_e(function(){(function(l){function o(){l(),yt.splice(yt.indexOf(o),1)}yt.push(o),++be,Ve(()=>{--be==0&&En()},[])})(()=>{this.unhandleds.length===0?s():a(this.unhandleds[0])})},i.finalize),t()},e,n,r))}),pt&&(pt.allSettled&&se(P,"allSettled",function(){const t=te.apply(null,arguments).map(it);return new P(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((s,a)=>P.resolve(s).then(i=>r[a]={status:"fulfilled",value:i},i=>r[a]={status:"rejected",reason:i}).then(()=>--n||e(r)))})}),pt.any&&typeof AggregateError<"u"&&se(P,"any",function(){const t=te.apply(null,arguments).map(it);return new P((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach((a,i)=>P.resolve(a).then(l=>e(l),l=>{s[i]=l,--r||n(new AggregateError(s))}))})}));const q={awaits:0,echoes:0,id:0};var gs=0,gt=[],It=0,Et=0,vs=0;function de(t,e,n,r){var s=O,a=Object.create(s);a.parent=s,a.ref=0,a.global=!1,a.id=++vs;var i=De.env;a.env=xn?{Promise:P,PromiseProp:{value:P,configurable:!0,writable:!0},all:P.all,race:P.race,allSettled:P.allSettled,any:P.any,resolve:P.resolve,reject:P.reject,nthen:In(i.nthen,a),gthen:In(i.gthen,a)}:{},e&&W(a,e),++s.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=Ie(a,t,n,r);return a.ref===0&&a.finalize(),l}function Te(){return q.id||(q.id=++gs),++q.awaits,q.echoes+=ur,q.id}function ie(){return!!q.awaits&&(--q.awaits==0&&(q.id=0),q.echoes=q.awaits*ur,!0)}function it(t){return q.echoes&&t&&t.constructor===pt?(Te(),t.then(e=>(ie(),e),e=>(ie(),F(e)))):t}function bs(t){++Et,q.echoes&&--q.echoes!=0||(q.echoes=q.id=0),gt.push(O),he(t,!0)}function ws(){var t=gt[gt.length-1];gt.pop(),he(t,!1)}function he(t,e){var n=O;if((e?!q.echoes||It++&&t===O:!It||--It&&t===O)||gr(e?bs.bind(null,t):ws),t!==O&&(O=t,n===De&&(De.env=yr()),xn)){var r=De.env.Promise,s=t.env;xt.then=s.nthen,r.prototype.then=s.gthen,(n.global||t.global)&&(Object.defineProperty(B,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function yr(){var t=B.Promise;return xn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(B,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:xt.then,gthen:t.prototype.then}:{}}function Ie(t,e,n,r,s){var a=O;try{return he(t,!0),e(n,r,s)}finally{he(a,!1)}}function gr(t){cr.call(Yt,t)}function Pt(t,e,n,r){return typeof t!="function"?t:function(){var s=O;n&&Te(),he(e,!0);try{return t.apply(this,arguments)}finally{he(s,!1),r&&gr(ie)}}}function In(t,e){return function(n,r){return t.call(this,Pt(n,e),Pt(r,e))}}(""+cr).indexOf("[native code]")===-1&&(Te=ie=D);const jn="unhandledrejection";function Rn(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,s={promise:e,reason:t};if(B.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(jn,!0,!0),W(r,s)):B.CustomEvent&&W(r=new CustomEvent(jn,{detail:s}),s),r&&B.dispatchEvent&&(dispatchEvent(r),!B.PromiseRejectionEvent&&B.onunhandledrejection))try{B.onunhandledrejection(r)}catch{}J&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var F=P.reject;function en(t,e,n,r){if(t.idbdb&&(t._state.openComplete||O.letThrough||t._vip)){var s=t._createTransaction(e,n,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===wn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>en(t,e,n,r))):F(a)}return s._promise(e,(a,i)=>de(()=>(O.trans=s,r(a,i,s)))).then(a=>s._completion.then(()=>a))}if(t._state.openComplete)return F(new A.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return F(new A.DatabaseClosed);t.open().catch(D)}return t._state.dbReadyPromise.then(()=>en(t,e,n,r))}const Mn="3.2.5",ye="￿",tn=-1/0,Z="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",vr="String expected.",$e=[],St=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),_s=St,xs=St,br=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Kt="__dbnames",jt="readonly",Rt="readwrite";function xe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const wr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ot(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=Ze(e))[t],e)}class ks{_trans(e,n,r){const s=this._tx||O.trans,a=this.name;function i(o,c,u){if(!u.schema[a])throw new A.NotFound("Table "+a+" not part of transaction");return n(u.idbtrans,u)}const l=et();try{return s&&s.db===this.db?s===O.trans?s._promise(e,i,r):de(()=>s._promise(e,i,r),{trans:s,transless:O.transless||O}):en(this.db,e,[this.name],i)}finally{l&&tt()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(s=>this.hook.reading.fire(s))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(V(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=M(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(c=>{if(c.compound&&n.every(u=>c.keyPath.indexOf(u)>=0)){for(let u=0;u<n.length;++u)if(n.indexOf(c.keyPath[u])===-1)return!1;return!0}return!1}).sort((c,u)=>c.keyPath.length-u.keyPath.length)[0];if(r&&this.db._maxKey!==ye){const c=r.keyPath.slice(0,n.length);return this.where(c).equals(c.map(u=>e[u]))}!r&&J&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,a=this.db._deps.indexedDB;function i(c,u){try{return a.cmp(c,u)===0}catch{return!1}}const[l,o]=n.reduce(([c,u],h)=>{const d=s[h],f=e[h];return[c||d,c||!d?xe(u,d&&d.multi?v=>{const p=ae(v,h);return V(p)&&p.some(g=>i(f,g))}:v=>i(f,ae(v,h))):u]},[null,null]);return l?this.where(l.name).equals(e[l.keyPath]).filter(o):r?this.filter(o):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,V(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const s=Object.create(e.prototype);for(var a in r)if(X(r,a))try{s[a]=r[a]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){W(this,e)})}add(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let a=e;return s&&r&&(a=ot(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"add",keys:n!=null?[n]:null,values:[a]})).then(i=>i.numFailures?P.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{G(e,s,i)}catch{}return i})}update(e,n){if(typeof e!="object"||V(e))return this.where(":id").equals(e).modify(n);{const r=ae(e,this.schema.primKey.keyPath);if(r===void 0)return F(new A.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?M(n).forEach(s=>{G(e,s,n[s])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let a=e;return s&&r&&(a=ot(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"put",values:[a],keys:n!=null?[n]:null})).then(i=>i.numFailures?P.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{G(e,s,i)}catch{}return i})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?P.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:wr})).then(e=>e.numFailures?P.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,n,r){const s=Array.isArray(n)?n:void 0,a=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:l,keyPath:o}=this.schema.primKey;if(o&&s)throw new A.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let u=o&&l?e.map(ot(o)):e;return this.core.mutate({trans:i,type:"add",keys:s,values:u,wantResults:a}).then(({numFailures:h,results:d,lastResult:f,failures:v})=>{if(h===0)return a?d:f;throw new qe(`${this.name}.bulkAdd(): ${h} of ${c} operations failed`,v)})})}bulkPut(e,n,r){const s=Array.isArray(n)?n:void 0,a=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:l,keyPath:o}=this.schema.primKey;if(o&&s)throw new A.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let u=o&&l?e.map(ot(o)):e;return this.core.mutate({trans:i,type:"put",keys:s,values:u,wantResults:a}).then(({numFailures:h,results:d,lastResult:f,failures:v})=>{if(h===0)return a?d:f;throw new qe(`${this.name}.bulkPut(): ${h} of ${c} operations failed`,v)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:s,failures:a})=>{if(r===0)return s;throw new qe(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,a)})}}function Le(t){var e={},n=function(i,l){if(l){for(var o=arguments.length,c=new Array(o-1);--o;)c[o-1]=arguments[o];return e[i].subscribe.apply(null,c),t}if(typeof i=="string")return e[i]};n.addEventType=a;for(var r=1,s=arguments.length;r<s;++r)a(arguments[r]);return n;function a(i,l,o){if(typeof i!="object"){var c;l||(l=ps),o||(o=D);var u={subscribers:[],fire:o,subscribe:function(h){u.subscribers.indexOf(h)===-1&&(u.subscribers.push(h),u.fire=l(u.fire,h))},unsubscribe:function(h){u.subscribers=u.subscribers.filter(function(d){return d!==h}),u.fire=u.subscribers.reduce(l,o)}};return e[i]=n[i]=u,u}M(c=i).forEach(function(h){var d=c[h];if(V(d))a(h,c[h][0],c[h][1]);else{if(d!=="asap")throw new A.InvalidArgument("Invalid event config");var f=a(h,ze,function(){for(var v=arguments.length,p=new Array(v);v--;)p[v]=arguments[v];f.subscribers.forEach(function(g){er(function(){g.apply(null,p)})})})}})}}function Re(t,e){return Se(e).from({prototype:t}),e}function Oe(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Mt(t,e){t.filter=xe(t.filter,e)}function Ft(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>xe(r(),e()):e,t.justLimit=n&&!r}function vt(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new A.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Fn(t,e,n){const r=vt(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function lt(t,e,n,r){const s=t.replayFilter?xe(t.filter,t.replayFilter()):t.filter;if(t.or){const a={},i=(l,o,c)=>{if(!s||s(o,c,d=>o.stop(d),d=>o.fail(d))){var u=o.primaryKey,h=""+u;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(u)),X(a,h)||(a[h]=!0,e(l,o,c))}};return Promise.all([t.or._iterate(i,n),Nn(Fn(t,r,n),t.algorithm,i,!t.keysOnly&&t.valueMapper)])}return Nn(Fn(t,r,n),xe(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function Nn(t,e,n,r){var s=T(r?(a,i,l)=>n(r(a),i,l):n);return t.then(a=>{if(a)return a.start(()=>{var i=()=>a.continue();e&&!e(a,l=>i=l,l=>{a.stop(l),i=D},l=>{a.fail(l),i=D})||s(a.value,a,l=>i=l),i()})})}function L(t,e){try{const n=qn(t),r=qn(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,a){const i=s.length,l=a.length,o=i<l?i:l;for(let c=0;c<o;++c)if(s[c]!==a[c])return s[c]<a[c]?-1:1;return i===l?0:i<l?-1:1}(Vn(t),Vn(e));case"Array":return function(s,a){const i=s.length,l=a.length,o=i<l?i:l;for(let c=0;c<o;++c){const u=L(s[c],a[c]);if(u!==0)return u}return i===l?0:i<l?-1:1}(t,e)}}catch{}return NaN}function qn(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=Lt(t);return n==="ArrayBuffer"?"binary":n}function Vn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class Es{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,F.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,F.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=xe(n.algorithm,e)}_iterate(e,n){return lt(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&W(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>lt(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,s=r.table.core;if(Oe(r,!0))return s.count({trans:n,query:{index:vt(r,s.schema),range:r.range}}).then(i=>Math.min(i,r.limit));var a=0;return lt(r,()=>(++a,!1),n,s).then(()=>a)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),s=r[0],a=r.length-1;function i(c,u){return u?i(c[r[u]],u-1):c[s]}var l=this._ctx.dir==="next"?1:-1;function o(c,u){var h=i(c,a),d=i(u,a);return h<d?-l:h>d?l:0}return this.toArray(function(c){return c.sort(o)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&Oe(r,!0)&&r.limit>0){const{valueMapper:s}=r,a=vt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(({result:i})=>s?i.map(s):i)}{const s=[];return lt(r,a=>s.push(a),n,r.table.core).then(()=>s)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,Oe(n)?Ft(n,()=>{var r=e;return(s,a)=>r===0||(r===1?(--r,!1):(a(()=>{s.advance(r),r=0}),!1))}):Ft(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ft(this._ctx,()=>{var n=e;return function(r,s,a){return--n<=0&&s(a),n>=0}},!0),this}until(e,n){return Mt(this._ctx,function(r,s,a){return!e(r.value)||(s(a),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return Mt(this._ctx,function(s){return e(s.value)}),n=this._ctx,r=e,n.isMatch=xe(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.primaryKey,s)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,a){r.push(a.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&Oe(n,!0)&&n.limit>0)return this._read(s=>{var a=vt(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(({result:s})=>s).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Mt(this._ctx,function(s){var a=s.primaryKey.toString(),i=X(r,a);return r[a]=!0,!i}),this}modify(e){var n=this._ctx;return this._write(r=>{var s;if(typeof e=="function")s=e;else{var a=M(e),i=a.length;s=function(p){for(var g=!1,y=0;y<i;++y){var m=a[y],w=e[m];ae(p,m)!==w&&(G(p,m,w),g=!0)}return g}}const l=n.table.core,{outbound:o,extractKey:c}=l.schema.primaryKey,u=this.db._options.modifyChunkSize||200,h=[];let d=0;const f=[],v=(p,g)=>{const{failures:y,numFailures:m}=g;d+=p-m;for(let w of M(y))h.push(y[w])};return this.clone().primaryKeys().then(p=>{const g=y=>{const m=Math.min(u,p.length-y);return l.getMany({trans:r,keys:p.slice(y,y+m),cache:"immutable"}).then(w=>{const E=[],_=[],x=o?[]:null,b=[];for(let k=0;k<m;++k){const K=w[k],S={value:Ze(K),primKey:p[y+k]};s.call(S,S.value,S)!==!1&&(S.value==null?b.push(p[y+k]):o||L(c(K),c(S.value))===0?(_.push(S.value),o&&x.push(p[y+k])):(b.push(p[y+k]),E.push(S.value)))}const C=Oe(n)&&n.limit===1/0&&(typeof e!="function"||e===Nt)&&{index:n.index,range:n.range};return Promise.resolve(E.length>0&&l.mutate({trans:r,type:"add",values:E}).then(k=>{for(let K in k.failures)b.splice(parseInt(K),1);v(E.length,k)})).then(()=>(_.length>0||C&&typeof e=="object")&&l.mutate({trans:r,type:"put",keys:x,values:_,criteria:C,changeSpec:typeof e!="function"&&e}).then(k=>v(_.length,k))).then(()=>(b.length>0||C&&e===Nt)&&l.mutate({trans:r,type:"delete",keys:b,criteria:C}).then(k=>v(b.length,k))).then(()=>p.length>y+m&&g(y+u))})};return g(0).then(()=>{if(h.length>0)throw new _t("Error modifying one or more objects",h,d,f);return p.length})})})}delete(){var e=this._ctx,n=e.range;return Oe(e)&&(e.isPrimKey&&!xs||n.type===3)?this._write(r=>{const{primaryKey:s}=e.table.core.schema,a=n;return e.table.core.count({trans:r,query:{index:s,range:a}}).then(i=>e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(({failures:l,lastResult:o,results:c,numFailures:u})=>{if(u)throw new _t("Could not delete some values",Object.keys(l).map(h=>l[h]),i-u);return i-u}))}):this.modify(Nt)}}const Nt=(t,e)=>e.value=null;function Ps(t,e){return t<e?-1:t===e?0:1}function Os(t,e){return t>e?-1:t===e?0:1}function H(t,e,n){var r=t instanceof xr?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Ae(t){return new t.Collection(t,()=>_r("")).limit(0)}function As(t,e,n,r,s,a){for(var i=Math.min(t.length,r.length),l=-1,o=0;o<i;++o){var c=e[o];if(c!==r[o])return s(t[o],n[o])<0?t.substr(0,o)+n[o]+n.substr(o+1):s(t[o],r[o])<0?t.substr(0,o)+r[o]+n.substr(o+1):l>=0?t.substr(0,l)+e[l]+n.substr(l+1):null;s(t[o],c)<0&&(l=o)}return i<r.length&&a==="next"?t+n.substr(t.length):i<t.length&&a==="prev"?t.substr(0,n.length):l<0?null:t.substr(0,l)+r[l]+n.substr(l+1)}function ut(t,e,n,r){var s,a,i,l,o,c,u,h=n.length;if(!n.every(p=>typeof p=="string"))return H(t,vr);function d(p){s=function(y){return y==="next"?m=>m.toUpperCase():m=>m.toLowerCase()}(p),a=function(y){return y==="next"?m=>m.toLowerCase():m=>m.toUpperCase()}(p),i=p==="next"?Ps:Os;var g=n.map(function(y){return{lower:a(y),upper:s(y)}}).sort(function(y,m){return i(y.lower,m.lower)});l=g.map(function(y){return y.upper}),o=g.map(function(y){return y.lower}),c=p,u=p==="next"?"":r}d("next");var f=new t.Collection(t,()=>le(l[0],o[h-1]+r));f._ondirectionchange=function(p){d(p)};var v=0;return f._addAlgorithm(function(p,g,y){var m=p.key;if(typeof m!="string")return!1;var w=a(m);if(e(w,o,v))return!0;for(var E=null,_=v;_<h;++_){var x=As(m,w,l[_],o[_],i,c);x===null&&E===null?v=_+1:(E===null||i(E,x)>0)&&(E=x)}return g(E!==null?function(){p.continue(E+u)}:y),!1}),f}function le(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function _r(t){return{type:1,lower:t,upper:t}}class xr{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,s){r=r!==!1,s=s===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||s)&&(!r||!s)?Ae(this):new this.Collection(this,()=>le(e,n,!r,!s))}catch{return H(this,Z)}}equals(e){return e==null?H(this,Z):new this.Collection(this,()=>_r(e))}above(e){return e==null?H(this,Z):new this.Collection(this,()=>le(e,void 0,!0))}aboveOrEqual(e){return e==null?H(this,Z):new this.Collection(this,()=>le(e,void 0,!1))}below(e){return e==null?H(this,Z):new this.Collection(this,()=>le(void 0,e,!1,!0))}belowOrEqual(e){return e==null?H(this,Z):new this.Collection(this,()=>le(void 0,e))}startsWith(e){return typeof e!="string"?H(this,vr):this.between(e,e+ye,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):ut(this,(n,r)=>n.indexOf(r[0])===0,[e],ye)}equalsIgnoreCase(e){return ut(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=te.apply(Ce,arguments);return e.length===0?Ae(this):ut(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=te.apply(Ce,arguments);return e.length===0?Ae(this):ut(this,(n,r)=>r.some(s=>n.indexOf(s)===0),e,ye)}anyOf(){const e=te.apply(Ce,arguments);let n=this._cmp;try{e.sort(n)}catch{return H(this,Z)}if(e.length===0)return Ae(this);const r=new this.Collection(this,()=>le(e[0],e[e.length-1]));r._ondirectionchange=a=>{n=a==="next"?this._ascending:this._descending,e.sort(n)};let s=0;return r._addAlgorithm((a,i,l)=>{const o=a.key;for(;n(o,e[s])>0;)if(++s,s===e.length)return i(l),!1;return n(o,e[s])===0||(i(()=>{a.continue(e[s])}),!1)}),r}notEqual(e){return this.inAnyRange([[tn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=te.apply(Ce,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return H(this,Z)}const n=e.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[tn,s]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,s=this._ascending,a=this._descending,i=this._min,l=this._max;if(e.length===0)return Ae(this);if(!e.every(m=>m[0]!==void 0&&m[1]!==void 0&&s(m[0],m[1])<=0))return H(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",A.InvalidArgument);const o=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;let u,h=s;function d(m,w){return h(m[0],w[0])}try{u=e.reduce(function(m,w){let E=0,_=m.length;for(;E<_;++E){const x=m[E];if(r(w[0],x[1])<0&&r(w[1],x[0])>0){x[0]=i(x[0],w[0]),x[1]=l(x[1],w[1]);break}}return E===_&&m.push(w),m},[]),u.sort(d)}catch{return H(this,Z)}let f=0;const v=c?m=>s(m,u[f][1])>0:m=>s(m,u[f][1])>=0,p=o?m=>a(m,u[f][0])>0:m=>a(m,u[f][0])>=0;let g=v;const y=new this.Collection(this,()=>le(u[0][0],u[u.length-1][1],!o,!c));return y._ondirectionchange=m=>{m==="next"?(g=v,h=s):(g=p,h=a),u.sort(d)},y._addAlgorithm((m,w,E)=>{for(var _=m.key;g(_);)if(++f,f===u.length)return w(E),!1;return!!function(x){return!v(x)&&!p(x)}(_)||(this._cmp(_,u[f][1])===0||this._cmp(_,u[f][0])===0||w(()=>{h===s?m.continue(u[f][0]):m.continue(u[f][1])}),!1)}),y}startsWithAnyOf(){const e=te.apply(Ce,arguments);return e.every(n=>typeof n=="string")?e.length===0?Ae(this):this.inAnyRange(e.map(n=>[n,n+ye])):H(this,"startsWithAnyOf() only works with strings")}}function Q(t){return T(function(e){return Xe(e),t(e.target.error),!1})}function Xe(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const Ge="storagemutated",ce="x-storagemutated-1",fe=Le(null,Ge);class Cs{_lock(){return Fe(!O.global),++this._reculock,this._reculock!==1||O.global||(O.lockOwnerFor=this),this}_unlock(){if(Fe(!O.global),--this._reculock==0)for(O.global||(O.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Ie(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&O.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Fe(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new A.DatabaseClosed(r);case"MissingAPIError":throw new A.MissingAPI(r.message,r);default:throw new A.OpenFailed(r)}if(!this.active)throw new A.TransactionInactive;return Fe(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=T(s=>{Xe(s),this._reject(e.error)}),e.onabort=T(s=>{Xe(s),this.active&&this._reject(new A.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=T(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&fe.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return F(new A.ReadOnly("Transaction is readonly"));if(!this.active)return F(new A.TransactionInactive);if(this._locked())return new P((a,i)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(a,i)},O])});if(r)return de(()=>{var a=new P((i,l)=>{this._lock();const o=n(i,l,this);o&&o.then&&o.then(i,l)});return a.finally(()=>this._unlock()),a._lib=!0,a});var s=new P((a,i)=>{var l=n(a,i,this);l&&l.then&&l.then(a,i)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=P.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);(function i(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=i)})()}var a=n._waitingFor;return new P((i,l)=>{r.then(o=>n._waitingQueue.push(T(i.bind(null,o))),o=>n._waitingQueue.push(T(l.bind(null,o)))).finally(()=>{n._waitingFor===a&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new A.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(X(n,e))return n[e];const r=this.schema[e];if(!r)throw new A.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,r,this);return s.core=this.db.core.table(e),n[e]=s,s}}function nn(t,e,n,r,s,a,i){return{name:t,keyPath:e,unique:n,multi:r,auto:s,compound:a,src:(n&&!i?"&":"")+(r?"*":"")+(s?"++":"")+kr(e)}}function kr(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Er(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:tr(n,r=>[r.name,r])}}let Qe=t=>{try{return t.only([[]]),Qe=()=>[[]],[[]]}catch{return Qe=()=>ye,ye}};function rn(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>ae(r,e)}(t):e=>ae(e,t)}function $n(t){return[].slice.call(t)}let Ss=0;function Ue(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Ks(t,e,n){function r(o){if(o.type===3)return null;if(o.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:u,lowerOpen:h,upperOpen:d}=o;return c===void 0?u===void 0?null:e.upperBound(u,!!d):u===void 0?e.lowerBound(c,!!h):e.bound(c,u,!!h,!!d)}const{schema:s,hasGetAll:a}=function(o,c){const u=$n(o.objectStoreNames);return{schema:{name:o.name,tables:u.map(h=>c.objectStore(h)).map(h=>{const{keyPath:d,autoIncrement:f}=h,v=V(d),p=d==null,g={},y={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:v,keyPath:d,autoIncrement:f,unique:!0,extractKey:rn(d)},indexes:$n(h.indexNames).map(m=>h.index(m)).map(m=>{const{name:w,unique:E,multiEntry:_,keyPath:x}=m,b={name:w,compound:V(x),keyPath:x,unique:E,multiEntry:_,extractKey:rn(x)};return g[Ue(x)]=b,b}),getIndexByKeyPath:m=>g[Ue(m)]};return g[":id"]=y.primaryKey,d!=null&&(g[Ue(d)]=y.primaryKey),y})},hasGetAll:u.length>0&&"getAll"in c.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),i=s.tables.map(o=>function(c){const u=c.name;return{name:u,schema:c,mutate:function({trans:h,type:d,keys:f,values:v,range:p}){return new Promise((g,y)=>{g=T(g);const m=h.objectStore(u),w=m.keyPath==null,E=d==="put"||d==="add";if(!E&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:_}=f||v||{length:1};if(f&&v&&f.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(_===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let x;const b=[],C=[];let k=0;const K=I=>{++k,Xe(I)};if(d==="deleteRange"){if(p.type===4)return g({numFailures:k,failures:C,results:[],lastResult:void 0});p.type===3?b.push(x=m.clear()):b.push(x=m.delete(r(p)))}else{const[I,R]=E?w?[v,f]:[v,null]:[f,null];if(E)for(let j=0;j<_;++j)b.push(x=R&&R[j]!==void 0?m[d](I[j],R[j]):m[d](I[j])),x.onerror=K;else for(let j=0;j<_;++j)b.push(x=m[d](I[j])),x.onerror=K}const S=I=>{const R=I.target.result;b.forEach((j,Ee)=>j.error!=null&&(C[Ee]=j.error)),g({numFailures:k,failures:C,results:d==="delete"?f:b.map(j=>j.result),lastResult:R})};x.onerror=I=>{K(I),S(I)},x.onsuccess=S})},getMany:({trans:h,keys:d})=>new Promise((f,v)=>{f=T(f);const p=h.objectStore(u),g=d.length,y=new Array(g);let m,w=0,E=0;const _=b=>{const C=b.target;y[C._pos]=C.result,++E===w&&f(y)},x=Q(v);for(let b=0;b<g;++b)d[b]!=null&&(m=p.get(d[b]),m._pos=b,m.onsuccess=_,m.onerror=x,++w);w===0&&f(y)}),get:({trans:h,key:d})=>new Promise((f,v)=>{f=T(f);const p=h.objectStore(u).get(d);p.onsuccess=g=>f(g.target.result),p.onerror=Q(v)}),query:function(h){return d=>new Promise((f,v)=>{f=T(f);const{trans:p,values:g,limit:y,query:m}=d,w=y===1/0?void 0:y,{index:E,range:_}=m,x=p.objectStore(u),b=E.isPrimaryKey?x:x.index(E.name),C=r(_);if(y===0)return f({result:[]});if(h){const k=g?b.getAll(C,w):b.getAllKeys(C,w);k.onsuccess=K=>f({result:K.target.result}),k.onerror=Q(v)}else{let k=0;const K=g||!("openKeyCursor"in b)?b.openCursor(C):b.openKeyCursor(C),S=[];K.onsuccess=I=>{const R=K.result;return R?(S.push(g?R.value:R.primaryKey),++k===y?f({result:S}):void R.continue()):f({result:S})},K.onerror=Q(v)}})}(a),openCursor:function({trans:h,values:d,query:f,reverse:v,unique:p}){return new Promise((g,y)=>{g=T(g);const{index:m,range:w}=f,E=h.objectStore(u),_=m.isPrimaryKey?E:E.index(m.name),x=v?p?"prevunique":"prev":p?"nextunique":"next",b=d||!("openKeyCursor"in _)?_.openCursor(r(w),x):_.openKeyCursor(r(w),x);b.onerror=Q(y),b.onsuccess=T(C=>{const k=b.result;if(!k)return void g(null);k.___id=++Ss,k.done=!1;const K=k.continue.bind(k);let S=k.continuePrimaryKey;S&&(S=S.bind(k));const I=k.advance.bind(k),R=()=>{throw new Error("Cursor not stopped")};k.trans=h,k.stop=k.continue=k.continuePrimaryKey=k.advance=()=>{throw new Error("Cursor not started")},k.fail=T(y),k.next=function(){let j=1;return this.start(()=>j--?this.continue():this.stop()).then(()=>this)},k.start=j=>{const Ee=new Promise((Y,pe)=>{Y=T(Y),b.onerror=Q(pe),k.fail=pe,k.stop=je=>{k.stop=k.continue=k.continuePrimaryKey=k.advance=R,Y(je)}}),Pe=()=>{if(b.result)try{j()}catch(Y){k.fail(Y)}else k.done=!0,k.start=()=>{throw new Error("Cursor behind last entry")},k.stop()};return b.onsuccess=T(Y=>{b.onsuccess=Pe,Pe()}),k.continue=K,k.continuePrimaryKey=S,k.advance=I,Pe(),Ee},g(k)},y)})},count({query:h,trans:d}){const{index:f,range:v}=h;return new Promise((p,g)=>{const y=d.objectStore(u),m=f.isPrimaryKey?y:y.index(f.name),w=r(v),E=w?m.count(w):m.count();E.onsuccess=T(_=>p(_.target.result)),E.onerror=Q(g)})}}}(o)),l={};return i.forEach(o=>l[o.name]=o),{stack:"dbcore",transaction:t.transaction.bind(t),table(o){if(!l[o])throw new Error(`Table '${o}' not found`);return l[o]},MIN_KEY:-1/0,MAX_KEY:Qe(e),schema:s}}function sn({_novip:t},e){const n=e.db,r=function(s,a,{IDBKeyRange:i,indexedDB:l},o){return{dbcore:function(u,h){return h.reduce((d,{create:f})=>({...d,...f(d)}),u)}(Ks(a,i,o),s.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(s=>{const a=s.name;t.core.schema.tables.some(i=>i.name===a)&&(s.core=t.core.table(a),t[a]instanceof t.Table&&(t[a].core=s.core))})}function Ot({_novip:t},e,n,r){n.forEach(s=>{const a=r[s];e.forEach(i=>{const l=gn(i,s);(!l||"value"in l&&l.value===void 0)&&(i===t.Transaction.prototype||i instanceof t.Transaction?se(i,s,{get(){return this.table(s)},set(o){Jn(this,s,{value:o,writable:!0,configurable:!0,enumerable:!0})}}):i[s]=new t.Table(s,a))})})}function an({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Ds(t,e){return t._cfg.version-e._cfg.version}function Bs(t,e,n,r){const s=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,s);a.create(n),a._completion.catch(r);const i=a._reject.bind(a),l=O.transless||O;de(()=>{O.trans=a,O.transless=l,e===0?(M(s).forEach(o=>{qt(n,o,s[o].primKey,s[o].indexes)}),sn(t,n),P.follow(()=>t.on.populate.fire(a)).catch(i)):function({_novip:o},c,u,h){const d=[],f=o._versions;let v=o._dbSchema=ln(o,o.idbdb,h),p=!1;const g=f.filter(m=>m._cfg.version>=c);function y(){return d.length?P.resolve(d.shift()(u.idbtrans)).then(y):P.resolve()}return g.forEach(m=>{d.push(()=>{const w=v,E=m._cfg.dbschema;un(o,w,h),un(o,E,h),v=o._dbSchema=E;const _=Pr(w,E);_.add.forEach(b=>{qt(h,b[0],b[1].primKey,b[1].indexes)}),_.change.forEach(b=>{if(b.recreate)throw new A.Upgrade("Not yet support for changing primary key");{const C=h.objectStore(b.name);b.add.forEach(k=>on(C,k)),b.change.forEach(k=>{C.deleteIndex(k.name),on(C,k)}),b.del.forEach(k=>C.deleteIndex(k))}});const x=m._cfg.contentUpgrade;if(x&&m._cfg.version>c){sn(o,h),u._memoizedTables={},p=!0;let b=nr(E);_.del.forEach(S=>{b[S]=w[S]}),an(o,[o.Transaction.prototype]),Ot(o,[o.Transaction.prototype],M(b),b),u.schema=b;const C=vn(x);let k;C&&Te();const K=P.follow(()=>{if(k=x(u),k&&C){var S=ie.bind(null,null);k.then(S,S)}});return k&&typeof k.then=="function"?P.resolve(k):K.then(()=>k)}}),d.push(w=>{(!p||!_s)&&function(E,_){[].slice.call(_.db.objectStoreNames).forEach(x=>E[x]==null&&_.db.deleteObjectStore(x))}(m._cfg.dbschema,w),an(o,[o.Transaction.prototype]),Ot(o,[o.Transaction.prototype],o._storeNames,o._dbSchema),u.schema=o._dbSchema})}),y().then(()=>{var m,w;w=h,M(m=v).forEach(E=>{w.db.objectStoreNames.contains(E)||qt(w,E,m[E].primKey,m[E].indexes)})})}(t,e,a,n).catch(i)})}function Pr(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const s=t[r],a=e[r];if(s){const i={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||s.primKey.auto!==a.primKey.auto&&!St)i.recreate=!0,n.change.push(i);else{const l=s.idxByName,o=a.idxByName;let c;for(c in l)o[c]||i.del.push(c);for(c in o){const u=l[c],h=o[c];u?u.src!==h.src&&i.change.push(h):i.add.push(h)}(i.del.length>0||i.add.length>0||i.change.length>0)&&n.change.push(i)}}else n.add.push([r,a])}return n}function qt(t,e,n,r){const s=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(a=>on(s,a)),s}function on(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function ln(t,e,n){const r={};return wt(e.objectStoreNames,0).forEach(s=>{const a=n.objectStore(s);let i=a.keyPath;const l=nn(kr(i),i||"",!1,!1,!!a.autoIncrement,i&&typeof i!="string",!0),o=[];for(let u=0;u<a.indexNames.length;++u){const h=a.index(a.indexNames[u]);i=h.keyPath;var c=nn(h.name,i,!!h.unique,!!h.multiEntry,!1,i&&typeof i!="string",!1);o.push(c)}r[s]=Er(s,l,o)}),r}function un({_novip:t},e,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const a=r[s],i=n.objectStore(a);t._hasGetAll="getAll"in i;for(let l=0;l<i.indexNames.length;++l){const o=i.indexNames[l],c=i.index(o).keyPath,u=typeof c=="string"?c:"["+wt(c).join("+")+"]";if(e[a]){const h=e[a].idxByName[u];h&&(h.name=o,delete e[a].idxByName[u],e[a].idxByName[o]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&B.WorkerGlobalScope&&B instanceof B.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Ts{_parseStoresSpec(e,n){M(e).forEach(r=>{if(e[r]!==null){var s=e[r].split(",").map((i,l)=>{const o=(i=i.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return nn(o,c||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),V(c),l===0)}),a=s.shift();if(a.multi)throw new A.Schema("Primary key cannot be multi-valued");s.forEach(i=>{if(i.auto)throw new A.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new A.Schema("Index must have a name and cannot be an empty string")}),n[r]=Er(r,a,s)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?W(this._cfg.storesSource,e):e;const r=n._versions,s={};let a={};return r.forEach(i=>{W(s,i._cfg.storesSource),a=i._cfg.dbschema={},i._parseStoresSpec(s,a)}),n._dbSchema=a,an(n,[n._allTables,n,n.Transaction.prototype]),Ot(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],M(a),a),n._storeNames=M(a),this}upgrade(e){return this._cfg.contentUpgrade=_n(this._cfg.contentUpgrade||D,e),this}}function Pn(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new we(Kt,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function On(t){return t&&typeof t.databases=="function"}function cn(t){return de(function(){return O.letThrough=!0,t()})}function Is(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function js(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?F(e.dbOpenError):t);J&&(e.openCanceller._stackHolder=ke()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new A.DatabaseClosed("db.open() was cancelled")}let a=e.dbReadyResolve,i=null,l=!1;const o=()=>new P((c,u)=>{if(s(),!n)throw new A.MissingAPI;const h=t.name,d=e.autoSchema?n.open(h):n.open(h,Math.round(10*t.verno));if(!d)throw new A.MissingAPI;d.onerror=Q(u),d.onblocked=T(t._fireOnBlocked),d.onupgradeneeded=T(f=>{if(i=d.transaction,e.autoSchema&&!t._options.allowEmptyDB){d.onerror=Xe,i.abort(),d.result.close();const p=n.deleteDatabase(h);p.onsuccess=p.onerror=T(()=>{u(new A.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{i.onerror=Q(u);var v=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;l=v<1,t._novip.idbdb=d.result,Bs(t,v/10,i,u)}},u),d.onsuccess=T(()=>{i=null;const f=t._novip.idbdb=d.result,v=wt(f.objectStoreNames);if(v.length>0)try{const g=f.transaction((p=v).length===1?p[0]:p,"readonly");e.autoSchema?function({_novip:y},m,w){y.verno=m.version/10;const E=y._dbSchema=ln(0,m,w);y._storeNames=wt(m.objectStoreNames,0),Ot(y,[y._allTables],M(E),E)}(t,f,g):(un(t,t._dbSchema,g),function(y,m){const w=Pr(ln(0,y.idbdb,m),y._dbSchema);return!(w.add.length||w.change.some(E=>E.add.length||E.change.length))}(t,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),sn(t,g)}catch{}var p;$e.push(t),f.onversionchange=T(g=>{e.vcFired=!0,t.on("versionchange").fire(g)}),f.onclose=T(g=>{t.on("close").fire(g)}),l&&function({indexedDB:g,IDBKeyRange:y},m){!On(g)&&m!==Kt&&Pn(g,y).put({name:m}).catch(D)}(t._deps,h),c()},u)}).catch(c=>c&&c.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),o()):P.reject(c));return P.race([r,(typeof navigator>"u"?P.resolve():Is()).then(o)]).then(()=>(s(),e.onReadyBeingFired=[],P.resolve(cn(()=>t.on.ready.fire(t.vip))).then(function c(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(_n,D);return e.onReadyBeingFired=[],P.resolve(cn(()=>u(t.vip))).then(c)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(c=>{e.dbOpenError=c;try{i&&i.abort()}catch{}return r===e.openCanceller&&t._close(),F(c)}).finally(()=>{e.openComplete=!0,a()})}function dn(t){var e=a=>t.next(a),n=s(e),r=s(a=>t.throw(a));function s(a){return i=>{var l=a(i),o=l.value;return l.done?o:o&&typeof o.then=="function"?o.then(n,r):V(o)?Promise.all(o).then(n,r):n(o)}}return s(e)()}function Rs(t,e,n){var r=arguments.length;if(r<2)throw new A.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];return n=s.pop(),[t,rr(s),n]}function Or(t,e,n,r,s){return P.resolve().then(()=>{const a=O.transless||O,i=t._createTransaction(e,n,t._dbSchema,r),l={trans:i,transless:a};if(r)i.idbtrans=r.idbtrans;else try{i.create(),t._state.PR1398_maxLoop=3}catch(h){return h.name===wn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Or(t,e,n,null,s))):F(h)}const o=vn(s);let c;o&&Te();const u=P.follow(()=>{if(c=s.call(i,i),c)if(o){var h=ie.bind(null,null);c.then(h,h)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=dn(c))},l);return(c&&typeof c.then=="function"?P.resolve(c).then(h=>i.active?h:F(new A.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>c)).then(h=>(r&&i._resolve(),i._completion.then(()=>h))).catch(h=>(i._reject(h),F(h)))})}function ct(t,e,n){const r=V(t)?t.slice():[t];for(let s=0;s<n;++s)r.push(e);return r}const Ms={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,s={},a=[];function i(u,h,d){const f=Ue(u),v=s[f]=s[f]||[],p=u==null?0:typeof u=="string"?1:u.length,g=h>0,y={...d,isVirtual:g,keyTail:h,keyLength:p,extractKey:rn(u),unique:!g&&d.unique};return v.push(y),y.isPrimaryKey||a.push(y),p>1&&i(p===2?u[0]:u.slice(0,p-1),h+1,d),v.sort((m,w)=>m.keyTail-w.keyTail),y}const l=i(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[l];for(const u of r.indexes)i(u.keyPath,0,u);function o(u){const h=u.query.index;return h.isVirtual?{...u,query:{index:h,range:(d=u.query.range,f=h.keyTail,{type:d.type===1?2:d.type,lower:ct(d.lower,d.lowerOpen?t.MAX_KEY:t.MIN_KEY,f),lowerOpen:!0,upper:ct(d.upper,d.upperOpen?t.MIN_KEY:t.MAX_KEY,f),upperOpen:!0})}}:u;var d,f}return{...n,schema:{...r,primaryKey:l,indexes:a,getIndexByKeyPath:function(u){const h=s[Ue(u)];return h&&h[0]}},count:u=>n.count(o(u)),query:u=>n.query(o(u)),openCursor(u){const{keyTail:h,isVirtual:d,keyLength:f}=u.query.index;return d?n.openCursor(o(u)).then(v=>v&&function(p){return Object.create(p,{continue:{value:function(y){y!=null?p.continue(ct(y,u.reverse?t.MAX_KEY:t.MIN_KEY,h)):u.unique?p.continue(p.key.slice(0,f).concat(u.reverse?t.MIN_KEY:t.MAX_KEY,h)):p.continue()}},continuePrimaryKey:{value(y,m){p.continuePrimaryKey(ct(y,t.MAX_KEY,h),m)}},primaryKey:{get:()=>p.primaryKey},key:{get(){const y=p.key;return f===1?y[0]:y.slice(0,f)}},value:{get:()=>p.value}})}(v)):n.openCursor(u)}}}}}};function An(t,e,n,r){return n=n||{},r=r||"",M(t).forEach(s=>{if(X(e,s)){var a=t[s],i=e[s];if(typeof a=="object"&&typeof i=="object"&&a&&i){const l=Lt(a);l!==Lt(i)?n[r+s]=e[s]:l==="Object"?An(a,i,n,r+s+"."):a!==i&&(n[r+s]=e[s])}else a!==i&&(n[r+s]=e[s])}else n[r+s]=void 0}),M(e).forEach(s=>{X(t,s)||(n[r+s]=e[s])}),n}const Fs={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(a){const i=O.trans,{deleting:l,creating:o,updating:c}=i.table(e).hook;switch(a.type){case"add":if(o.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"put":if(o.fire===D&&c.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"delete":if(l.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"deleteRange":if(l.fire===D)break;return i._promise("readwrite",()=>function(d){return h(d.trans,d.range,1e4)}(a),!0)}return n.mutate(a);function u(d){const f=O.trans,v=d.keys||function(p,g){return g.type==="delete"?g.keys:g.keys||g.values.map(p.extractKey)}(r,d);if(!v)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:v}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(p,g,y){return g.type==="add"?Promise.resolve([]):p.getMany({trans:g.trans,keys:y,cache:"immutable"})}(n,d,v).then(p=>{const g=v.map((y,m)=>{const w=p[m],E={onerror:null,onsuccess:null};if(d.type==="delete")l.fire.call(E,y,w,f);else if(d.type==="add"||w===void 0){const _=o.fire.call(E,y,d.values[m],f);y==null&&_!=null&&(y=_,d.keys[m]=y,r.outbound||G(d.values[m],r.keyPath,y))}else{const _=An(w,d.values[m]),x=c.fire.call(E,_,y,w,f);if(x){const b=d.values[m];Object.keys(x).forEach(C=>{X(b,C)?b[C]=x[C]:G(b,C,x[C])})}}return E});return n.mutate(d).then(({failures:y,results:m,numFailures:w,lastResult:E})=>{for(let _=0;_<v.length;++_){const x=m?m[_]:v[_],b=g[_];x==null?b.onerror&&b.onerror(y[_]):b.onsuccess&&b.onsuccess(d.type==="put"&&p[_]?d.values[_]:x)}return{failures:y,results:m,numFailures:w,lastResult:E}}).catch(y=>(g.forEach(m=>m.onerror&&m.onerror(y)),Promise.reject(y)))})}function h(d,f,v){return n.query({trans:d,values:!1,query:{index:r,range:f},limit:v}).then(({result:p})=>u({type:"delete",keys:p,trans:d}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):p.length<v?{failures:[],numFailures:0,lastResult:void 0}:h(d,{...f,lower:p[p.length-1],lowerOpen:!0},v)))}}}}})};function Ar(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let s=0,a=0;s<e.keys.length&&a<t.length;++s)L(e.keys[s],t[a])===0&&(r.push(n?Ze(e.values[s]):e.values[s]),++a);return r.length===t.length?r:null}catch{return null}}const Ns={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=Ar(r.keys,r.trans._cache,r.cache==="clone");return s?P.resolve(s):n.getMany(r).then(a=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Ze(a):a},a))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Cn(t){return!("from"in t)}const ee=function(t,e){if(!this){const n=new ee;return t&&"d"in t&&W(n,t),n}W(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Je(t,e,n){const r=L(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Cn(t))return W(t,{from:e,to:n,d:1});const s=t.l,a=t.r;if(L(n,t.from)<0)return s?Je(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Ln(t);if(L(e,t.to)>0)return a?Je(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Ln(t);L(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),L(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const i=!t.r;s&&!t.l&&At(t,s),a&&i&&At(t,a)}function At(t,e){Cn(e)||function n(r,{from:s,to:a,l:i,r:l}){Je(r,s,a),i&&n(r,i),l&&n(r,l)}(t,e)}function qs(t,e){const n=hn(e);let r=n.next();if(r.done)return!1;let s=r.value;const a=hn(t);let i=a.next(s.from),l=i.value;for(;!r.done&&!i.done;){if(L(l.from,s.to)<=0&&L(l.to,s.from)>=0)return!0;L(s.from,l.from)<0?s=(r=n.next(l.from)).value:l=(i=a.next(s.from)).value}return!1}function hn(t){let e=Cn(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&L(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||L(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Ln(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const a=s==="r"?"l":"r",i={...t},l=t[s];t.from=l.from,t.to=l.to,t[s]=l[s],i[s]=l[a],t[a]=i,i.d=Un(i)}t.d=Un(t)}function Un({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Be(ee.prototype,{add(t){return At(this,t),this},addKey(t){return Je(this,t,t),this},addKeys(t){return t.forEach(e=>Je(this,e,e)),this},[Ut](){return hn(this)}});const Vs={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new ee(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const s=t.table(r),{schema:a}=s,{primaryKey:i}=a,{extractKey:l,outbound:o}=i,c={...s,mutate:d=>{const f=d.trans,v=f.mutatedParts||(f.mutatedParts={}),p=x=>{const b=`idb://${e}/${r}/${x}`;return v[b]||(v[b]=new ee)},g=p(""),y=p(":dels"),{type:m}=d;let[w,E]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const _=d.trans._cache;return s.mutate(d).then(x=>{if(V(w)){m!=="delete"&&(w=x.results),g.addKeys(w);const b=Ar(w,_);b||m==="add"||y.addKeys(w),(b||E)&&function(C,k,K,S){function I(R){const j=C(R.name||"");function Ee(Y){return Y!=null?R.extractKey(Y):null}const Pe=Y=>R.multiEntry&&V(Y)?Y.forEach(pe=>j.addKey(pe)):j.addKey(Y);(K||S).forEach((Y,pe)=>{const je=K&&Ee(K[pe]),Tt=S&&Ee(S[pe]);L(je,Tt)!==0&&(je!=null&&Pe(je),Tt!=null&&Pe(Tt))})}k.indexes.forEach(I)}(p,a,b,E)}else if(w){const b={from:w.lower,to:w.upper};y.add(b),g.add(b)}else g.add(n),y.add(n),a.indexes.forEach(b=>p(b.name).add(n));return x})}},u=({query:{index:d,range:f}})=>{var v,p;return[d,new ee((v=f.lower)!==null&&v!==void 0?v:t.MIN_KEY,(p=f.upper)!==null&&p!==void 0?p:t.MAX_KEY)]},h={get:d=>[i,new ee(d.key)],getMany:d=>[i,new ee().addKeys(d.keys)],count:u,query:u,openCursor:u};return M(h).forEach(d=>{c[d]=function(f){const{subscr:v}=O;if(v){const p=E=>{const _=`idb://${e}/${r}/${E}`;return v[_]||(v[_]=new ee)},g=p(""),y=p(":dels"),[m,w]=h[d](f);if(p(m.name||"").add(w),!m.isPrimaryKey){if(d!=="count"){const E=d==="query"&&o&&f.values&&s.query({...f,values:!1});return s[d].apply(this,arguments).then(_=>{if(d==="query"){if(o&&f.values)return E.then(({result:b})=>(g.addKeys(b),_));const x=f.values?_.result.map(l):_.result;f.values?g.addKeys(x):y.addKeys(x)}else if(d==="openCursor"){const x=_,b=f.values;return x&&Object.create(x,{key:{get:()=>(y.addKey(x.primaryKey),x.key)},primaryKey:{get(){const C=x.primaryKey;return y.addKey(C),C}},value:{get:()=>(b&&g.addKey(x.primaryKey),x.value)}})}return _})}y.add(n)}}return s[d].apply(this,arguments)}}),c}}}};class we{constructor(e,n){this._middlewares={},this.verno=0;const r=we.dependencies;this._options=n={addons:we.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:D,dbReadyPromise:null,cancelOpen:D,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;a.dbReadyPromise=new P(l=>{a.dbReadyResolve=l}),a.openCanceller=new P((l,o)=>{a.cancelOpen=o}),this._state=a,this.name=e,this.on=Le(this,"populate","blocked","versionchange","close",{ready:[_n,D]}),this.on.ready.subscribe=Zn(this.on.ready.subscribe,l=>(o,c)=>{we.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||P.resolve().then(o),c&&l(o);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(o),c&&l(o);else{l(o);const h=this;c||l(function d(){h.on.ready.unsubscribe(o),h.on.ready.unsubscribe(d)})}})}),this.Collection=(i=this,Re(Es.prototype,function(l,o){this.db=i;let c=wr,u=null;if(o)try{c=o()}catch(v){u=v}const h=l._ctx,d=h.table,f=d.hook.reading.fire;this._ctx={table:d,index:h.index,isPrimKey:!h.index||d.schema.primKey.keyPath&&h.index===d.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:h.or,valueMapper:f!==ze?f:null}})),this.Table=function(l){return Re(ks.prototype,function(o,c,u){this.db=l,this._tx=u,this.name=o,this.schema=c,this.hook=l._allTables[o]?l._allTables[o].hook:Le(null,{creating:[ds,D],reading:[cs,ze],updating:[fs,D],deleting:[hs,D]})})}(this),this.Transaction=function(l){return Re(Cs.prototype,function(o,c,u,h,d){this.db=l,this.mode=o,this.storeNames=c,this.schema=u,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=Le(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new P((f,v)=>{this._resolve=f,this._reject=v}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var v=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):v&&this.idbtrans&&this.idbtrans.abort(),F(f)})})}(this),this.Version=function(l){return Re(Ts.prototype,function(o){this.db=l,this._cfg={version:o,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(l){return Re(xr.prototype,function(o,c,u){this.db=l,this._ctx={table:o,index:c===":id"?null:c,or:u};const h=l._deps.indexedDB;if(!h)throw new A.MissingAPI;this._cmp=this._ascending=h.cmp.bind(h),this._descending=(d,f)=>h.cmp(f,d),this._max=(d,f)=>h.cmp(d,f)>0?d:f,this._min=(d,f)=>h.cmp(d,f)<0?d:f,this._IDBKeyRange=l._deps.IDBKeyRange})}(this),this.on("versionchange",l=>{l.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",l=>{!l.newVersion||l.newVersion<l.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${l.oldVersion/10}`)}),this._maxKey=Qe(n.IDBKeyRange),this._createTransaction=(l,o,c,u)=>new this.Transaction(l,o,c,this._options.chromeTransactionDurability,u),this._fireOnBlocked=l=>{this.on("blocked").fire(l),$e.filter(o=>o.name===this.name&&o!==this&&!o._state.vcFired).map(o=>o.on("versionchange").fire(l))},this.use(Ms),this.use(Fs),this.use(Vs),this.use(Ns),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(l=>l(this))}version(e){if(isNaN(e)||e<.1)throw new A.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new A.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(s=>s._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ds),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||O.letThrough||this._vip)?e():new P((n,r)=>{if(this._state.openComplete)return r(new A.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new A.DatabaseClosed);this.open().catch(D)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:s}){s&&this.unuse({stack:e,name:s});const a=this._middlewares[e]||(this._middlewares[e]=[]);return a.push({stack:e,create:n,level:r??10,name:s}),a.sort((i,l)=>i.level-l.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return js(this)}_close(){const e=this._state,n=$e.indexOf(this);if(n>=0&&$e.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new P(r=>{e.dbReadyResolve=r}),e.openCanceller=new P((r,s)=>{e.cancelOpen=s})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new A.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new P((r,s)=>{const a=()=>{this.close();var i=this._deps.indexedDB.deleteDatabase(this.name);i.onsuccess=T(()=>{(function({indexedDB:l,IDBKeyRange:o},c){!On(l)&&c!==Kt&&Pn(l,o).delete(c).catch(D)})(this._deps,this.name),r()}),i.onerror=Q(s),i.onblocked=this._fireOnBlocked};if(e)throw new A.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(a):a()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return M(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Rs.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let s=O.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const a=e.indexOf("?")!==-1;let i,l;e=e.replace("!","").replace("?","");try{if(l=n.map(c=>{var u=c instanceof this.Table?c.name:c;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===jt)i=jt;else{if(e!="rw"&&e!=Rt)throw new A.InvalidArgument("Invalid transaction mode: "+e);i=Rt}if(s){if(s.mode===jt&&i===Rt){if(!a)throw new A.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&l.forEach(c=>{if(s&&s.storeNames.indexOf(c)===-1){if(!a)throw new A.SubTransaction("Table "+c+" not included in parent transaction.");s=null}}),a&&s&&!s.active&&(s=null)}}catch(c){return s?s._promise(null,(u,h)=>{h(c)}):F(c)}const o=Or.bind(null,this,i,l,s,r);return s?s._promise(i,o,"lock"):O.trans?Ie(O.transless,()=>this._whenReady(o)):this._whenReady(o)}table(e){if(!X(this._allTables,e))throw new A.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const $s=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Ls{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[$s](){return this}}function Cr(t,e){return M(e).forEach(n=>{At(t[n]||(t[n]=new ee),e[n])}),t}function Us(t){let e,n=!1;const r=new Ls(s=>{const a=vn(t);let i=!1,l={},o={};const c={get closed(){return i},unsubscribe:()=>{i=!0,fe.storagemutated.unsubscribe(f)}};s.start&&s.start(c);let u=!1,h=!1;function d(){return M(o).some(p=>l[p]&&qs(l[p],o[p]))}const f=p=>{Cr(l,p),d()&&v()},v=()=>{if(u||i)return;l={};const p={},g=function(y){a&&Te();const m=()=>de(t,{subscr:y,trans:null}),w=O.trans?Ie(O.transless,m):m();return a&&w.then(ie,ie),w}(p);h||(fe(Ge,f),h=!0),u=!0,Promise.resolve(g).then(y=>{n=!0,e=y,u=!1,i||(d()?v():(l={},o=p,s.next&&s.next(y)))},y=>{u=!1,n=!1,s.error&&s.error(y),c.unsubscribe()})};return v(),c});return r.hasValue=()=>n,r.getValue=()=>e,r}let fn;try{fn={indexedDB:B.indexedDB||B.mozIndexedDB||B.webkitIndexedDB||B.msIndexedDB,IDBKeyRange:B.IDBKeyRange||B.webkitIDBKeyRange}}catch{fn={indexedDB:null,IDBKeyRange:null}}const me=we;function bt(t){let e=ne;try{ne=!0,fe.storagemutated.fire(t)}finally{ne=e}}Be(me,{...ft,delete:t=>new me(t,{addons:[]}).delete(),exists:t=>new me(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return On(e)?Promise.resolve(e.databases()).then(r=>r.map(s=>s.name).filter(s=>s!==Kt)):Pn(e,n).toCollection().primaryKeys()}(me.dependencies).then(t)}catch{return F(new A.MissingAPI)}},defineClass:()=>function(t){W(this,t)},ignoreTransaction:t=>O.trans?Ie(O.transless,t):t(),vip:cn,async:function(t){return function(){try{var e=dn(t.apply(this,arguments));return e&&typeof e.then=="function"?e:P.resolve(e)}catch(n){return F(n)}}},spawn:function(t,e,n){try{var r=dn(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:P.resolve(r)}catch(s){return F(s)}},currentTransaction:{get:()=>O.trans||null},waitFor:function(t,e){const n=P.resolve(typeof t=="function"?me.ignoreTransaction(t):t).timeout(e||6e4);return O.trans?O.trans.waitFor(n):n},Promise:P,debug:{get:()=>J,set:t=>{ar(t,t==="dexie"?()=>!0:br)}},derive:Se,extend:W,props:Be,override:Zn,Events:Le,on:fe,liveQuery:Us,extendObservabilitySet:Cr,getByKeyPath:ae,setByKeyPath:G,delByKeyPath:function(t,e){typeof e=="string"?G(t,e,void 0):"length"in e&&[].map.call(e,function(n){G(t,n,void 0)})},shallowClone:nr,deepClone:Ze,getObjectDiff:An,cmp:L,asap:er,minKey:tn,addons:[],connections:$e,errnames:wn,dependencies:fn,semVer:Mn,version:Mn.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),me.maxKey=Qe(me.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(fe(Ge,t=>{if(!ne){let e;St?(e=document.createEvent("CustomEvent"),e.initCustomEvent(ce,!0,!0,t)):e=new CustomEvent(ce,{detail:t}),ne=!0,dispatchEvent(e),ne=!1}}),addEventListener(ce,({detail:t})=>{ne||bt(t)}));let ne=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(ce);typeof t.unref=="function"&&t.unref(),fe(Ge,e=>{ne||t.postMessage(e)}),t.onmessage=e=>{e.data&&bt(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){fe(Ge,e=>{try{ne||(typeof localStorage<"u"&&localStorage.setItem(ce,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:ce,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===ce){const n=JSON.parse(e.newValue);n&&bt(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===ce&&bt(e.changedParts)})}P.rejectionMapper=function(t,e){if(!t||t instanceof Ke||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Tn[t.name])return t;var n=new Tn[t.name](e||t.message,t);return"stack"in t&&se(n,"stack",{get:function(){return this.inner.stack}}),n},ar(J,br);const Ws={flows:"&id, title, description, data, folder, tags, metadata, thumbnail, createtime, updatetime",files:"&id, name, size, type, data, metadata, parentid, createtime",folders:"&id, name, description, createtime, updatetime",tags:"&id, name, description, createtime, updatetime",app:"&id, name, data, flowid, folder, description, thumbnail, configs, createtime, updatetime"};class Ys extends we{constructor(){super("ComfyDB");oe(this,"flows");oe(this,"files");oe(this,"folders");oe(this,"tags");oe(this,"app");this.version(1).stores(Ws)}}const zs=new Ys;class nt{constructor(e,n=zs){oe(this,"db");oe(this,"_tablename");this.db=n,this._tablename=e}get table(){return this.db[this._tablename]}async _add(e,n=Zr()){const r=this._tablename,s={...e,id:n,createtime:Date.now(),updatetime:Date.now()};return{id:await this.db[r].add(s)}}async _update(e,n){return{result:await this.table.update(e,{...n,updatetime:Date.now()})}}}class Hs extends nt{constructor(){super("app")}async create(e){const n=await this.findByFlowId(e.flowid),r=n.length?Math.max(...n.map(s=>s.version))+1:1;return this._add({...e,version:r})}async findById(e){const n=await this.table.get(e);return n.thumbnail=await this.findThumbnail(n.flowid,n.thumbnail),n}async query({folderId:e,keyword:n}){let r=[];e?r=await this.table.where("folder").equals(e).toArray():r=await this.table.toArray(),n&&(r=r.filter(s=>s.name.includes(n)||s.description&&s.description.includes(n))),r=r.sort((s,a)=>a.updatetime-s.updatetime);for(const s of r){const a=await this.findThumbnail(s.id,s.thumbnail);s.thumbnail=a}return r}async findByFlowId(e){return(await this.table.where("flowid").equals(e).toArray()).sort((n,r)=>r.updatetime-n.updatetime)}async findLatestByFlowId(e){return(await this.findByFlowId(e))[0]}async updateData(e,n){return this.table.update(e,{data:n})}async updateConfigs(e,n){return this.table.update(e,{configs:n})}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}async findThumbnail(e,n){return n?await this.db.files.get(n):(await this.db.files.where("parentid").equals(e).toArray()).sort((s,a)=>a.createtime-s.createtime)[0]}}const ya=new Hs;class Xs extends nt{constructor(){super("files")}async create(e){return this._add(e)}async findById(e){return this.table.get(e)}async findByParentId(e){return(await this.table.where({parentid:e}).toArray()).sort((n,r)=>r.updatetime-n.updatetime)}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}const ga=new Xs;class Gs extends nt{constructor(){super("flows")}async create({name:e,description:n,data:r,folder:s,tags:a}){return await this._add({name:e,description:n,data:r,folder:s??"",tags:a??[],metadata:{}})}async findById(e){const n=await this.table.get(e);return n.thumbnail=await this.findThumbnail(n.id,n.thumbnail),n}async query({folderId:e,tagIds:n,keyword:r}){let s=[];n?e?s=await this.table.where("folder").equals(e).and(a=>n.every(i=>a.tags.includes(i))).toArray():s=await this.table.filter(a=>n.every(i=>a.tags.includes(i))).toArray():e?s=await this.table.where("folder").equals(e).toArray():s=await this.table.toArray(),r&&(s=s.filter(a=>a.name.includes(r)||a.description&&a.description.includes(r))),s=s.sort((a,i)=>i.updatetime-a.updatetime);for(const a of s){const i=await this.findThumbnail(a.id,a.thumbnail);a.thumbnail=i}return s}async update(e,n){return this._update(e,n)}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}async findThumbnail(e,n){return n?await this.db.files.get(n):(await this.db.files.where("parentid").equals(e).toArray()).sort((s,a)=>a.createtime-s.createtime)[0]}}const va=new Gs;class Qs extends nt{constructor(){super("folders")}async create(e){return this._add(e)}async findById(e){return this.table.get(e)}async update(e,n){return this._update(e,n)}async queryAll(){return this.table.toArray()}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}const ba=new Qs;class Js extends nt{constructor(){super("tags")}async create(e){return this._add(e)}async findById(e){return this.table.get(e)}async update(e,n){return this._update(e,n)}async delete(e){return this.table.delete(e)}async clear(){return this.table.clear()}}new Js;const wa=Ct({__name:"Dialog",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(t,{emit:e}){const s=Wn(t,e);return(a,i)=>(ge(),dt($(Rr),Ir(jr($(s))),{default:ht(()=>[Yn(a.$slots,"default")]),_:3},16))}});function Zs(t,e){return ge(),pn("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[zn("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor"})])}const ea=zn("span",{class:"sr-only"},"Close",-1),_a=Ct({__name:"DialogContent",props:{forceMount:{type:Boolean},trapFocus:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{},class:{},style:{},overlay:{type:Boolean},hideClose:{type:Boolean}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(t,{emit:e}){const n=t,r=e,s=We(()=>{const{class:i,...l}=n;return l}),a=Wn(s,r);return(i,l)=>(ge(),dt($(Vr),null,{default:ht(()=>[i.overlay?(ge(),dt($(Mr),{key:0,class:"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"})):Sn("",!0),Kn($(Fr),Nr($(a),{class:$(mn)("fixed left-1/2 top-1/2 z-50 grid w-full -translate-x-1/2 -translate-y-1/2 gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg outline-none",n.class)}),{default:ht(()=>[Yn(i.$slots,"default"),n.hideClose?Sn("",!0):(ge(),dt($(qr),{key:0,class:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"},{default:ht(()=>[Kn($(Zs),{class:"w-4 h-4"}),ea]),_:1}))]),_:3},16,["class"])]),_:3}))}});function Sr(t){return Hn()?($r(t),!0):!1}function ta(){const t=new Set,e=s=>{t.delete(s)};return{on:s=>{t.add(s);const a=()=>e(s);return Sr(a),{off:a}},off:e,trigger:(...s)=>Promise.all(Array.from(t).map(a=>a(...s)))}}function z(t){return typeof t=="function"?t():$(t)}const Dt=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const na=t=>typeof t<"u",ra=t=>t!=null,sa=Object.prototype.toString,aa=t=>sa.call(t)==="[object Object]",Kr=()=>{},ia=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);function oa(t,e={}){if(!yn(t))return Lr(t);const n=Array.isArray(t.value)?Array.from({length:t.value.length}):{};for(const r in t.value)n[r]=Ur(()=>({get(){return t.value[r]},set(s){var a;if((a=z(e.replaceRef))!=null?a:!0)if(Array.isArray(t.value)){const l=[...t.value];l[r]=s,t.value=l}else{const l={...t.value,[r]:s};Object.setPrototypeOf(l,Object.getPrototypeOf(t.value)),t.value=l}else t.value[r]=s}}));return n}function la(t){var e;const n=z(t);return(e=n==null?void 0:n.$el)!=null?e:n}const Bt=Dt?window:void 0,ua=Dt?window.document:void 0;function U(...t){let e,n,r,s;if(typeof t[0]=="string"||Array.isArray(t[0])?([n,r,s]=t,e=Bt):[e,n,r,s]=t,!e)return Kr;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const a=[],i=()=>{a.forEach(u=>u()),a.length=0},l=(u,h,d,f)=>(u.addEventListener(h,d,f),()=>u.removeEventListener(h,d,f)),o=Vt(()=>[la(e),z(s)],([u,h])=>{if(i(),!u)return;const d=aa(h)?{...h}:h;a.push(...n.flatMap(f=>r.map(v=>l(u,f,v,d))))},{immediate:!0,flush:"post"}),c=()=>{o(),i()};return Sr(c),c}function ca(t){return JSON.parse(JSON.stringify(t))}function xa(t,e={}){var n,r;const{pointerTypes:s,preventDefault:a,stopPropagation:i,exact:l,onMove:o,onEnd:c,onStart:u,initialValue:h,axis:d="both",draggingElement:f=Bt,containerElement:v,handle:p=t}=e,g=re((n=z(h))!=null?n:{x:0,y:0}),y=re(),m=b=>s?s.includes(b.pointerType):!0,w=b=>{z(a)&&b.preventDefault(),z(i)&&b.stopPropagation()},E=b=>{var C;if(!m(b)||z(l)&&b.target!==z(t))return;const k=z(v),K=(C=k==null?void 0:k.getBoundingClientRect)==null?void 0:C.call(k),S=z(t).getBoundingClientRect(),I={x:b.clientX-(k?S.left-K.left+k.scrollLeft:S.left),y:b.clientY-(k?S.top-K.top+k.scrollTop:S.top)};(u==null?void 0:u(I,b))!==!1&&(y.value=I,w(b))},_=b=>{var C;if(!m(b)||!y.value)return;const k=z(v),K=(C=k==null?void 0:k.getBoundingClientRect)==null?void 0:C.call(k),S=z(t).getBoundingClientRect();let{x:I,y:R}=g.value;(d==="x"||d==="both")&&(I=b.clientX-y.value.x,k&&(I=Math.min(Math.max(0,I),K.width+k.scrollLeft-S.width))),(d==="y"||d==="both")&&(R=b.clientY-y.value.y,k&&(R=Math.min(Math.max(0,R),K.height+k.scrollTop-S.height))),g.value={x:I,y:R},o==null||o(g.value,b),w(b)},x=b=>{m(b)&&y.value&&(y.value=void 0,c==null||c(g.value,b),w(b))};if(Dt){const b={capture:(r=e.capture)!=null?r:!0};U(p,"pointerdown",E,b),U(f,"pointermove",_,b),U(f,"pointerup",x,b)}return{...oa(g),position:g,isDragging:We(()=>!!y.value),style:We(()=>`left:${g.value.x}px;top:${g.value.y}px;`)}}function ka(t,e={}){const n=re(!1),r=Wr(null);let s=0,a=!0;if(Dt){const i=typeof e=="function"?{onDrop:e}:e,l=o=>{var c,u;const h=Array.from((u=(c=o.dataTransfer)==null?void 0:c.files)!=null?u:[]);return r.value=h.length===0?null:h};U(t,"dragenter",o=>{var c,u;const h=Array.from(((c=o==null?void 0:o.dataTransfer)==null?void 0:c.items)||[]).map(d=>d.kind==="file"?d.type:null).filter(ra);if(i.dataTypes&&o.dataTransfer){const d=$(i.dataTypes);if(a=typeof d=="function"?d(h):d?d.some(f=>h.includes(f)):!0,!a)return}o.preventDefault(),s+=1,n.value=!0,(u=i.onEnter)==null||u.call(i,l(o),o)}),U(t,"dragover",o=>{var c;a&&(o.preventDefault(),(c=i.onOver)==null||c.call(i,l(o),o))}),U(t,"dragleave",o=>{var c;a&&(o.preventDefault(),s-=1,s===0&&(n.value=!1),(c=i.onLeave)==null||c.call(i,l(o),o))}),U(t,"drop",o=>{var c;o.preventDefault(),s=0,n.value=!1,(c=i.onDrop)==null||c.call(i,l(o),o)})}return{files:r,isOverDropZone:n}}const Me=new Map;function Ea(t){const e=Hn();function n(l){var o;const c=Me.get(t)||new Set;c.add(l),Me.set(t,c);const u=()=>s(l);return(o=e==null?void 0:e.cleanups)==null||o.push(u),u}function r(l){function o(...c){s(o),l(...c)}return n(o)}function s(l){const o=Me.get(t);o&&(o.delete(l),o.size||a())}function a(){Me.delete(t)}function i(l,o){var c;(c=Me.get(t))==null||c.forEach(u=>u(l,o))}return{on:n,once:r,off:s,emit:i,reset:a}}const da={multiple:!0,accept:"*",reset:!1,directory:!1};function Pa(t={}){const{document:e=ua}=t,n=re(null),{on:r,trigger:s}=ta();let a;e&&(a=e.createElement("input"),a.type="file",a.onchange=o=>{const c=o.target;n.value=c.files,s(n.value)});const i=()=>{n.value=null,a&&(a.value="",s(null))},l=o=>{if(!a)return;const c={...da,...t,...o};a.multiple=c.multiple,a.accept=c.accept,a.webkitdirectory=c.directory,ia(c,"capture")&&(a.capture=c.capture),c.reset&&i(),a.click()};return{files:Yr(n),open:l,reset:i,onChange:r}}const ha={ctrl:"control",command:"meta",cmd:"meta",option:"alt",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"};function Oa(t={}){const{reactive:e=!1,target:n=Bt,aliasMap:r=ha,passive:s=!0,onEventFired:a=Kr}=t,i=Dn(new Set),l={toJSON(){return{}},current:i},o=e?Dn(l):l,c=new Set,u=new Set;function h(p,g){p in o&&(e?o[p]=g:o[p].value=g)}function d(){i.clear();for(const p of u)h(p,!1)}function f(p,g){var y,m;const w=(y=p.key)==null?void 0:y.toLowerCase(),_=[(m=p.code)==null?void 0:m.toLowerCase(),w].filter(Boolean);w&&(g?i.add(w):i.delete(w));for(const x of _)u.add(x),h(x,g);w==="meta"&&!g?(c.forEach(x=>{i.delete(x),h(x,!1)}),c.clear()):typeof p.getModifierState=="function"&&p.getModifierState("Meta")&&g&&[...i,..._].forEach(x=>c.add(x))}U(n,"keydown",p=>(f(p,!0),a(p)),{passive:s}),U(n,"keyup",p=>(f(p,!1),a(p)),{passive:s}),U("blur",d,{passive:!0}),U("focus",d,{passive:!0});const v=new Proxy(o,{get(p,g,y){if(typeof g!="string")return Reflect.get(p,g,y);if(g=g.toLowerCase(),g in r&&(g=r[g]),!(g in o))if(/[+_-]/.test(g)){const w=g.split(/[+_-]/g).map(E=>E.trim());o[g]=We(()=>w.every(E=>z(v[E])))}else o[g]=re(!1);const m=Reflect.get(p,g,y);return e?z(m):m}});return v}const fa={page:t=>[t.pageX,t.pageY],client:t=>[t.clientX,t.clientY],screen:t=>[t.screenX,t.screenY],movement:t=>t instanceof Touch?null:[t.movementX,t.movementY]};function Aa(t={}){const{type:e="page",touch:n=!0,resetOnTouchEnds:r=!1,initialValue:s={x:0,y:0},window:a=Bt,target:i=a,scroll:l=!0,eventFilter:o}=t;let c=null;const u=re(s.x),h=re(s.y),d=re(null),f=typeof e=="function"?e:fa[e],v=_=>{const x=f(_);c=_,x&&([u.value,h.value]=x,d.value="mouse")},p=_=>{if(_.touches.length>0){const x=f(_.touches[0]);x&&([u.value,h.value]=x,d.value="touch")}},g=()=>{if(!c||!a)return;const _=f(c);c instanceof MouseEvent&&_&&(u.value=_[0]+a.scrollX,h.value=_[1]+a.scrollY)},y=()=>{u.value=s.x,h.value=s.y},m=o?_=>o(()=>v(_),{}):_=>v(_),w=o?_=>o(()=>p(_),{}):_=>p(_),E=o?()=>o(()=>g(),{}):()=>g();if(i){const _={passive:!0};U(i,["mousemove","dragover"],m,_),n&&e!=="movement"&&(U(i,["touchstart","touchmove"],w,_),r&&U(i,"touchend",y,_)),l&&e==="page"&&U(a,"scroll",E,{passive:!0})}return{x:u,y:h,sourceType:d}}function Dr(t,e,n,r={}){var s,a,i;const{clone:l=!1,passive:o=!1,eventName:c,deep:u=!1,defaultValue:h,shouldEmit:d}=r,f=Hr(),v=n||(f==null?void 0:f.emit)||((s=f==null?void 0:f.$emit)==null?void 0:s.bind(f))||((i=(a=f==null?void 0:f.proxy)==null?void 0:a.$emit)==null?void 0:i.bind(f==null?void 0:f.proxy));let p=c;e||(e="modelValue"),p=p||`update:${e.toString()}`;const g=w=>l?typeof l=="function"?l(w):ca(w):w,y=()=>na(t[e])?g(t[e]):h,m=w=>{d?d(w)&&v(p,w):v(p,w)};if(o){const w=y(),E=re(w);let _=!1;return Vt(()=>t[e],x=>{_||(_=!0,E.value=g(x),zr(()=>_=!1))}),Vt(E,x=>{!_&&(x!==t[e]||u)&&m(x)},{deep:u}),E}else return We({get(){return y()},set(w){m(w)}})}const Ca=Ct({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const n=t,s=Dr(n,"modelValue",e,{passive:!0,defaultValue:n.defaultValue});return(a,i)=>Xn((ge(),pn("textarea",{"onUpdate:modelValue":i[0]||(i[0]=l=>yn(s)?s.value=l:null),class:Qn($(mn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n.class))},null,2)),[[Gn,$(s)]])}}),Sa=Ct({__name:"Input",props:{defaultValue:{},modelValue:{},class:{}},emits:["update:modelValue"],setup(t,{emit:e}){const n=t,s=Dr(n,"modelValue",e,{passive:!0,defaultValue:n.defaultValue});return(a,i)=>Xn((ge(),pn("input",{"onUpdate:modelValue":i[0]||(i[0]=l=>yn(s)?s.value=l:null),class:Qn($(mn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n.class))},null,2)),[[Gn,$(s)]])}});export{va as F,Sa as _,Ea as a,ba as b,Ca as c,_a as d,wa as e,Pa as f,ka as g,ya as h,xa as i,ga as j,Aa as k,Oa as u};
